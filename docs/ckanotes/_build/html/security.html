<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Security &mdash; CKA Notes  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/custom.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Storage" href="storage.html" />
    <link rel="prev" title="Cluster Maintenance" href="cluster-maintenance.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> CKA Notes
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The CKABOOK:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="core-concepts.html">Core Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheduling.html">Scheduling</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging-monitoring.html">Logging and Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="application-lifecycle-management.html">Application lifecycle management</a></li>
<li class="toctree-l1"><a class="reference internal" href="cluster-maintenance.html">Cluster Maintenance</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ca-pulic-certs-in-browsers">CA Pulic certs in Browsers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#all-k8s-tls-certs">all k8s TLS certs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-tls-public-private-keys">configure TLS public/private keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-tls-for-k8s">configure TLS for k8s</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking.html">Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="design-k8s.html">Design Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="install-k8s-kubeadm.html">Install Kubernetes with kubeadm</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">troubleshooting in k8s</a></li>
<li class="toctree-l1"><a class="reference internal" href="kodekloud-labs.html">kodekloud labs</a></li>
<li class="toctree-l1"><a class="reference internal" href="killersh-labs.html">killer.sh simulator labs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CKA Notes</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Security</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="security">
<h1>Security<a class="headerlink" href="#security" title="Permalink to this headline"></a></h1>
<p>Concepts</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Concepts</span><a class="headerlink" href="#id1" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">1</span>. Security Primitives
<span class="m">2</span>. Authentication
<span class="m">3</span>. TLS
<span class="m">4</span>. Certificates API
<span class="m">5</span>. KubeConfig
<span class="m">6</span>. API Groups
<span class="m">7</span>. Authorization
<span class="m">8</span>. RBAC
<span class="m">9</span>. CLuster Roles
<span class="m">10</span>. Image Security - Security Contexts
<span class="m">11</span>. Network Policies
</pre></div>
</div>
</div>
<p>Securityprimitives</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Securityprimitives</span><a class="headerlink" href="#id2" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubernetes related security

secure the <span class="s2">&quot;kube-apiserver&quot;</span> <span class="k">in</span> two ways

<span class="m">1</span>. who can access the kube-apiserver --&gt; <span class="s2">&quot;Authentication&quot;</span> like username and passwords, username and Tokens,
   Certificates, External Authentication providers<span class="o">(</span>LDAP<span class="o">)</span> and <span class="k">for</span> machines its Service Accounts

<span class="m">2</span>. What can they <span class="k">do</span> <span class="k">in</span> kube-apiserver --&gt; <span class="s2">&quot;Authorization&quot;</span> using RBAC Authorization, Node Authorization, Webhook mode, 
   ABAC Authorization<span class="o">(</span>Attribute Based Access Controls<span class="o">)</span>

   All communication between k8s components achieved with TLS encryption.

   How about between application --&gt; by default all pods can access all other pods with <span class="k">in</span> the cluster,
   we can use <span class="s2">&quot;network policies&quot;</span> to restrict the access between pods.
</pre></div>
</div>
</div>
<p>k8sAuthentication</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">k8sAuthentication</span><a class="headerlink" href="#id3" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>k8s can be accessbed by
<span class="m">1</span>. Admins  --&gt; ClusterAdmin
<span class="m">2</span>. Developers  --&gt; Application Developers who gonna host an application <span class="k">in</span> k8s
<span class="m">3</span>. Endusers --&gt; applications hosted <span class="k">in</span> pods can be accessed 

<span class="m">4</span>. Bots<span class="o">(</span>Service Accounts, Other services, third party services<span class="o">)</span>



Users are managed by <span class="s2">&quot;kube-apiserver&quot;</span>
-------------------------------------------&gt;
<span class="m">1</span>. Static Password File
<span class="m">2</span>. Static Token File
<span class="m">3</span>. Certificates
<span class="m">4</span>. Identity services<span class="o">(</span>LDAP, kerberos<span class="o">)</span>


<span class="m">1</span>. Static Password File
user-details.csv
---------------------------&gt;
password123,user1,u001
password12,user2,u002

kube-apiserver.service:
------------------------&gt;
--basic-auth-file<span class="o">=</span>user-details.csv
curl -vk https://master-node-ip:6443/api/v1/pods -u <span class="s2">&quot;user1:password123&quot;</span>


<span class="m">2</span>. Static Token File

user-token-details.csv:
--------------------------&gt;
sdjhflsdfiriwlerwqerowpjf84043w,user10,u001
wewerweirwreowwoewqerowpjf8werw,user11,u002

kube-apiserver.service:
----------------------------------------------&gt;
--token-auth-file<span class="o">=</span>user-token-details.csv
curl -vk https://master-node-ip:6443/api/v1/pods --header <span class="s2">&quot;Authorization: Bearer sdjhflsdfiriwlerwqerowpjf84043w&quot;</span>



Create a file with user details locally at /tmp/users/user-details.csv
<span class="c1"># User File Contents</span>
password123,user1,u0001
password123,user2,u0002
password123,user3,u0003
password123,user4,u0004
password123,user5,u0005


/etc/kubernetes/manifests/kube-apiserver.yaml
-----------------------------------------------------------------------------&gt;
apiVersion: v1
kind: Pod
metadata:
  name: kube-apiserver
  namespace: kube-system
spec:
  containers:
  - command:
    - kube-apiserver
      &lt;content-hidden&gt;
    image: k8s.gcr.io/kube-apiserver-amd64:v1.11.3
    name: kube-apiserver
    volumeMounts:
    - mountPath: /tmp/users
      name: usr-details
      readOnly: <span class="nb">true</span>
  volumes:
  - hostPath:
      path: /tmp/users
      type: DirectoryOrCreate
    name: usr-details



Modify the kube-apiserver startup options to include the basic-auth file
-----------------------------------------------------------------------------------------&gt;
apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  name: kube-apiserver
  namespace: kube-system
spec:
  containers:
  - command:
    - kube-apiserver
    - --authorization-mode<span class="o">=</span>Node,RBAC
      &lt;content-hidden&gt;
    - --basic-auth-file<span class="o">=</span>/tmp/users/user-details.csv


Create the necessary roles and role bindings <span class="k">for</span> these users:
-------------------------------------------------------------------&gt;

---
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  namespace: default
  name: pod-reader
rules:
- apiGroups: <span class="o">[</span><span class="s2">&quot;&quot;</span><span class="o">]</span> <span class="c1"># &quot;&quot; indicates the core API group</span>
  resources: <span class="o">[</span><span class="s2">&quot;pods&quot;</span><span class="o">]</span>
  verbs: <span class="o">[</span><span class="s2">&quot;get&quot;</span>, <span class="s2">&quot;watch&quot;</span>, <span class="s2">&quot;list&quot;</span><span class="o">]</span>

---
<span class="c1"># This role binding allows &quot;jane&quot; to read pods in the &quot;default&quot; namespace.</span>
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: read-pods
  namespace: default
subjects:
- kind: User
  name: user1 <span class="c1"># Name is case sensitive</span>
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role <span class="c1">#this must be Role or ClusterRole</span>
  name: pod-reader <span class="c1"># this must match the name of the Role or ClusterRole you wish to bind to</span>
  apiGroup: rbac.authorization.k8s.io

after running above we can access kube-apiserver as --&gt; curl -v -k https://localhost:6443/api/v1/pods -u <span class="s2">&quot;user1:password123&quot;</span>


Certificates:
-----------------------------------------------------&gt;
<span class="m">1</span>. TLS Basics
<span class="m">2</span>. TLS <span class="k">in</span> kubernetes - Certificate creation
</pre></div>
</div>
</div>
<p>demossltls</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">demossltls</span><a class="headerlink" href="#id4" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Sender --------&gt; Reciever

<span class="s2">&quot;symmetric encryption&quot;</span>: Same key is used to encrypt and decrypt both at sender-end and reciever-end 

<span class="s2">&quot;asymmetric encryption&quot;</span>:  This encryption uses pair of keys, a private key and a public key



ssh-key example:
---------------------&gt;

<span class="k">in</span> the users system:
-----------------------------------------------&gt;
ssh-keygen generates both private and public keys
id_rsa
id_rsa.pub

<span class="k">in</span> the servers ~/.ssh/Authorizedkeys:
--------------------------------------------------------------------------------------------------------------------------&gt;
copy users public key<span class="o">(</span>id_rsa.pub<span class="o">)</span> to servers Authorizedkeys file to securely access the server<span class="o">(</span>using asymmetric encryption<span class="o">)</span>



Web servers example:
----------------------------------------------------------&gt;
as we did it <span class="k">in</span> ssh-keygen<span class="o">(</span>which creates private and public keys<span class="o">)</span> we can <span class="k">do</span> same <span class="k">for</span> webserver TLS encryption also 
to generate private and public key pair can use <span class="s2">&quot;openssl&quot;</span>

<span class="s2">&quot;private key(my-bank.key) creation&quot;</span>:
---------------------------------------&gt;
openssl genrsa -out my-bank.key <span class="m">1024</span>

<span class="s2">&quot;public key(mybank.pem) creation&quot;</span>:
--------------------------------------------------&gt;
openssl rsa -in my-bank.key -pubout &gt; mybank.pem


MacBook-Pro:6.Security bharathdasaraju$ mkdir generate_tls_public-private_keys
MacBook-Pro:6.Security bharathdasaraju$ <span class="nb">cd</span> generate_tls_public-private_keys
MacBook-Pro:generate_tls_public-private_keys bharathdasaraju$ openssl genrsa -out my-bank.key <span class="m">1024</span>
Generating RSA private key, <span class="m">1024</span> bit long modulus
.++++++
................................................................++++++
e is <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
MacBook-Pro:generate_tls_public-private_keys bharathdasaraju$ ls -rtlh
total <span class="m">8</span>
-rw-r--r--  <span class="m">1</span> bharathdasaraju  staff   887B <span class="m">22</span> Sep <span class="m">16</span>:47 my-bank.key
MacBook-Pro:generate_tls_public-private_keys bharathdasaraju$ 


MacBook-Pro:generate_tls_public-private_keys bharathdasaraju$ openssl rsa -in my-bank.key -pubout &gt; mybank.pem
writing RSA key
MacBook-Pro:generate_tls_public-private_keys bharathdasaraju$ ls -rlth
total <span class="m">16</span>
-rw-r--r--  <span class="m">1</span> bharathdasaraju  staff   887B <span class="m">22</span> Sep <span class="m">16</span>:47 my-bank.key
-rw-r--r--  <span class="m">1</span> bharathdasaraju  staff   272B <span class="m">22</span> Sep <span class="m">16</span>:48 mybank.pem
MacBook-Pro:generate_tls_public-private_keys bharathdasaraju$ 


How to sign certificates with certificate authority:
----------------------------------------------------------&gt;
popular CAs are symantec, global sign, digicert etc..

Certificate Signing Request<span class="o">(</span>CSR<span class="o">)</span>
--------------------------------------------------------------&gt;
We need to generate a Certificate Signing Request<span class="o">(</span>CSR<span class="o">)</span> by using the private key<span class="o">(</span>my-bank.key<span class="o">)</span> we generated earlier

openssl req -new -key my-bank.key -out my-bank.csr -subj <span class="s2">&quot;/C=SG/ST=SG/O=my-bank, Inc./CN=my-bank.com&quot;</span>

MacBook-Pro:generate_tls_public-private_keys bharathdasaraju$ openssl req -new -key my-bank.key -out my-bank.csr -subj <span class="s2">&quot;/C=SG/ST=SG/O=my-bank, Inc./CN=my-bank.com&quot;</span>
MacBook-Pro:generate_tls_public-private_keys bharathdasaraju$ ls -rtlh
total <span class="m">24</span>
-rw-r--r--  <span class="m">1</span> bharathdasaraju  staff   887B <span class="m">22</span> Sep <span class="m">16</span>:47 my-bank.key
-rw-r--r--  <span class="m">1</span> bharathdasaraju  staff   272B <span class="m">22</span> Sep <span class="m">16</span>:48 mybank.pem
-rw-r--r--  <span class="m">1</span> bharathdasaraju  staff   607B <span class="m">22</span> Sep <span class="m">17</span>:11 my-bank.csr
MacBook-Pro:generate_tls_public-private_keys bharathdasaraju$ 

the certificate authorities check our csr file and sign and send the certificates to us.

how to make sure that the certificate is signed by legitimate CA....
like CA is a valid CA and that the certificate is infact signed by Symantec and not by some fake CA names semantech.

The CAs themselves have <span class="nb">set</span> of public and private keypairs.
The CA is use their private keys to sign the certificates,  the public keys of all the CAs are built <span class="k">in</span> to the browsers as shown <span class="k">in</span> the image CAs_pulbic_certs_in_browser.png


The public keys of all the CAs are built <span class="k">in</span> to the browsers.

The browser uses the public key of the CA to validate that the certificate is actually signed by the CA themselves.
Now these are the public CAs that <span class="nb">help</span> us ensure the public websites we visit, like our banks, email etc are legitimate.


However they dont <span class="nb">help</span> you to validate sites hosted privately say within your organization.
For example, <span class="k">for</span> accessing your payroll or internal email applications.For that you can host your own private CAs.


Most of the companies like Symantec,Comodo,GlobalSign,digicert have a private offering of their services.
A CA server that you can deploy internally with <span class="k">in</span> your company.
You can <span class="k">then</span> have the public key of your internal CA server installed on all your employees browsers and establish secure connectivity
within your organization.


usually public keys ends with <span class="s2">&quot;*.crt&quot;</span> <span class="o">(</span>or<span class="o">)</span> <span class="s2">&quot;*.pem&quot;</span>
server.crt
server.pem
client.crt 
client.pem 

usually private keys ends with <span class="s2">&quot;*.key&quot;</span> <span class="o">(</span>or<span class="o">)</span> <span class="s2">&quot;*-key.pem&quot;</span>
server.key
server-key.pem 
client.key 
client-key.pem 
</pre></div>
</div>
</div>
<p>TLSink8s</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">TLSink8s</span><a class="headerlink" href="#id5" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Server Certificates&quot;</span>:  Serving certificates
--------------------------------------------------&gt;
<span class="s2">&quot;private_key&quot;</span>: my-bank.key<span class="o">(</span>my-bank-key.pem<span class="o">)</span> 
<span class="s2">&quot;public_key&quot;</span>: mybank.pem<span class="o">(</span>mybank.crt<span class="o">)</span>



<span class="s2">&quot;Certificate Authority&quot;</span>: Root certificates
-----------------------------------------------&gt;
CA has its own <span class="nb">set</span> of private and public_keys
CA public keys already available <span class="k">in</span> all browsers to validate its signed by correct CA


<span class="s2">&quot;Client Certificates&quot;</span>:
--------------------------------------------------&gt;
client.key<span class="o">(</span>client-key.pem<span class="o">)</span>  --&gt; <span class="s2">&quot;private key&quot;</span>
client.pem<span class="o">(</span>client.crt<span class="o">)</span>  --&gt; <span class="s2">&quot;public key&quot;</span>

In kubernetes communication between all the k8s components needs to be secured.
i.e. kube-apiserver to kube-scheduler....kubelet to kube-apiserver ...kube-apiserver to kube-controllermanager etc...


Server certificate <span class="k">for</span> Server components <span class="k">in</span> k8s :
---------------------------------------------------&gt;
<span class="m">1</span>.<span class="s2">&quot;kube-apiserver&quot;</span>  --&gt; apiserver.crt and apiserver.key
<span class="m">2</span>.<span class="s2">&quot;etcd server&quot;</span>  --&gt; etcdserver.crt and etcdserver.key

<span class="m">3</span>.<span class="s2">&quot;kubelet server&quot;</span> --&gt; kubelet.crt and kubelet.key

Client certificates <span class="k">for</span> Client components <span class="k">in</span> k8s:
---------------------------------------------------------&gt;
<span class="m">4</span>.<span class="s2">&quot;admins(we)&quot;</span> --&gt; we need admin.crt and admin.key to authenticate with the <span class="s2">&quot;kube-apiserver&quot;</span>
<span class="m">5</span>.<span class="s2">&quot;kube-scheduler&quot;</span> --&gt; scheduler.crt and scheduler.key 
<span class="m">6</span>.<span class="s2">&quot;kube-controller-manager&quot;</span> --&gt; controller-manager.crt and controller-manager.key

<span class="m">7</span>.<span class="s2">&quot;kube-proxy&quot;</span> --&gt; kube-proxy.crt and kube-proxy.key 

The server components also talks to themseves as well...lets say <span class="s2">&quot;kube-apiserver&quot;</span> talks to <span class="s2">&quot;etcd-server&quot;</span> ..
so at that <span class="nb">time</span> kube-apiserver is client <span class="k">for</span> the etcd-server...kube-apiserver can use same server certificates <span class="o">(</span>or<span class="o">)</span> we can generate another certs <span class="k">for</span> this purpose only.
<span class="m">8</span>.<span class="s2">&quot;apisever-etcd client&quot;</span> --&gt; apiserver-etcd-client.crt  and apiserver-etcd-client.key

and also kube-apiserver talks to the kubelet server, so at that <span class="nb">time</span> kube-apiserver is client <span class="k">for</span> kubelet 
kube-apiserver can use same server certificates <span class="o">(</span>or<span class="o">)</span> we can generate another certs <span class="k">for</span> this purpose only.
<span class="m">9</span>.<span class="s2">&quot;apiserver-kubelet client&quot;</span> --&gt; apiserver-kubelet-client.crt and apiserver-kubelet-client.key 


Of course we need Certificate Authority<span class="o">(</span>CA<span class="o">)</span> to sign abd validate above all <span class="m">9</span> certificates.
CA has its own certs i.e. <span class="m">10</span>. <span class="s2">&quot;CA certs&quot;</span> --&gt; ca.crt and ca.key 
</pre></div>
</div>
</div>
<p>opensslapiserverconf</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">opensslapiserverconf</span><a class="headerlink" href="#id6" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>req<span class="o">]</span>
<span class="nv">req_extensions</span> <span class="o">=</span> v3_req
<span class="nv">distinguished_name</span> <span class="o">=</span> req_distinguished_name
<span class="o">[</span>req_distinguished_name<span class="o">]</span>
<span class="o">[</span> v3_req <span class="o">]</span>
<span class="nv">basicConstraints</span> <span class="o">=</span> CA:FALSE
<span class="nv">keyUsage</span> <span class="o">=</span> nonRepudiation, digitalSignature, keyEncipherment
<span class="nv">subjectAltName</span> <span class="o">=</span> @alt_names
<span class="o">[</span>alt_names<span class="o">]</span>
DNS.1 <span class="o">=</span> kubernetes
DNS.2 <span class="o">=</span> kubernetes.default
DNS.3 <span class="o">=</span> kubernetes.default.svc
DNS.4 <span class="o">=</span> kubernetes.default.svc.cluster.local
DNS.5 <span class="o">=</span> k8s-master.local
IP.1 <span class="o">=</span> <span class="m">10</span>.254.0.1
IP.2 <span class="o">=</span> <span class="m">192</span>.168.1.230
</pre></div>
</div>
</div>
<p>kubeletconfig</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">kubeletconfig</span><a class="headerlink" href="#id7" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">KubeletConfiguration</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubelet.config.k8s.io/v1beta1</span>
<span class="nt">authentication</span><span class="p">:</span>
  <span class="nt">x509</span><span class="p">:</span>
    <span class="nt">clientCAFile</span><span class="p">:</span> <span class="s">&quot;/var/lib/kubernetes/ca.pem&quot;</span>
<span class="nt">authorization</span><span class="p">:</span>
  <span class="nt">mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webhook</span>
<span class="nt">clusterDomain</span><span class="p">:</span> <span class="s">&quot;cluster.local&quot;</span>
<span class="nt">clusterDNS</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;10.32.0.10&quot;</span>
<span class="nt">podCIDR</span><span class="p">:</span> <span class="s">&quot;${POD_CIDR}&quot;</span>
<span class="nt">resolvConf</span><span class="p">:</span> <span class="s">&quot;/run/systemd/resolve/resolv.conf&quot;</span>
<span class="nt">runtimeRequestTimeout</span><span class="p">:</span> <span class="s">&quot;15m&quot;</span>
<span class="nt">tlsCertFile</span><span class="p">:</span> <span class="s">&quot;/var/lib/kubelet/node01.crt&quot;</span>
<span class="nt">tlsPrivateKeyFile</span><span class="p">:</span> <span class="s">&quot;/var/lib/kubelet/node01.key&quot;</span>
</pre></div>
</div>
</div>
<p>k8sapiconfig</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">k8sapiconfig</span><a class="headerlink" href="#id8" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">clusters</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">cluster</span><span class="p">:</span>
    <span class="nt">certificate-authority</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ca.crt</span>
    <span class="nt">server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://kube-apiserver:6443</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">config</span>
<span class="nt">users</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes-admin</span>
  <span class="nt">user</span><span class="p">:</span>
    <span class="nt">client-certificate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">admin.crt</span>
    <span class="nt">client-key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">admin.key</span>
</pre></div>
</div>
</div>
<p>generatetlsink8s</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">generatetlsink8s</span><a class="headerlink" href="#id9" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Server certificate <span class="k">for</span> Server components <span class="k">in</span> k8s :
---------------------------------------------------&gt;
<span class="m">1</span>.<span class="s2">&quot;kube-apiserver&quot;</span>  --&gt; apiserver.crt and apiserver.key
<span class="m">2</span>.<span class="s2">&quot;etcd server&quot;</span>  --&gt; etcdserver.crt and etcdserver.key
<span class="m">3</span>.<span class="s2">&quot;kubelet server&quot;</span> --&gt; kubelet.crt and kubelet.key

Client certificates <span class="k">for</span> Client components <span class="k">in</span> k8s:
---------------------------------------------------------&gt;
<span class="m">4</span>.<span class="s2">&quot;admins(we)&quot;</span> --&gt; we need admin.crt and admin.key to authenticate with the <span class="s2">&quot;kube-apiserver&quot;</span>
<span class="m">5</span>.<span class="s2">&quot;kube-scheduler&quot;</span> --&gt; scheduler.crt and scheduler.key 
<span class="m">6</span>.<span class="s2">&quot;kube-controller-manager&quot;</span> --&gt; controller-manager.crt and controller-manager.key
<span class="m">7</span>.<span class="s2">&quot;kube-proxy&quot;</span> --&gt; kube-proxy.crt and kube-proxy.key 
<span class="m">8</span>.<span class="s2">&quot;apisever-etcd client&quot;</span> --&gt; apiserver-etcd-client.crt  and apiserver-etcd-client.key
<span class="m">9</span>.<span class="s2">&quot;apiserver-kubelet client&quot;</span> --&gt; apiserver-kubelet-client.crt and apiserver-kubelet-client.key 

CA Certs:
----------------------------------------------------------&gt;
<span class="m">10</span>. <span class="s2">&quot;CA certs&quot;</span> --&gt; ca.crt and ca.key 


to generate certs we can use <span class="s2">&quot;openssl&quot;</span> tool<span class="o">(</span>Someother tools easyrsa and cfssl also available<span class="o">)</span>


<span class="s2">&quot;tls certs generation for CA&quot;</span>:
-------------------------------------------------------------------------------------------------------------------------------&gt;
<span class="m">1</span>. <span class="s2">&quot;generate private key for CA i.e. ca.key&quot;</span>:

MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ openssl genrsa -out ca.key <span class="m">2048</span>
Generating RSA private key, <span class="m">2048</span> bit long modulus
...................................................................+++
........+++
e is <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ 

<span class="m">2</span>. <span class="s2">&quot;Generate csr(certificate signing request) using ca.key&quot;</span>:

MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ openssl req -new -key ca.key -subj <span class="s2">&quot;/CN=KUBERNETES-CA&quot;</span> -out ca.csr
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ ls
ca.csr  ca.key
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ 

<span class="m">3</span>. <span class="s2">&quot;Sign the csr and create crt using with self-signed private key(ca.key)&quot;</span>:

MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ openssl x509 -req -in ca.csr -signkey ca.key -out ca.crt
Signature ok
<span class="nv">subject</span><span class="o">=</span>/CN<span class="o">=</span>KUBERNETES-CA
Getting Private key
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ 

going forrward we will use the CA key pairs to sign them.
the CA now has its own <span class="s2">&quot;private key(ca.key)&quot;</span> and the <span class="s2">&quot;root certificate(ca.crt)&quot;</span> file.



<span class="s2">&quot;Generate client tls certificates&quot;</span>:
-------------------------------------------------------------------------------------------------------------------------------&gt;
<span class="s2">&quot;admins(we)&quot;</span> --&gt; we need admin.crt and admin.key to authenticate with the <span class="s2">&quot;kube-apiserver&quot;</span>

<span class="m">1</span>. <span class="s2">&quot;generate private key for admin i.e. admin.key&quot;</span>:
-----------------------------------------------------------------------&gt;
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ openssl genrsa -out admin.key <span class="m">2048</span>
Generating RSA private key, <span class="m">2048</span> bit long modulus
....................+++
............................................+++
e is <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ 
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ ls
admin.key       ca.crt          ca.csr          ca.key
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ 

<span class="m">2</span>. <span class="s2">&quot;Generate csr(certificate signing request) using admin.key&quot;</span>:
-----------------------------------------------------------------------&gt;
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ openssl req -new -key admin.key -subj <span class="s2">&quot;/CN=kube-admin&quot;</span> -out admin.csr
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ ls
admin.csr       admin.key       ca.crt          ca.csr          ca.key
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ 

While creating csr we can specify groups<span class="o">(</span><span class="nv">O</span><span class="o">=</span>system:masters<span class="o">)</span> <span class="k">for</span> k8s admin privileges
like i.e.  openssl req -new -key admin.key -subj <span class="s2">&quot;/CN=kube-admin/O=system:masters&quot;</span> -out admin.csr

<span class="m">3</span>. <span class="s2">&quot;Sign the csr and create crt using with the CA private key and public key(CA keypairs generated in last step)&quot;</span>:
--------------------------------------------------------------------------------------------------------------------&gt;
This make this as valid certificate with <span class="k">in</span> the entire cluster.

MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ openssl x509 -req -in admin.csr -CA ca.crt -CAkey ca.key -out admin.crt
Signature ok
<span class="nv">subject</span><span class="o">=</span>/CN<span class="o">=</span>kube-admin
Getting CA Private Key
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ 
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ ls
admin.crt       admin.csr       admin.key       ca.crt          ca.csr          ca.key          ca.srl
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ 

What we can <span class="k">do</span> with admin.key and admin.crt is we can authenticate kube-apiserver using this private and public keys like below

<span class="s2">&quot;curl https://kube-apiserver:6443/api/v1/pods --key admin.key --cert admin.crt --cacert ca.crt&quot;</span>




Kube-apiserver is kubernetes 
--------------------------------------------------------&gt;
kubernetes
kubernetes.default
kubernetes.default.svc
kubernetes.default.svc.cluster.local


<span class="m">1</span>. <span class="s2">&quot;generate private key&quot;</span>:
-------------------------------------------------------------&gt;
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ openssl genrsa -out apiserver.key <span class="m">2048</span>
Generating RSA private key, <span class="m">2048</span> bit long modulus
..................................................................................................................................+++
.....+++
e is <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ ls
admin.crt       admin.csr       admin.key       apiserver.key   ca.crt          ca.csr          ca.key          ca.srl
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ 


<span class="m">2</span>. <span class="s2">&quot;generate csr with lot of alternative names&quot;</span> using a file called openssl-apiserver.conf
----------------------------------------------------------------------------------------&gt;
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ openssl req -new -key apiserver.key -subj <span class="s2">&quot;/CN=kube-apiserver&quot;</span> -out apiserver.csr -config openssl-apiserver.conf 
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ ls
admin.crt               admin.key               apiserver.key           ca.csr                  ca.srl
admin.csr               apiserver.csr           ca.crt                  ca.key                  openssl-apiserver.conf
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ 


<span class="m">3</span>. <span class="s2">&quot;Sign the csr and create crt using with the CA private key and public key(CA keypairs generated in last step)&quot;</span>:
---------------------------------------------------------------------------------------------------------------------------&gt;
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ openssl x509 -req -in apiserver.csr -CA ca.crt -CAkey ca.key -out apiserver.crt
Signature ok
<span class="nv">subject</span><span class="o">=</span>/CN<span class="o">=</span>kube-apiserver
Getting CA Private Key
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ ls
admin.crt               admin.key               apiserver.csr           ca.crt                  ca.key                  openssl-apiserver.conf
admin.csr               apiserver.crt           apiserver.key           ca.csr                  ca.srl
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ 
</pre></div>
</div>
</div>
<p>certsinetcd</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">certsinetcd</span><a class="headerlink" href="#id10" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1">#Found in the path /etc/kubernetes/manifests</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">creationTimestamp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">component</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">etcd</span>
    <span class="nt">tier</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">control-plane</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">etcd</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">etcd</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--advertise-client-urls=https://172.17.0.17:2379</span>

        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--cert-file=/path-to-certs/etcdserver.crt</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--key-file=/path-to-certs/etcdserver.key</span>

        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--client-cert-auth=true</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--data-dir=/var/lib/etcd</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--initial-advertise-peer-urls=https://172.17.0.17:2380</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--initial-cluster=master=https://172.17.0.17:2380</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--listen-client-urls=https://127.0.0.1:2379,https://172.17.0.17:2379</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--listen-metrics-urls=http://127.0.0.1:2381</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--listen-peer-urls=https://172.17.0.17:2380</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--name=master</span>

        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--peer-cert-file=/path-to-certs/etcdpeer1.crt</span>

        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--peer-client-cert-auth=true</span>

        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--peer-key-file=/path-to-certs/etcdpeer1.key</span>

        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--peer-trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--snapshot-count=10000</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt</span>
      <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">k8s.gcr.io/etcd:3.3.15-0</span>
</pre></div>
</div>
</div>
<p>viewk8scerts</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">viewk8scerts</span><a class="headerlink" href="#id11" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#k8s </span>

<span class="s2">&quot;kube-apiserver&quot;</span>: cat /etc/kubernetes/manifests/kube-apiserver.yaml

MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ openssl x509 -in apiserver.crt -text -noout
Certificate:
    Data:
        Version: <span class="m">1</span> <span class="o">(</span>0x0<span class="o">)</span>
        Serial Number: <span class="m">13415778325770680942</span> <span class="o">(</span>0xba2e6b4eb4f23a6e<span class="o">)</span>
    Signature Algorithm: sha1WithRSAEncryption
        Issuer: <span class="nv">CN</span><span class="o">=</span>KUBERNETES-CA
        Validity
            Not Before: Sep <span class="m">22</span> <span class="m">22</span>:42:58 <span class="m">2021</span> GMT
            Not After : Oct <span class="m">22</span> <span class="m">22</span>:42:58 <span class="m">2021</span> GMT
        Subject: <span class="nv">CN</span><span class="o">=</span>kube-apiserver
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: <span class="o">(</span><span class="m">2048</span> bit<span class="o">)</span>
                Modulus:
                    <span class="m">00</span>:bc:89:64:af:08:09:a0:04:c6:a5:c5:29:d7:10:
                    df:e1:2d:28:a5:1b:3e:77:2a:76:09:17:8e:95:fe:
                    9e:7d:f9:b5:7b:01:7d:88:2e:28:ab:36:f2:f9:b6:
                    dd:84:fb:2f:f4:ce:bc:81:be:6b:df:60:cd:f5:a6:
                    d1:5d:be:09:83:7e:19:ef:52:d2:56:0f:24:bc:8d:
                    <span class="m">74</span>:72:48:fa:e2:fd:63:2f:30:80:3a:3c:d9:41:d7:
                    <span class="m">62</span>:af:84:bb:e6:bb:2e:0b:96:dc:a6:c6:1f:81:ef:
                    c1:31:e7:85:9a:1d:74:0c:c6:3a:c7:04:b2:a1:65:
                    <span class="m">44</span>:e8:1b:8a:b7:c8:f9:d2:7e:e5:3a:45:ef:5e:52:
                    c3:a7:1e:94:4e:4f:c9:0d:77:51:72:31:79:07:65:
                    4c:23:b0:b5:e2:92:eb:1b:8e:ce:14:f4:dd:32:1a:
                    1b:e1:44:ca:e8:e1:4c:84:bb:00:bf:30:d2:42:e3:
                    4f:bd:11:86:96:f2:ce:e7:45:0c:36:aa:09:2f:8a:
                    f3:02:ed:27:1f:25:88:cd:20:64:6e:f5:e6:29:15:
                    <span class="m">84</span>:c9:aa:c8:1e:4a:0e:d5:03:6f:1b:59:a0:b4:d1:
                    b8:77:20:f2:0c:41:fe:a9:69:80:79:81:d2:df:b4:
                    ae:c0:21:e5:cc:e9:be:ea:90:d2:44:1e:c8:38:85:
                    5f:d1
                Exponent: <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
    Signature Algorithm: sha1WithRSAEncryption
         <span class="m">65</span>:8a:0f:cb:41:b7:43:b8:c3:72:1c:cf:2c:a6:c4:64:91:31:
         e5:b2:c0:95:b0:57:14:56:34:a9:fe:d4:41:50:9c:f9:4a:43:
         <span class="m">64</span>:e6:4f:e9:2a:dc:41:9f:79:1b:93:b8:7b:86:16:b1:6f:3f:
         <span class="m">16</span>:4a:c3:f6:f8:ef:33:97:a1:a6:ef:e0:4f:89:45:25:72:be:
         2b:a9:67:a1:97:09:b4:8b:40:e2:b0:b8:41:66:53:ec:9d:a7:
         <span class="m">60</span>:51:66:bd:3d:db:1c:af:7b:fb:71:5d:39:7e:c7:aa:93:07:
         b2:f2:de:f0:6e:67:06:dd:e1:3f:39:4c:f8:2d:26:fd:38:78:
         2f:fe:53:f6:cc:01:17:d6:a2:f2:6e:93:48:8d:b1:07:45:51:
         ca:c7:b9:bf:87:8f:0d:70:cd:5b:64:92:8c:9e:92:d9:56:d7:
         <span class="m">90</span>:2b:fa:9e:b6:03:28:22:f3:6b:9c:71:5a:3d:cb:79:b1:ee:
         d3:8b:57:26:60:1f:85:c4:dd:9d:83:04:6c:75:06:60:92:e1:
         1c:5f:1e:02:82:d1:bf:c7:11:bd:e7:5e:14:18:32:79:74:d1:
         ba:b7:c1:cf:fc:e8:20:ea:fa:77:43:13:79:d9:6d:a9:75:dd:
         f2:4a:24:52:c0:dc:a7:9a:98:01:4d:0a:e6:d1:15:0c:bb:96:
         <span class="m">69</span>:61:07:b9
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$



MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ openssl x509 -in admin.crt -text -noout
Certificate:
    Data:
        Version: <span class="m">1</span> <span class="o">(</span>0x0<span class="o">)</span>
        Serial Number: <span class="m">13415778325770680941</span> <span class="o">(</span>0xba2e6b4eb4f23a6d<span class="o">)</span>
    Signature Algorithm: sha1WithRSAEncryption
        Issuer: <span class="nv">CN</span><span class="o">=</span>KUBERNETES-CA
        Validity
            Not Before: Sep <span class="m">22</span> <span class="m">22</span>:21:45 <span class="m">2021</span> GMT
            Not After : Oct <span class="m">22</span> <span class="m">22</span>:21:45 <span class="m">2021</span> GMT
        Subject: <span class="nv">CN</span><span class="o">=</span>kube-admin
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: <span class="o">(</span><span class="m">2048</span> bit<span class="o">)</span>
                Modulus:
                    <span class="m">00</span>:d3:3e:1f:b3:49:45:a2:9d:b9:f8:8a:3d:79:a8:
                    bb:de:9a:6a:d7:e7:64:e5:3d:2e:1f:3e:0a:a1:21:
                    <span class="m">77</span>:44:a8:6e:37:2a:bd:4e:19:bf:7b:42:d6:49:a1:
                    <span class="m">35</span>:b0:e2:4a:3c:3e:ae:f8:01:9f:52:90:33:07:2f:
                    4e:79:f0:ee:2b:6e:25:f9:db:21:dc:72:e5:16:4b:
                    <span class="m">04</span>:3f:36:0e:26:73:aa:97:50:7a:6f:0f:04:94:00:
                    1f:62:94:cb:2d:29:0d:3b:5e:b5:c6:84:da:65:90:
                    be:1c:96:22:73:cb:60:ac:8e:01:68:7c:2d:26:5e:
                    5d:ec:c3:0e:ff:99:00:53:01:93:cc:18:aa:94:f3:
                    <span class="m">69</span>:cf:29:dc:8a:8c:c6:4a:e0:6c:6e:d0:38:95:3c:
                    cd:43:6f:8c:a8:75:d0:4e:ce:65:40:41:32:5d:3f:
                    <span class="m">83</span>:fc:49:3b:e5:59:44:b1:f3:4e:a9:05:32:86:cf:
                    6e:d6:2a:f3:3e:63:5f:23:ad:e7:ca:1e:d3:b1:30:
                    e1:ee:dc:80:aa:f7:a8:e7:1d:0c:55:ba:d7:9b:e7:
                    <span class="m">31</span>:5a:37:9e:0a:55:df:16:fa:9f:e6:01:6f:c8:a1:
                    <span class="m">47</span>:10:72:d5:fa:6b:2d:6c:48:67:dc:cc:1d:5a:6f:
                    <span class="m">27</span>:f3:8f:6e:57:b1:ef:83:fa:c6:5b:8c:09:ab:f8:
                    <span class="m">32</span>:39
                Exponent: <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
    Signature Algorithm: sha1WithRSAEncryption
         <span class="m">65</span>:14:3e:1a:17:ba:a2:19:da:76:c8:3f:0b:26:5b:a5:59:ee:
         eb:eb:a3:58:56:bc:15:92:b2:fe:a4:cc:8c:f5:a7:53:98:78:
         ee:50:d0:0b:32:68:50:d1:af:7e:6c:f5:fd:b3:02:03:5b:6d:
         <span class="m">87</span>:4c:89:99:19:af:18:ee:3c:d2:52:59:62:24:37:63:f0:df:
         9c:bc:df:0c:dd:d4:8d:d8:cb:3f:d6:f9:45:2b:ca:e1:c1:b5:
         c6:35:f2:5d:4e:e2:40:6c:63:6d:8a:29:b1:08:1d:b7:ba:f6:
         <span class="m">62</span>:61:b3:5d:a9:ff:f2:cb:04:ff:b7:f4:95:ff:86:78:e9:bc:
         dd:6f:0a:0c:9b:25:17:2b:78:1e:51:cd:41:de:09:10:ae:6d:
         <span class="m">04</span>:4f:f4:af:6e:b5:e8:4f:c7:2d:cd:e8:c6:e2:ed:3e:bd:f0:
         <span class="m">78</span>:14:e4:6c:63:cc:2e:9f:f2:84:b0:89:f4:41:2b:23:6c:2c:
         8e:d2:c2:85:2f:70:ed:83:ac:c9:a8:57:09:1d:74:48:af:17:
         b6:64:6f:ed:22:f1:3a:96:19:f0:c6:4c:21:f9:e8:3c:9a:0b:
         dc:86:ea:d2:2a:2f:1c:30:60:3d:13:cc:af:8d:05:04:64:e5:
         4c:79:88:cf:9b:94:dc:8d:29:5c:07:b6:fe:b1:99:1e:b5:a4:
         8b:a7:cb:15
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ 
</pre></div>
</div>
</div>
<p>viewk8scertslabs</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">viewk8scertslabs</span><a class="headerlink" href="#id12" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@controlplane:/etc/kubernetes/pki# ls -rtlh
total 60K
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 ca.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.1K Sep <span class="m">22</span> <span class="m">23</span>:00 ca.crt
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 apiserver.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.3K Sep <span class="m">22</span> <span class="m">23</span>:00 apiserver.crt
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 apiserver-kubelet-client.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.2K Sep <span class="m">22</span> <span class="m">23</span>:00 apiserver-kubelet-client.crt
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 front-proxy-ca.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.1K Sep <span class="m">22</span> <span class="m">23</span>:00 front-proxy-ca.crt
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 front-proxy-client.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.1K Sep <span class="m">22</span> <span class="m">23</span>:00 front-proxy-client.crt
drwxr-xr-x <span class="m">2</span> root root <span class="m">4</span>.0K Sep <span class="m">22</span> <span class="m">23</span>:00 etcd
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 apiserver-etcd-client.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.2K Sep <span class="m">22</span> <span class="m">23</span>:00 apiserver-etcd-client.crt
-rw------- <span class="m">1</span> root root  <span class="m">451</span> Sep <span class="m">22</span> <span class="m">23</span>:00 sa.pub
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 sa.key
root@controlplane:/etc/kubernetes/pki# <span class="nb">pwd</span>
/etc/kubernetes/pki
root@controlplane:/etc/kubernetes/pki# 


Identify the Certificate file used to authenticate kube-apiserver as a client to ETCD Server

root@controlplane:/etc/kubernetes/pki# ls -rlth apiserver-etcd-client.crt
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.2K Sep <span class="m">22</span> <span class="m">23</span>:00 apiserver-etcd-client.crt
root@controlplane:/etc/kubernetes/pki# 

root@controlplane:/etc/kubernetes/pki# ls -rtlh apiserver-kubelet-client.key
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 apiserver-kubelet-client.key
root@controlplane:/etc/kubernetes/pki# 



root@controlplane:/etc/kubernetes/pki/etcd# ls -lrth
total 32K
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 ca.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.1K Sep <span class="m">22</span> <span class="m">23</span>:00 ca.crt
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 server.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.2K Sep <span class="m">22</span> <span class="m">23</span>:00 server.crt
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 peer.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.2K Sep <span class="m">22</span> <span class="m">23</span>:00 peer.crt
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 healthcheck-client.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.2K Sep <span class="m">22</span> <span class="m">23</span>:00 healthcheck-client.crt
root@controlplane:/etc/kubernetes/pki/etcd# 




root@controlplane:/etc/kubernetes/pki# ls -rtlh
total 60K
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 ca.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.1K Sep <span class="m">22</span> <span class="m">23</span>:00 ca.crt
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 apiserver.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.3K Sep <span class="m">22</span> <span class="m">23</span>:00 apiserver.crt
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 apiserver-kubelet-client.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.2K Sep <span class="m">22</span> <span class="m">23</span>:00 apiserver-kubelet-client.crt
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 front-proxy-ca.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.1K Sep <span class="m">22</span> <span class="m">23</span>:00 front-proxy-ca.crt
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 front-proxy-client.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.1K Sep <span class="m">22</span> <span class="m">23</span>:00 front-proxy-client.crt
drwxr-xr-x <span class="m">2</span> root root <span class="m">4</span>.0K Sep <span class="m">22</span> <span class="m">23</span>:00 etcd
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 apiserver-etcd-client.key
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.2K Sep <span class="m">22</span> <span class="m">23</span>:00 apiserver-etcd-client.crt
-rw------- <span class="m">1</span> root root  <span class="m">451</span> Sep <span class="m">22</span> <span class="m">23</span>:00 sa.pub
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">22</span> <span class="m">23</span>:00 sa.key
root@controlplane:/etc/kubernetes/pki# openssl x509 -in apiserver.crt -text -noout
Certificate:
    Data:
        Version: <span class="m">3</span> <span class="o">(</span>0x2<span class="o">)</span>
        Serial Number: <span class="m">5024350321412119082</span> <span class="o">(</span>0x45ba13ff46e39a2a<span class="o">)</span>
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: <span class="nv">CN</span> <span class="o">=</span> kubernetes
        Validity
            Not Before: Sep <span class="m">22</span> <span class="m">23</span>:00:32 <span class="m">2021</span> GMT
            Not After : Sep <span class="m">22</span> <span class="m">23</span>:00:32 <span class="m">2022</span> GMT
        Subject: <span class="nv">CN</span> <span class="o">=</span> kube-apiserver
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: <span class="o">(</span><span class="m">2048</span> bit<span class="o">)</span>
                Modulus:
                    <span class="m">00</span>:c0:88:39:19:19:fa:35:ab:b6:88:32:84:20:8f:
                    0b:73:e1:9f:4f:0c:99:78:ea:66:eb:28:05:1e:06:
                    f0:05:1f:a1:c2:8a:ed:75:c4:79:12:fe:3f:a5:d1:
                    0c:bb:9c:c2:81:2e:fb:c0:fe:9f:1e:a7:56:fb:fd:
                    <span class="m">75</span>:4f:46:54:93:a4:fc:ed:6d:95:1d:e7:b2:10:05:
                    fb:02:e7:9b:9d:9c:f7:b8:68:32:84:a4:e5:38:29:
                    <span class="m">51</span>:51:85:35:b0:45:49:76:9e:7a:09:4a:01:7f:59:
                    <span class="m">91</span>:99:8e:2f:24:a4:12:1e:d5:df:2b:e3:f1:c9:5e:
                    <span class="m">72</span>:4e:67:f9:ab:dc:a7:29:6e:c1:d9:47:70:69:51:
                    <span class="m">62</span>:37:1b:c5:02:7e:b0:9a:26:df:05:bc:09:b9:fb:
                    7a:dc:d4:e7:07:7c:d8:1f:e7:da:81:3a:4c:c4:4f:
                    f7:06:c9:62:0b:3a:af:7a:8c:59:5f:10:6a:1b:4f:
                    c3:64:14:e0:75:b5:83:ff:f1:eb:5d:5d:91:f4:8f:
                    <span class="m">09</span>:ab:a0:5a:2b:ca:66:d2:59:66:cd:73:94:9a:25:
                    9a:8f:ca:e5:c2:8f:59:88:1d:d0:a5:25:64:09:b3:
                    1a:e8:52:12:b1:43:f0:5d:00:a1:75:cb:07:2a:74:
                    4b:c2:95:ae:fe:92:8b:c7:95:d3:9c:2a:38:60:68:
                    d7:45
                Exponent: <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Extended Key Usage: 
                TLS Web Server Authentication
            X509v3 Authority Key Identifier: 
                keyid:A9:72:4F:47:6F:40:07:63:76:67:D3:79:51:92:52:65:E1:C3:14:6D

            X509v3 Subject Alternative Name: 
                DNS:controlplane, DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, IP Address:10.96.0.1, IP Address:10.56.203.8
    Signature Algorithm: sha256WithRSAEncryption
         <span class="m">58</span>:21:ea:22:32:18:21:a5:b0:0a:e9:1e:21:42:71:7f:ab:46:
         <span class="m">49</span>:58:7a:62:2f:7f:a9:5f:bf:a9:c1:69:09:b2:c0:62:ad:71:
         0c:e5:f2:10:8b:2a:94:07:78:d9:7a:1a:b9:17:6b:93:33:ab:
         <span class="m">24</span>:cc:b2:9e:ab:2f:32:ea:36:40:f0:02:df:36:91:76:99:4a:
         <span class="m">07</span>:fc:44:06:8e:c5:07:d0:01:f5:78:9c:55:e3:79:58:56:a6:
         <span class="m">25</span>:63:82:67:ca:27:e7:86:13:06:5a:4a:ea:e7:d5:55:d5:8e:
         <span class="m">82</span>:a5:92:a5:a2:a5:9d:88:06:2c:cb:74:01:fd:f2:9c:6e:1e:
         <span class="m">73</span>:9e:8c:e0:fd:b6:0e:e1:cc:7b:2c:68:fa:34:89:97:89:3e:
         bd:7c:37:6a:6e:28:3f:50:cc:25:7b:94:84:18:b5:85:d2:3f:
         <span class="m">54</span>:b3:54:15:68:c4:5f:36:6a:19:49:f1:2e:3b:a6:94:b7:12:
         <span class="m">97</span>:d1:27:2e:08:12:48:71:1a:8d:aa:b8:f5:70:7f:83:43:27:
         be:88:26:7a:09:b3:3b:a9:f0:c8:89:70:c6:49:cf:e8:75:4f:
         e3:69:f8:9a:8a:8a:9c:89:54:1f:2b:19:3d:df:35:d2:fe:75:
         0b:59:68:97:fa:f9:9a:5b:3b:e5:15:71:2d:6a:46:8f:4e:72:
         <span class="m">07</span>:c4:92:cc
root@controlplane:/etc/kubernetes/pki# 

root@controlplane:/etc/kubernetes/pki# openssl x509 -in apiserver.crt -text -noout <span class="p">|</span> grep -i <span class="s2">&quot;issuer&quot;</span>
        Issuer: <span class="nv">CN</span> <span class="o">=</span> kubernetes
root@controlplane:/etc/kubernetes/pki# 


root@controlplane:/etc/kubernetes/pki# openssl x509 -in ca.crt -text -noout
Certificate:
    Data:
        Version: <span class="m">3</span> <span class="o">(</span>0x2<span class="o">)</span>
        Serial Number: <span class="m">0</span> <span class="o">(</span>0x0<span class="o">)</span>
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: <span class="nv">CN</span> <span class="o">=</span> kubernetes
        Validity
            Not Before: Sep <span class="m">22</span> <span class="m">23</span>:00:32 <span class="m">2021</span> GMT
            Not After : Sep <span class="m">20</span> <span class="m">23</span>:00:32 <span class="m">2031</span> GMT
        Subject: <span class="nv">CN</span> <span class="o">=</span> kubernetes
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: <span class="o">(</span><span class="m">2048</span> bit<span class="o">)</span>
                Modulus:
                    <span class="m">00</span>:9f:3c:af:c3:a2:5f:61:7d:a0:32:38:b3:e0:84:
                    2e:d8:a9:e3:db:40:74:ab:86:d2:02:33:bc:78:34:
                    0b:30:0e:73:f6:b8:af:17:cb:1c:64:29:69:c9:a2:
                    <span class="m">78</span>:8a:a2:a5:b5:db:3f:b0:e8:33:2e:30:13:16:8a:
                    <span class="m">55</span>:fe:9d:90:54:7f:d3:2e:7a:a8:2f:12:93:8b:44:
                    <span class="m">50</span>:8e:24:f9:f0:e4:d4:1c:6d:f1:7f:a0:ad:f8:78:
                    <span class="m">40</span>:2c:ad:8f:5e:71:02:08:11:55:ce:de:0f:33:7a:
                    fe:3e:cc:40:e6:ff:46:3d:21:77:e5:dc:0a:6e:a2:
                    f7:1f:e2:f8:e1:0e:e9:99:aa:d2:51:4e:b6:7e:83:
                    0e:6f:df:b6:dd:e8:6d:b8:4c:bf:d0:b0:ba:f2:5b:
                    3d:8d:63:ec:9f:e7:ba:44:14:9e:ac:52:22:e1:02:
                    ea:bc:63:b0:c8:6a:8b:00:a7:98:f7:d0:63:33:d9:
                    df:14:ca:c0:2f:ec:dd:27:3a:51:47:01:5c:7b:02:
                    <span class="m">27</span>:76:32:83:24:6a:13:f6:9a:89:f3:e5:d8:40:3f:
                    9f:3e:5e:40:e5:22:38:2c:9a:dc:d2:2e:d6:56:24:
                    c3:a3:61:4b:57:c1:09:ec:89:95:ca:1d:97:06:14:
                    ad:6c:ad:a6:21:03:25:48:94:92:d4:4c:7e:f6:27:
                    9c:a1
                Exponent: <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment, Certificate Sign
            X509v3 Basic Constraints: critical
                CA:TRUE
            X509v3 Subject Key Identifier: 
                A9:72:4F:47:6F:40:07:63:76:67:D3:79:51:92:52:65:E1:C3:14:6D
    Signature Algorithm: sha256WithRSAEncryption
         <span class="m">42</span>:e0:22:33:fc:7a:21:00:94:e5:66:7b:f7:59:27:42:3a:c5:
         4f:e8:54:90:3a:7d:24:f1:29:5f:ed:e1:04:ff:e0:e5:cf:75:
         be:46:f0:90:2b:97:c5:cd:10:20:8c:95:a6:ee:b5:29:81:e7:
         d7:81:e7:89:09:02:97:a3:6f:c4:33:bd:03:fa:49:a7:1d:0f:
         <span class="m">47</span>:d1:a4:58:af:5c:22:4c:71:e2:89:a0:6d:39:bf:27:60:89:
         <span class="m">42</span>:7d:74:7d:68:b6:19:b2:28:90:b5:d6:57:e5:be:31:a6:55:
         <span class="m">11</span>:b6:7a:35:21:38:09:f3:cb:93:09:12:f1:42:c6:d3:78:33:
         <span class="m">05</span>:05:55:b1:a1:c7:1b:3d:71:af:5a:c9:6f:ef:e0:44:52:73:
         <span class="m">49</span>:92:14:11:ae:49:92:b2:40:b1:85:20:88:12:82:5d:bc:c5:
         <span class="m">28</span>:ca:c5:03:23:30:10:3e:ea:b6:44:3d:dc:90:e4:7d:17:35:
         d0:35:f4:55:a0:0b:50:13:c2:11:8b:5f:21:ae:48:11:b8:52:
         e9:f8:25:c2:d1:1a:f5:6c:6f:91:31:5b:aa:c8:79:e2:ec:f0:
         <span class="m">29</span>:d9:d4:c0:b3:f0:fc:bb:d7:e8:be:ca:ad:da:82:51:9b:75:
         <span class="m">60</span>:45:0f:68:29:0b:e3:f4:1e:b8:8b:6e:2e:18:ea:48:98:c7:
         <span class="m">50</span>:06:43:62
root@controlplane:/etc/kubernetes/pki#





root@controlplane:/etc/kubernetes/pki/etcd# openssl x509 -in server.crt -text -noout 
Certificate:
    Data:
        Version: <span class="m">3</span> <span class="o">(</span>0x2<span class="o">)</span>
        Serial Number: <span class="m">3888003370887390627</span> <span class="o">(</span>0x35f4f6775f43a5a3<span class="o">)</span>
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: <span class="nv">CN</span> <span class="o">=</span> etcd-ca
        Validity
            Not Before: Sep <span class="m">22</span> <span class="m">23</span>:00:34 <span class="m">2021</span> GMT
            Not After : Sep <span class="m">22</span> <span class="m">23</span>:00:34 <span class="m">2022</span> GMT
        Subject: <span class="nv">CN</span> <span class="o">=</span> controlplane
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: <span class="o">(</span><span class="m">2048</span> bit<span class="o">)</span>
                Modulus:
                    <span class="m">00</span>:a7:7b:fb:12:fa:e8:20:66:00:46:2c:36:0a:6d:
                    <span class="m">66</span>:2f:d1:b0:41:76:da:6b:35:5e:c0:82:cb:ba:32:
                    b2:46:1d:1d:d6:44:5e:34:9c:fe:56:a1:72:ee:29:
                    f0:91:ea:22:4c:6c:2e:91:59:ff:88:8e:0b:ef:89:
                    2c:8b:b5:e5:4d:ee:bf:79:ea:50:49:c0:fc:8b:f1:
                    <span class="m">33</span>:11:25:b6:ef:e7:aa:55:2c:83:40:b4:64:1e:a3:
                    7c:a5:61:6a:d9:e7:87:2b:a3:4f:35:74:5c:c4:84:
                    <span class="m">99</span>:20:9b:ae:51:d5:71:cc:a3:84:c8:71:83:d5:1e:
                    5e:af:c6:46:e3:f3:3f:5a:ae:c8:b5:8e:cf:7f:a5:
                    2b:64:96:ce:93:8d:6f:a7:1c:d7:7e:91:5c:7a:e7:
                    5f:44:23:52:9e:66:15:81:93:34:19:6f:89:94:76:
                    <span class="m">48</span>:98:25:56:73:12:3d:a9:3b:b6:e1:23:ad:70:df:
                    <span class="m">50</span>:d9:9d:a1:39:18:75:94:1c:38:29:25:1e:41:30:
                    ad:ec:8d:0a:44:07:ec:27:d7:31:68:6e:9b:25:dd:
                    c7:b6:74:25:64:55:94:b5:ea:e3:f4:54:ec:96:49:
                    <span class="m">33</span>:18:ee:59:3f:3e:7d:ce:78:8b:8b:39:37:6e:13:
                    a3:77:ef:0b:77:bf:90:8c:eb:1d:4b:f9:2e:fe:a7:
                    <span class="m">14</span>:6f
                Exponent: <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Extended Key Usage: 
                TLS Web Server Authentication, TLS Web Client Authentication
            X509v3 Authority Key Identifier: 
                keyid:49:94:05:BA:D9:64:3B:11:41:D9:1D:3A:0D:DF:1A:9C:DC:63:38:2F

            X509v3 Subject Alternative Name: 
                DNS:controlplane, DNS:localhost, IP Address:10.56.203.8, IP Address:127.0.0.1, IP Address:0:0:0:0:0:0:0:1
    Signature Algorithm: sha256WithRSAEncryption
         <span class="m">21</span>:bb:d7:25:c3:ef:3f:2c:ea:ff:f2:91:db:e1:12:e4:c6:8d:
         <span class="m">02</span>:42:02:74:37:a3:a3:0a:2d:b3:a6:52:71:02:d9:5f:0d:22:
         6c:d9:49:ce:ec:70:81:c7:dc:b9:0a:0a:80:fb:59:72:6a:af:
         1b:7f:00:2b:16:d0:d9:65:1f:40:5a:a2:ca:e1:2b:3d:24:68:
         <span class="m">90</span>:df:88:18:03:87:5e:c4:3b:ae:58:3b:16:34:39:18:67:1a:
         e1:71:9b:8b:02:9b:93:d2:d0:7f:a9:33:c1:11:23:e5:30:34:
         <span class="m">04</span>:31:87:4b:b5:fe:41:c6:b8:86:2c:33:0d:9c:09:11:fc:a3:
         <span class="m">35</span>:fd:3a:d0:6b:c8:ec:ac:a7:c4:d6:3a:2e:51:9b:2a:3d:89:
         ee:ae:56:cf:1b:51:f1:78:57:58:2f:99:86:6c:e1:c5:9b:e2:
         <span class="m">85</span>:e4:8f:30:cd:e8:07:6b:9b:b5:fb:62:93:38:1d:52:ba:2d:
         <span class="m">85</span>:80:b8:df:b3:c3:bc:22:fb:c0:b2:35:8f:df:c2:d3:77:d0:
         4d:43:5d:66:08:dd:19:b1:3a:bf:49:f5:15:e1:82:7a:6b:38:
         e1:f0:40:d1:24:e1:3e:ea:f6:a2:e4:f0:fd:5f:11:76:97:c0:
         4d:17:12:b8:dd:09:0f:c8:6e:6f:c9:a6:d5:f2:1b:0c:6a:6d:
         a9:11:a3:cc
root@controlplane:/etc/kubernetes/pki/etcd# 



root@controlplane:/etc/kubernetes/pki/etcd# openssl x509 -in ../apiserver.crt -text -noout
Certificate:
    Data:
        Version: <span class="m">3</span> <span class="o">(</span>0x2<span class="o">)</span>
        Serial Number: <span class="m">5024350321412119082</span> <span class="o">(</span>0x45ba13ff46e39a2a<span class="o">)</span>
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: <span class="nv">CN</span> <span class="o">=</span> kubernetes
        Validity
            Not Before: Sep <span class="m">22</span> <span class="m">23</span>:00:32 <span class="m">2021</span> GMT
            Not After : Sep <span class="m">22</span> <span class="m">23</span>:00:32 <span class="m">2022</span> GMT
        Subject: <span class="nv">CN</span> <span class="o">=</span> kube-apiserver
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: <span class="o">(</span><span class="m">2048</span> bit<span class="o">)</span>
                Modulus:
                    <span class="m">00</span>:c0:88:39:19:19:fa:35:ab:b6:88:32:84:20:8f:
                    0b:73:e1:9f:4f:0c:99:78:ea:66:eb:28:05:1e:06:
                    f0:05:1f:a1:c2:8a:ed:75:c4:79:12:fe:3f:a5:d1:
                    0c:bb:9c:c2:81:2e:fb:c0:fe:9f:1e:a7:56:fb:fd:
                    <span class="m">75</span>:4f:46:54:93:a4:fc:ed:6d:95:1d:e7:b2:10:05:
                    fb:02:e7:9b:9d:9c:f7:b8:68:32:84:a4:e5:38:29:
                    <span class="m">51</span>:51:85:35:b0:45:49:76:9e:7a:09:4a:01:7f:59:
                    <span class="m">91</span>:99:8e:2f:24:a4:12:1e:d5:df:2b:e3:f1:c9:5e:
                    <span class="m">72</span>:4e:67:f9:ab:dc:a7:29:6e:c1:d9:47:70:69:51:
                    <span class="m">62</span>:37:1b:c5:02:7e:b0:9a:26:df:05:bc:09:b9:fb:
                    7a:dc:d4:e7:07:7c:d8:1f:e7:da:81:3a:4c:c4:4f:
                    f7:06:c9:62:0b:3a:af:7a:8c:59:5f:10:6a:1b:4f:
                    c3:64:14:e0:75:b5:83:ff:f1:eb:5d:5d:91:f4:8f:
                    <span class="m">09</span>:ab:a0:5a:2b:ca:66:d2:59:66:cd:73:94:9a:25:
                    9a:8f:ca:e5:c2:8f:59:88:1d:d0:a5:25:64:09:b3:
                    1a:e8:52:12:b1:43:f0:5d:00:a1:75:cb:07:2a:74:
                    4b:c2:95:ae:fe:92:8b:c7:95:d3:9c:2a:38:60:68:
                    d7:45
                Exponent: <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Extended Key Usage: 
                TLS Web Server Authentication
            X509v3 Authority Key Identifier: 
                keyid:A9:72:4F:47:6F:40:07:63:76:67:D3:79:51:92:52:65:E1:C3:14:6D

            X509v3 Subject Alternative Name: 
                DNS:controlplane, DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, IP Address:10.96.0.1, IP Address:10.56.203.8
    Signature Algorithm: sha256WithRSAEncryption
         <span class="m">58</span>:21:ea:22:32:18:21:a5:b0:0a:e9:1e:21:42:71:7f:ab:46:
         <span class="m">49</span>:58:7a:62:2f:7f:a9:5f:bf:a9:c1:69:09:b2:c0:62:ad:71:
         0c:e5:f2:10:8b:2a:94:07:78:d9:7a:1a:b9:17:6b:93:33:ab:
         <span class="m">24</span>:cc:b2:9e:ab:2f:32:ea:36:40:f0:02:df:36:91:76:99:4a:
         <span class="m">07</span>:fc:44:06:8e:c5:07:d0:01:f5:78:9c:55:e3:79:58:56:a6:
         <span class="m">25</span>:63:82:67:ca:27:e7:86:13:06:5a:4a:ea:e7:d5:55:d5:8e:
         <span class="m">82</span>:a5:92:a5:a2:a5:9d:88:06:2c:cb:74:01:fd:f2:9c:6e:1e:
         <span class="m">73</span>:9e:8c:e0:fd:b6:0e:e1:cc:7b:2c:68:fa:34:89:97:89:3e:
         bd:7c:37:6a:6e:28:3f:50:cc:25:7b:94:84:18:b5:85:d2:3f:
         <span class="m">54</span>:b3:54:15:68:c4:5f:36:6a:19:49:f1:2e:3b:a6:94:b7:12:
         <span class="m">97</span>:d1:27:2e:08:12:48:71:1a:8d:aa:b8:f5:70:7f:83:43:27:
         be:88:26:7a:09:b3:3b:a9:f0:c8:89:70:c6:49:cf:e8:75:4f:
         e3:69:f8:9a:8a:8a:9c:89:54:1f:2b:19:3d:df:35:d2:fe:75:
         0b:59:68:97:fa:f9:9a:5b:3b:e5:15:71:2d:6a:46:8f:4e:72:
         <span class="m">07</span>:c4:92:cc
root@controlplane:/etc/kubernetes/pki/etcd# 



root@controlplane:/etc/kubernetes/pki/etcd# openssl x509 -in ../ca.crt -text -noout 
Certificate:
    Data:
        Version: <span class="m">3</span> <span class="o">(</span>0x2<span class="o">)</span>
        Serial Number: <span class="m">0</span> <span class="o">(</span>0x0<span class="o">)</span>
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: <span class="nv">CN</span> <span class="o">=</span> kubernetes
        Validity
            Not Before: Sep <span class="m">22</span> <span class="m">23</span>:00:32 <span class="m">2021</span> GMT
            Not After : Sep <span class="m">20</span> <span class="m">23</span>:00:32 <span class="m">2031</span> GMT
        Subject: <span class="nv">CN</span> <span class="o">=</span> kubernetes
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: <span class="o">(</span><span class="m">2048</span> bit<span class="o">)</span>
                Modulus:
                    <span class="m">00</span>:9f:3c:af:c3:a2:5f:61:7d:a0:32:38:b3:e0:84:
                    2e:d8:a9:e3:db:40:74:ab:86:d2:02:33:bc:78:34:
                    0b:30:0e:73:f6:b8:af:17:cb:1c:64:29:69:c9:a2:
                    <span class="m">78</span>:8a:a2:a5:b5:db:3f:b0:e8:33:2e:30:13:16:8a:
                    <span class="m">55</span>:fe:9d:90:54:7f:d3:2e:7a:a8:2f:12:93:8b:44:
                    <span class="m">50</span>:8e:24:f9:f0:e4:d4:1c:6d:f1:7f:a0:ad:f8:78:
                    <span class="m">40</span>:2c:ad:8f:5e:71:02:08:11:55:ce:de:0f:33:7a:
                    fe:3e:cc:40:e6:ff:46:3d:21:77:e5:dc:0a:6e:a2:
                    f7:1f:e2:f8:e1:0e:e9:99:aa:d2:51:4e:b6:7e:83:
                    0e:6f:df:b6:dd:e8:6d:b8:4c:bf:d0:b0:ba:f2:5b:
                    3d:8d:63:ec:9f:e7:ba:44:14:9e:ac:52:22:e1:02:
                    ea:bc:63:b0:c8:6a:8b:00:a7:98:f7:d0:63:33:d9:
                    df:14:ca:c0:2f:ec:dd:27:3a:51:47:01:5c:7b:02:
                    <span class="m">27</span>:76:32:83:24:6a:13:f6:9a:89:f3:e5:d8:40:3f:
                    9f:3e:5e:40:e5:22:38:2c:9a:dc:d2:2e:d6:56:24:
                    c3:a3:61:4b:57:c1:09:ec:89:95:ca:1d:97:06:14:
                    ad:6c:ad:a6:21:03:25:48:94:92:d4:4c:7e:f6:27:
                    9c:a1
                Exponent: <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment, Certificate Sign
            X509v3 Basic Constraints: critical
                CA:TRUE
            X509v3 Subject Key Identifier: 
                A9:72:4F:47:6F:40:07:63:76:67:D3:79:51:92:52:65:E1:C3:14:6D
    Signature Algorithm: sha256WithRSAEncryption
         <span class="m">42</span>:e0:22:33:fc:7a:21:00:94:e5:66:7b:f7:59:27:42:3a:c5:
         4f:e8:54:90:3a:7d:24:f1:29:5f:ed:e1:04:ff:e0:e5:cf:75:
         be:46:f0:90:2b:97:c5:cd:10:20:8c:95:a6:ee:b5:29:81:e7:
         d7:81:e7:89:09:02:97:a3:6f:c4:33:bd:03:fa:49:a7:1d:0f:
         <span class="m">47</span>:d1:a4:58:af:5c:22:4c:71:e2:89:a0:6d:39:bf:27:60:89:
         <span class="m">42</span>:7d:74:7d:68:b6:19:b2:28:90:b5:d6:57:e5:be:31:a6:55:
         <span class="m">11</span>:b6:7a:35:21:38:09:f3:cb:93:09:12:f1:42:c6:d3:78:33:
         <span class="m">05</span>:05:55:b1:a1:c7:1b:3d:71:af:5a:c9:6f:ef:e0:44:52:73:
         <span class="m">49</span>:92:14:11:ae:49:92:b2:40:b1:85:20:88:12:82:5d:bc:c5:
         <span class="m">28</span>:ca:c5:03:23:30:10:3e:ea:b6:44:3d:dc:90:e4:7d:17:35:
         d0:35:f4:55:a0:0b:50:13:c2:11:8b:5f:21:ae:48:11:b8:52:
         e9:f8:25:c2:d1:1a:f5:6c:6f:91:31:5b:aa:c8:79:e2:ec:f0:
         <span class="m">29</span>:d9:d4:c0:b3:f0:fc:bb:d7:e8:be:ca:ad:da:82:51:9b:75:
         <span class="m">60</span>:45:0f:68:29:0b:e3:f4:1e:b8:8b:6e:2e:18:ea:48:98:c7:
         <span class="m">50</span>:06:43:62
root@controlplane:/etc/kubernetes/pki/etcd# 
</pre></div>
</div>
</div>
<p>getcsr</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">getcsr</span><a class="headerlink" href="#id13" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">certificates.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CertificateSigningRequest</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bharath</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">groups</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">system:authenticated</span>
  <span class="nt">usages</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">digital signature</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">key encipherment</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">server auth</span>
  <span class="nt">request</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ1Z6Q0NBVDhDQVFBd0VqRVFNQTRHQTFVRUF3d0hZbWhoY21GMGFEQ0NBU0l3RFFZSktvWklodmNOQVFFQgpCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFPZ0tPR1UvUU9nTlRoeW1ucTl4VzBwREZSdnk0UG5uUERkYmF2RExIaTZnCjQ3dWpjYnFWY3MyYmdHbWlNdWlhTFQzV01YaVB4eFRjWXFKZDYvSGEyc1hBbXZLQUtVZTVpNUJRM093cTNrVncKbnBFN2xDczVOWWRzT25XYWVPRnBVbzJQMno0eDEzYzBPY2UxRms2UjNwZDdaSzlReWxqVEVxeVJhZ2ZVSEo0TQowak04V21mRHRmTXdWTlRRQzErYjVUdmRINmxhSTJMeXhjRFFzS3pYMUdLNW5WTDNaeS84NEM1NUlYL0Q4QTRNCnBxaVJtSXV1QTV3U0dhRnV5bEpGdGFXc2g0WHVpTytoRHdHNU8wcVdOeDkzaDBEZkFkb0JmZHVDb0k3RjdQU3oKcEtGQnBZdnFzc3hZcWJOTnJJRVhxZ3k4MUF1SU41VG83Wi9PUGYwb0Q2Y0NBd0VBQWFBQU1BMEdDU3FHU0liMwpEUUVCQ3dVQUE0SUJBUUJGcXFxYkJsOXFqWWhZTm1BTCtKb0NxSFozUTF2Qnpoa1owNWJnb1NPVUxVTHBNRUYyCmlnZ2JvSlRxQWY5NmU0OVlDRE1vaUlWUUg1K2JIT0hzMDBpRzFFK0FscEkwNVNGczVXRkh6bDFSMFJqdmpxWnYKcm1UcjFhWWpGeUh4dHBseGdqNnowQy8vYVZreEI1NnY2UklCQ0xLUkwzTmRUaWdHcE4rc2xTNmVtRjNic0lrbwp6T3VHYUg5TElSTllVL3BuRnJBcFpCU25vWElGa2M4WHRwS29IakttMDVmOUZZMlJseHhHdVl5bjZ0c2o2WGNkCnhsM1owWXI3cGoyWWVJdS9sWXNXcGdIalZsWHFZbVpIQWJVL1VwTll3ZzR3ZVRNRHVUWmQ0YUwwRVpQcGc2clkKKzFEckdHODFaeDZWbUhXa2xWTXdDUDkvQXZ2VlhqaWlHdVNBCi0tLS0tRU5EIENFUlRJRklDQVRFIFJFUVVFU1QtLS0tLQo=</span>
</pre></div>
</div>
</div>
<p>k8scertAPI</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">k8scertAPI</span><a class="headerlink" href="#id14" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Certificate workflow and API

<span class="m">1</span>. API Object: Create  CertificateSigningRequest Object
<span class="m">2</span>. Review Requests
<span class="m">3</span>. Approve Requests


Example:
------------&gt;
<span class="m">1</span>. A user first creates a key. and <span class="k">then</span> generates a certificate signing request with his name on it.

MacBook-Pro:6.Security bharathdasaraju$ <span class="nb">cd</span> generate_tls_for_kubernetes/
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ openssl genrsa -out bharath.key <span class="m">2048</span>
Generating RSA private key, <span class="m">2048</span> bit long modulus
..................................+++
...............+++
e is <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ openssl req -new -key bharath.key -subj <span class="s2">&quot;/CN=bharath&quot;</span> -out bharath.csr
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ ls
admin.crt               admin.key               apiserver.csr           bharath.csr             ca.crt                  ca.key                  openssl-apiserver.conf
admin.csr               apiserver.crt           apiserver.key           bharath.key             ca.csr                  ca.srl
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ 



<span class="m">2</span>. Then sends the request to the administrator. the administrator takes the key and creates a <span class="s2">&quot;CertificateSigningRequest&quot;</span> object.

The <span class="s2">&quot;CertificateSigningRequest&quot;</span> is created like any other kubernetes object using a manifest file with the usual fields.
The kind is <span class="s2">&quot;CertificateSigningRequest&quot;</span> under the spec section,
specify the groups the user should be part of and list the usages of the account as list of strings.

the request filed is where you specify the certificate signing request sent by the user.
But you wont specify as plain text, instead it must be encoded using the base64 command<span class="o">(</span>as below<span class="o">)</span> <span class="k">then</span> move the encoded text into the requeast field.
and <span class="k">then</span> submit the request.

MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ cat bharath.csr <span class="p">|</span> base64
<span class="nv">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ1Z6Q0NBVDhDQVFBd0VqRVFNQTRHQTFVRUF3d0hZbWhoY21GMGFEQ0NBU0l3RFFZSktvWklodmNOQVFFQgpCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFPZ0tPR1UvUU9nTlRoeW1ucTl4VzBwREZSdnk0UG5uUERkYmF2RExIaTZnCjQ3dWpjYnFWY3MyYmdHbWlNdWlhTFQzV01YaVB4eFRjWXFKZDYvSGEyc1hBbXZLQUtVZTVpNUJRM093cTNrVncKbnBFN2xDczVOWWRzT25XYWVPRnBVbzJQMno0eDEzYzBPY2UxRms2UjNwZDdaSzlReWxqVEVxeVJhZ2ZVSEo0TQowak04V21mRHRmTXdWTlRRQzErYjVUdmRINmxhSTJMeXhjRFFzS3pYMUdLNW5WTDNaeS84NEM1NUlYL0Q4QTRNCnBxaVJtSXV1QTV3U0dhRnV5bEpGdGFXc2g0WHVpTytoRHdHNU8wcVdOeDkzaDBEZkFkb0JmZHVDb0k3RjdQU3oKcEtGQnBZdnFzc3hZcWJOTnJJRVhxZ3k4MUF1SU41VG83Wi9PUGYwb0Q2Y0NBd0VBQWFBQU1BMEdDU3FHU0liMwpEUUVCQ3dVQUE0SUJBUUJGcXFxYkJsOXFqWWhZTm1BTCtKb0NxSFozUTF2Qnpoa1owNWJnb1NPVUxVTHBNRUYyCmlnZ2JvSlRxQWY5NmU0OVlDRE1vaUlWUUg1K2JIT0hzMDBpRzFFK0FscEkwNVNGczVXRkh6bDFSMFJqdmpxWnYKcm1UcjFhWWpGeUh4dHBseGdqNnowQy8vYVZreEI1NnY2UklCQ0xLUkwzTmRUaWdHcE4rc2xTNmVtRjNic0lrbwp6T3VHYUg5TElSTllVL3BuRnJBcFpCU25vWElGa2M4WHRwS29IakttMDVmOUZZMlJseHhHdVl5bjZ0c2o2WGNkCnhsM1owWXI3cGoyWWVJdS9sWXNXcGdIalZsWHFZbVpIQWJVL1VwTll3ZzR3ZVRNRHVUWmQ0YUwwRVpQcGc2clkKKzFEckdHODFaeDZWbUhXa2xWTXdDUDkvQXZ2VlhqaWlHdVNBCi0tLS0tRU5EIENFUlRJRklDQVRFIFJFUVVFU1QtLS0tLQo</span><span class="o">=</span>
MacBook-Pro:generate_tls_for_kubernetes bharathdasaraju$ 

MacBook-Pro:6.Security bharathdasaraju$ kubectl apply -f CertificateSigningRequest.yaml 
Warning: certificates.k8s.io/v1beta1 CertificateSigningRequest is deprecated <span class="k">in</span> v1.19+, unavailable <span class="k">in</span> v1.22+<span class="p">;</span> use certificates.k8s.io/v1 CertificateSigningRequest
certificatesigningrequest.certificates.k8s.io/bharath created
MacBook-Pro:6.Security bharathdasaraju$ kubectl get csr
NAME      AGE   SIGNERNAME                     REQUESTOR       CONDITION
bharath   11s   kubernetes.io/legacy-unknown   minikube-user   Pending
MacBook-Pro:6.Security bharathdasaraju$ 

MacBook-Pro:6.Security bharathdasaraju$ kubectl get csr
NAME      AGE   SIGNERNAME                     REQUESTOR       CONDITION
bharath   11s   kubernetes.io/legacy-unknown   minikube-user   Pending
MacBook-Pro:6.Security bharathdasaraju$ 
MacBook-Pro:6.Security bharathdasaraju$ kubectl certificate approve bharath
certificatesigningrequest.certificates.k8s.io/bharath approved
MacBook-Pro:6.Security bharathdasaraju$ kubectl get csr
NAME      AGE   SIGNERNAME                     REQUESTOR       CONDITION
bharath   51s   kubernetes.io/legacy-unknown   minikube-user   Approved,Issued
MacBook-Pro:6.Security bharathdasaraju$ 


MacBook-Pro:6.Security bharathdasaraju$ kubectl get csr bharath -o yaml
apiVersion: certificates.k8s.io/v1
kind: CertificateSigningRequest
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: <span class="p">|</span>
      <span class="o">{</span><span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;certificates.k8s.io/v1beta1&quot;</span>,<span class="s2">&quot;kind&quot;</span>:<span class="s2">&quot;CertificateSigningRequest&quot;</span>,<span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;annotations&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;bharath&quot;</span><span class="o">}</span>,<span class="s2">&quot;spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;groups&quot;</span>:<span class="o">[</span><span class="s2">&quot;system:authenticated&quot;</span><span class="o">]</span>,<span class="s2">&quot;request&quot;</span>:<span class="s2">&quot;LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ1Z6Q0NBVDhDQVFBd0VqRVFNQTRHQTFVRUF3d0hZbWhoY21GMGFEQ0NBU0l3RFFZSktvWklodmNOQVFFQgpCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFPZ0tPR1UvUU9nTlRoeW1ucTl4VzBwREZSdnk0UG5uUERkYmF2RExIaTZnCjQ3dWpjYnFWY3MyYmdHbWlNdWlhTFQzV01YaVB4eFRjWXFKZDYvSGEyc1hBbXZLQUtVZTVpNUJRM093cTNrVncKbnBFN2xDczVOWWRzT25XYWVPRnBVbzJQMno0eDEzYzBPY2UxRms2UjNwZDdaSzlReWxqVEVxeVJhZ2ZVSEo0TQowak04V21mRHRmTXdWTlRRQzErYjVUdmRINmxhSTJMeXhjRFFzS3pYMUdLNW5WTDNaeS84NEM1NUlYL0Q4QTRNCnBxaVJtSXV1QTV3U0dhRnV5bEpGdGFXc2g0WHVpTytoRHdHNU8wcVdOeDkzaDBEZkFkb0JmZHVDb0k3RjdQU3oKcEtGQnBZdnFzc3hZcWJOTnJJRVhxZ3k4MUF1SU41VG83Wi9PUGYwb0Q2Y0NBd0VBQWFBQU1BMEdDU3FHU0liMwpEUUVCQ3dVQUE0SUJBUUJGcXFxYkJsOXFqWWhZTm1BTCtKb0NxSFozUTF2Qnpoa1owNWJnb1NPVUxVTHBNRUYyCmlnZ2JvSlRxQWY5NmU0OVlDRE1vaUlWUUg1K2JIT0hzMDBpRzFFK0FscEkwNVNGczVXRkh6bDFSMFJqdmpxWnYKcm1UcjFhWWpGeUh4dHBseGdqNnowQy8vYVZreEI1NnY2UklCQ0xLUkwzTmRUaWdHcE4rc2xTNmVtRjNic0lrbwp6T3VHYUg5TElSTllVL3BuRnJBcFpCU25vWElGa2M4WHRwS29IakttMDVmOUZZMlJseHhHdVl5bjZ0c2o2WGNkCnhsM1owWXI3cGoyWWVJdS9sWXNXcGdIalZsWHFZbVpIQWJVL1VwTll3ZzR3ZVRNRHVUWmQ0YUwwRVpQcGc2clkKKzFEckdHODFaeDZWbUhXa2xWTXdDUDkvQXZ2VlhqaWlHdVNBCi0tLS0tRU5EIENFUlRJRklDQVRFIFJFUVVFU1QtLS0tLQo=&quot;</span>,<span class="s2">&quot;usages&quot;</span>:<span class="o">[</span><span class="s2">&quot;digital signature&quot;</span>,<span class="s2">&quot;key encipherment&quot;</span>,<span class="s2">&quot;server auth&quot;</span><span class="o">]}}</span>
  creationTimestamp: <span class="s2">&quot;2021-09-22T23:53:45Z&quot;</span>
  managedFields:
  - apiVersion: certificates.k8s.io/v1beta1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:annotations:
          .: <span class="o">{}</span>
          f:kubectl.kubernetes.io/last-applied-configuration: <span class="o">{}</span>
      f:spec:
        f:groups: <span class="o">{}</span>
        f:request: <span class="o">{}</span>
        f:signerName: <span class="o">{}</span>
        f:usages: <span class="o">{}</span>
    manager: kubectl-client-side-apply
    operation: Update
    time: <span class="s2">&quot;2021-09-22T23:53:45Z&quot;</span>
  - apiVersion: certificates.k8s.io/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:status:
        f:certificate: <span class="o">{}</span>
    manager: kube-controller-manager
    operation: Update
    time: <span class="s2">&quot;2021-09-22T23:54:33Z&quot;</span>
  - apiVersion: certificates.k8s.io/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:status:
        f:conditions:
          .: <span class="o">{}</span>
          k:<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;Approved&quot;</span><span class="o">}</span>:
            .: <span class="o">{}</span>
            f:lastTransitionTime: <span class="o">{}</span>
            f:lastUpdateTime: <span class="o">{}</span>
            f:message: <span class="o">{}</span>
            f:reason: <span class="o">{}</span>
            f:status: <span class="o">{}</span>
            f:type: <span class="o">{}</span>
    manager: kubectl
    operation: Update
    time: <span class="s2">&quot;2021-09-22T23:54:33Z&quot;</span>
  name: bharath
  resourceVersion: <span class="s2">&quot;121875&quot;</span>
  uid: dcdbbadd-fb6a-489f-86dc-47dd868b9a33
spec:
  groups:
  - system:masters
  - system:authenticated
  request: <span class="nv">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ1Z6Q0NBVDhDQVFBd0VqRVFNQTRHQTFVRUF3d0hZbWhoY21GMGFEQ0NBU0l3RFFZSktvWklodmNOQVFFQgpCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFPZ0tPR1UvUU9nTlRoeW1ucTl4VzBwREZSdnk0UG5uUERkYmF2RExIaTZnCjQ3dWpjYnFWY3MyYmdHbWlNdWlhTFQzV01YaVB4eFRjWXFKZDYvSGEyc1hBbXZLQUtVZTVpNUJRM093cTNrVncKbnBFN2xDczVOWWRzT25XYWVPRnBVbzJQMno0eDEzYzBPY2UxRms2UjNwZDdaSzlReWxqVEVxeVJhZ2ZVSEo0TQowak04V21mRHRmTXdWTlRRQzErYjVUdmRINmxhSTJMeXhjRFFzS3pYMUdLNW5WTDNaeS84NEM1NUlYL0Q4QTRNCnBxaVJtSXV1QTV3U0dhRnV5bEpGdGFXc2g0WHVpTytoRHdHNU8wcVdOeDkzaDBEZkFkb0JmZHVDb0k3RjdQU3oKcEtGQnBZdnFzc3hZcWJOTnJJRVhxZ3k4MUF1SU41VG83Wi9PUGYwb0Q2Y0NBd0VBQWFBQU1BMEdDU3FHU0liMwpEUUVCQ3dVQUE0SUJBUUJGcXFxYkJsOXFqWWhZTm1BTCtKb0NxSFozUTF2Qnpoa1owNWJnb1NPVUxVTHBNRUYyCmlnZ2JvSlRxQWY5NmU0OVlDRE1vaUlWUUg1K2JIT0hzMDBpRzFFK0FscEkwNVNGczVXRkh6bDFSMFJqdmpxWnYKcm1UcjFhWWpGeUh4dHBseGdqNnowQy8vYVZreEI1NnY2UklCQ0xLUkwzTmRUaWdHcE4rc2xTNmVtRjNic0lrbwp6T3VHYUg5TElSTllVL3BuRnJBcFpCU25vWElGa2M4WHRwS29IakttMDVmOUZZMlJseHhHdVl5bjZ0c2o2WGNkCnhsM1owWXI3cGoyWWVJdS9sWXNXcGdIalZsWHFZbVpIQWJVL1VwTll3ZzR3ZVRNRHVUWmQ0YUwwRVpQcGc2clkKKzFEckdHODFaeDZWbUhXa2xWTXdDUDkvQXZ2VlhqaWlHdVNBCi0tLS0tRU5EIENFUlRJRklDQVRFIFJFUVVFU1QtLS0tLQo</span><span class="o">=</span>
  signerName: kubernetes.io/legacy-unknown
  usages:
  - digital signature
  - key encipherment
  - server auth
  username: minikube-user
status:
  certificate: <span class="nv">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM1akNDQWM2Z0F3SUJBZ0lRWVdpS3cveHNkVkpVT09pMTBBZU9LekFOQmdrcWhraUc5dzBCQVFzRkFEQVYKTVJNd0VRWURWUVFERXdwdGFXNXBhM1ZpWlVOQk1CNFhEVEl4TURreU1qSXpORGt6TTFvWERUSXlNRGt5TWpJegpORGt6TTFvd0VqRVFNQTRHQTFVRUF4TUhZbWhoY21GMGFEQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQCkFEQ0NBUW9DZ2dFQkFPZ0tPR1UvUU9nTlRoeW1ucTl4VzBwREZSdnk0UG5uUERkYmF2RExIaTZnNDd1amNicVYKY3MyYmdHbWlNdWlhTFQzV01YaVB4eFRjWXFKZDYvSGEyc1hBbXZLQUtVZTVpNUJRM093cTNrVnducEU3bENzNQpOWWRzT25XYWVPRnBVbzJQMno0eDEzYzBPY2UxRms2UjNwZDdaSzlReWxqVEVxeVJhZ2ZVSEo0TTBqTThXbWZECnRmTXdWTlRRQzErYjVUdmRINmxhSTJMeXhjRFFzS3pYMUdLNW5WTDNaeS84NEM1NUlYL0Q4QTRNcHFpUm1JdXUKQTV3U0dhRnV5bEpGdGFXc2g0WHVpTytoRHdHNU8wcVdOeDkzaDBEZkFkb0JmZHVDb0k3RjdQU3pwS0ZCcFl2cQpzc3hZcWJOTnJJRVhxZ3k4MUF1SU41VG83Wi9PUGYwb0Q2Y0NBd0VBQWFNMU1ETXdEZ1lEVlIwUEFRSC9CQVFECkFnV2dNQk1HQTFVZEpRUU1NQW9HQ0NzR0FRVUZCd01CTUF3R0ExVWRFd0VCL3dRQ01BQXdEUVlKS29aSWh2Y04KQVFFTEJRQURnZ0VCQUZ2NVE5QXRaR2QySnVwY3N5a29OZ3N0ODNmKzFjc1FYbjJtN1MxcWF3UnB0VVVFRDRiRwpyU0czUGRzeTVWZWxQQmlicHRiS0dXNitQU2xyc3lHRDRWZkJ6RWIzaVFGSWtiL1ltY1h0WVhKMEx2cjBqY1FHCjN5N01DbDMyYWR1MDJtSWNlcm5NZG1kekRlQUhENkg2YThqeG9oOEZvZktNNmlQdytyM3hYWWhxVmJyalFscnQKclZ2cDNwbE9qc0pSUW5pWnpMb3Y0UXRzNk02RHBySWlsditVUU9lMUZ5eXpuSCtaV2JwUmZMejJ6L0ZqT0ZvVgpCeXpaM0NmN1BxSEM0ZXFyZHF2U3VQdHhhK3VaNU1xWVlnRHN4NjRraEVqR0dkNHFlSVdpbHFQcWNuNG5USlRJCi82ZXhlVi9LaEwzc3lXaUN1TGJjWllqMnRQWDZ5WkN2UmNrPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg</span><span class="o">==</span>
  conditions:
  - lastTransitionTime: <span class="s2">&quot;2021-09-22T23:54:33Z&quot;</span>
    lastUpdateTime: <span class="s2">&quot;2021-09-22T23:54:33Z&quot;</span>
    message: This CSR was approved by kubectl certificate approve.
    reason: KubectlApprove
    status: <span class="s2">&quot;True&quot;</span>
    type: Approved
MacBook-Pro:6.Security bharathdasaraju$ 


So the issued certificate is as below:
-----------------------------------------------------&gt;

<span class="nv">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM1akNDQWM2Z0F3SUJBZ0lRWVdpS3cveHNkVkpVT09pMTBBZU9LekFOQmdrcWhraUc5dzBCQVFzRkFEQVYKTVJNd0VRWURWUVFERXdwdGFXNXBhM1ZpWlVOQk1CNFhEVEl4TURreU1qSXpORGt6TTFvWERUSXlNRGt5TWpJegpORGt6TTFvd0VqRVFNQTRHQTFVRUF4TUhZbWhoY21GMGFEQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQCkFEQ0NBUW9DZ2dFQkFPZ0tPR1UvUU9nTlRoeW1ucTl4VzBwREZSdnk0UG5uUERkYmF2RExIaTZnNDd1amNicVYKY3MyYmdHbWlNdWlhTFQzV01YaVB4eFRjWXFKZDYvSGEyc1hBbXZLQUtVZTVpNUJRM093cTNrVnducEU3bENzNQpOWWRzT25XYWVPRnBVbzJQMno0eDEzYzBPY2UxRms2UjNwZDdaSzlReWxqVEVxeVJhZ2ZVSEo0TTBqTThXbWZECnRmTXdWTlRRQzErYjVUdmRINmxhSTJMeXhjRFFzS3pYMUdLNW5WTDNaeS84NEM1NUlYL0Q4QTRNcHFpUm1JdXUKQTV3U0dhRnV5bEpGdGFXc2g0WHVpTytoRHdHNU8wcVdOeDkzaDBEZkFkb0JmZHVDb0k3RjdQU3pwS0ZCcFl2cQpzc3hZcWJOTnJJRVhxZ3k4MUF1SU41VG83Wi9PUGYwb0Q2Y0NBd0VBQWFNMU1ETXdEZ1lEVlIwUEFRSC9CQVFECkFnV2dNQk1HQTFVZEpRUU1NQW9HQ0NzR0FRVUZCd01CTUF3R0ExVWRFd0VCL3dRQ01BQXdEUVlKS29aSWh2Y04KQVFFTEJRQURnZ0VCQUZ2NVE5QXRaR2QySnVwY3N5a29OZ3N0ODNmKzFjc1FYbjJtN1MxcWF3UnB0VVVFRDRiRwpyU0czUGRzeTVWZWxQQmlicHRiS0dXNitQU2xyc3lHRDRWZkJ6RWIzaVFGSWtiL1ltY1h0WVhKMEx2cjBqY1FHCjN5N01DbDMyYWR1MDJtSWNlcm5NZG1kekRlQUhENkg2YThqeG9oOEZvZktNNmlQdytyM3hYWWhxVmJyalFscnQKclZ2cDNwbE9qc0pSUW5pWnpMb3Y0UXRzNk02RHBySWlsditVUU9lMUZ5eXpuSCtaV2JwUmZMejJ6L0ZqT0ZvVgpCeXpaM0NmN1BxSEM0ZXFyZHF2U3VQdHhhK3VaNU1xWVlnRHN4NjRraEVqR0dkNHFlSVdpbHFQcWNuNG5USlRJCi82ZXhlVi9LaEwzc3lXaUN1TGJjWllqMnRQWDZ5WkN2UmNrPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg</span><span class="o">==</span>



MacBook-Pro:6.Security bharathdasaraju$ <span class="nb">echo</span> <span class="s2">&quot;LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM1akNDQWM2Z0F3SUJBZ0lRWVdpS3cveHNkVkpVT09pMTBBZU9LekFOQmdrcWhraUc5dzBCQVFzRkFEQVYKTVJNd0VRWURWUVFERXdwdGFXNXBhM1ZpWlVOQk1CNFhEVEl4TURreU1qSXpORGt6TTFvWERUSXlNRGt5TWpJegpORGt6TTFvd0VqRVFNQTRHQTFVRUF4TUhZbWhoY21GMGFEQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQCkFEQ0NBUW9DZ2dFQkFPZ0tPR1UvUU9nTlRoeW1ucTl4VzBwREZSdnk0UG5uUERkYmF2RExIaTZnNDd1amNicVYKY3MyYmdHbWlNdWlhTFQzV01YaVB4eFRjWXFKZDYvSGEyc1hBbXZLQUtVZTVpNUJRM093cTNrVnducEU3bENzNQpOWWRzT25XYWVPRnBVbzJQMno0eDEzYzBPY2UxRms2UjNwZDdaSzlReWxqVEVxeVJhZ2ZVSEo0TTBqTThXbWZECnRmTXdWTlRRQzErYjVUdmRINmxhSTJMeXhjRFFzS3pYMUdLNW5WTDNaeS84NEM1NUlYL0Q4QTRNcHFpUm1JdXUKQTV3U0dhRnV5bEpGdGFXc2g0WHVpTytoRHdHNU8wcVdOeDkzaDBEZkFkb0JmZHVDb0k3RjdQU3pwS0ZCcFl2cQpzc3hZcWJOTnJJRVhxZ3k4MUF1SU41VG83Wi9PUGYwb0Q2Y0NBd0VBQWFNMU1ETXdEZ1lEVlIwUEFRSC9CQVFECkFnV2dNQk1HQTFVZEpRUU1NQW9HQ0NzR0FRVUZCd01CTUF3R0ExVWRFd0VCL3dRQ01BQXdEUVlKS29aSWh2Y04KQVFFTEJRQURnZ0VCQUZ2NVE5QXRaR2QySnVwY3N5a29OZ3N0ODNmKzFjc1FYbjJtN1MxcWF3UnB0VVVFRDRiRwpyU0czUGRzeTVWZWxQQmlicHRiS0dXNitQU2xyc3lHRDRWZkJ6RWIzaVFGSWtiL1ltY1h0WVhKMEx2cjBqY1FHCjN5N01DbDMyYWR1MDJtSWNlcm5NZG1kekRlQUhENkg2YThqeG9oOEZvZktNNmlQdytyM3hYWWhxVmJyalFscnQKclZ2cDNwbE9qc0pSUW5pWnpMb3Y0UXRzNk02RHBySWlsditVUU9lMUZ5eXpuSCtaV2JwUmZMejJ6L0ZqT0ZvVgpCeXpaM0NmN1BxSEM0ZXFyZHF2U3VQdHhhK3VaNU1xWVlnRHN4NjRraEVqR0dkNHFlSVdpbHFQcWNuNG5USlRJCi82ZXhlVi9LaEwzc3lXaUN1TGJjWllqMnRQWDZ5WkN2UmNrPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==&quot;</span> <span class="p">|</span> base64 --decode 
-----BEGIN CERTIFICATE-----
MIIC5jCCAc6gAwIBAgIQYWiKw/xsdVJUOOi10AeOKzANBgkqhkiG9w0BAQsFADAV
MRMwEQYDVQQDEwptaW5pa3ViZUNBMB4XDTIxMDkyMjIzNDkzM1oXDTIyMDkyMjIz
NDkzM1owEjEQMA4GA1UEAxMHYmhhcmF0aDCCASIwDQYJKoZIhvcNAQEBBQADggEP
ADCCAQoCggEBAOgKOGU/QOgNThymnq9xW0pDFRvy4PnnPDdbavDLHi6g47ujcbqV
cs2bgGmiMuiaLT3WMXiPxxTcYqJd6/Ha2sXAmvKAKUe5i5BQ3Owq3kVwnpE7lCs5
NYdsOnWaeOFpUo2P2z4x13c0Oce1Fk6R3pd7ZK9QyljTEqyRagfUHJ4M0jM8WmfD
tfMwVNTQC1+b5TvdH6laI2LyxcDQsKzX1GK5nVL3Zy/84C55IX/D8A4MpqiRmIuu
A5wSGaFuylJFtaWsh4XuiO+hDwG5O0qWNx93h0DfAdoBfduCoI7F7PSzpKFBpYvq
ssxYqbNNrIEXqgy81AuIN5To7Z/OPf0oD6cCAwEAAaM1MDMwDgYDVR0PAQH/BAQD
AgWgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMAwGA1UdEwEB/wQCMAAwDQYJKoZIhvcN
AQELBQADggEBAFv5Q9AtZGd2JupcsykoNgst83f+1csQXn2m7S1qawRptUUED4bG
rSG3Pdsy5VelPBibptbKGW6+PSlrsyGD4VfBzEb3iQFIkb/YmcXtYXJ0Lvr0jcQG
3y7MCl32adu02mIcernMdmdzDeAHD6H6a8jxoh8FofKM6iPw+r3xXYhqVbrjQlrt
rVvp3plOjsJRQniZzLov4Qts6M6DprIilv+UQOe1FyyznH+ZWbpRfLz2z/FjOFoV
ByzZ3Cf7PqHC4eqrdqvSuPtxa+uZ5MqYYgDsx64khEjGGd4qeIWilqPqcn4nTJTI
/6exeV/KhL3syWiCuLbcZYj2tPX6yZCvRck<span class="o">=</span>
-----END CERTIFICATE-----
MacBook-Pro:6.Security bharathdasaraju$ 


Kube controlller-manager does all this certificate stuff :<span class="o">)</span> 
kube-controller-manager yaml file:
-------------------------------------&gt;
--cluster-signing-cert-file<span class="o">=</span>/etc/kubernetes/pki/ca.crt
--cluster-signing-key-file<span class="o">=</span>/etc/kubernetes/pki/ca.key
</pre></div>
</div>
</div>
<p>csruser</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">csruser</span><a class="headerlink" href="#id15" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>apiVersion: certificates.k8s.io/v1
kind: CertificateSigningRequest
metadata:
  name: akshay
spec:
  groups:
  - system:authenticated
  request: <span class="nv">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ1ZqQ0NBVDRDQVFBd0VURVBNQTBHQTFVRUF3d0dZV3R6YUdGNU1JSUJJakFOQmdrcWhraUc5dzBCQVFFRgpBQU9DQVE4QU1JSUJDZ0tDQVFFQXY4azZTTE9HVzcrV3JwUUhITnI2TGFROTJhVmQ1blNLajR6UEhsNUlJYVdlCmJ4RU9JYkNmRkhKKzlIOE1RaS9hbCswcEkwR2xpYnlmTXozL2lGSWF3eGVXNFA3bDJjK1g0L0lqOXZQVC9jU3UKMDAya2ZvV0xUUkpQbWtKaVVuQTRpSGxZNDdmYkpQZDhIRGFuWHM3bnFoenVvTnZLbWhwL2twZUVvaHd5MFRVMAo5bzdvcjJWb1hWZTVyUnNoMms4dzV2TlVPL3BBdEk4VkRydUhCYzRxaHM3MDI1ZTZTUXFDeHUyOHNhTDh1blJQCkR6V2ZsNVpLcTVpdlJNeFQrcUo0UGpBL2pHV2d6QVliL1hDQXRrRVJyNlMwak9XaEw1Q0ErVU1BQmd5a1c5emQKTmlXbnJZUEdqVWh1WjZBeWJ1VzMxMjRqdlFvbndRRUprNEdoayt2SU53SURBUUFCb0FBd0RRWUpLb1pJaHZjTgpBUUVMQlFBRGdnRUJBQi94dDZ2d2EweWZHZFpKZ1k2ZDRUZEFtN2ZiTHRqUE15OHByTi9WZEdxN25oVDNUUE5zCjEwRFFaVGN6T21hTjVTZmpTaVAvaDRZQzQ0QjhFMll5Szg4Z2lDaUVEWDNlaDFYZnB3bnlJMVBDVE1mYys3cWUKMkJZTGJWSitRY040MDU4YituK24wMy9oVkN4L1VRRFhvc2w4Z2hOaHhGck9zRUtuVExiWHRsK29jQ0RtN3I3UwpUYTFkbWtFWCtWUnFJYXFGSDd1dDJveHgxcHdCdnJEeGUvV2cybXNqdHJZUXJ3eDJmQnErQ2Z1dm1sVS9rME4rCml3MEFjbVJsMy9veTdqR3ptMXdqdTJvNG4zSDNKQ25SbE41SnIyQkZTcFVQU3dCL1lUZ1ZobHVMNmwwRERxS3MKNTdYcEYxcjZWdmJmbTRldkhDNnJCSnNiZmI2ZU1KejZPMUU9Ci0tLS0tRU5EIENFUlRJRklDQVRFIFJFUVVFU1QtLS0tLQo</span><span class="o">=</span>
  signerName: kubernetes.io/kube-apiserver-client
  usages:
  - client auth
</pre></div>
</div>
</div>
<p>k8scertlabs</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">k8scertlabs</span><a class="headerlink" href="#id16" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>A new member akshay joined our team. He requires access to our cluster. The Certificate Signing Request is at the /root location.


root@controlplane:~# ls -lrth
total <span class="m">8</span>.0K
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">23</span> <span class="m">00</span>:03 akshay.key
-rw-r--r-- <span class="m">1</span> root root  <span class="m">887</span> Sep <span class="m">23</span> <span class="m">00</span>:03 akshay.csr
root@controlplane:~# 

root@controlplane:~# cat akshay.csr <span class="p">|</span> base64
LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ1ZqQ0NBVDRDQVFBd0VURVBN
QTBHQTFVRUF3d0dZV3R6YUdGNU1JSUJJakFOQmdrcWhraUc5dzBCQVFFRgpBQU9DQVE4QU1JSUJD
Z0tDQVFFQXBQTE5NcjBjUDZueVIrTmdmYVJ0UFNKemVIZXFXS21Ha21nMmk1NmRoQWFYCnlaNTFK
SVkwY0MyUWpXQ2o0ZTF5ZUJlUFRJWThPSWQ1QXdKcU92Y05JMzh1SWZ1WjVDNkhNV3ZXR2lOZmNj
ek0KeUVLTFhxMTVDSy91bUNSTDEwenBiOFdBVzkyS2tPY05xbENza1VnWWpZbWs4RkdwS2J6dUhw
bVdsVjdEcm9hLwpJSlVVRXN0NGcyN1JCRHVVNk1PVnRHMUMwMnpmd1UyeUxCSzFsMDgyV29NVno0
NzY3UWZsdWlIWmR5MEdaZUZMCjBHalpvYkxNelFRS0U3V0dGa3ZiUzdMaklRSVR4M0QwSEV1OUVE
NnFURHpyN3JUS005VTVrcXQ1VHBldHhqNnYKSWFhR2lrRmNLbnl4NExaOE9seVFDdlNFdlNOT2JO
blpSTkt1VTRHTXV3SURBUUFCb0FBd0RRWUpLb1pJaHZjTgpBUUVMQlFBRGdnRUJBQitORGFUZ1Y0
MnZ3R2lPbjRmT0lodlpkQ3o1WkQzbXlyL25kcHVWaFBwMTg5cTN0STI2CjhYUzBHUGY2aFlDV2g5
aGl5TWM0SGZUR3h2M1ZFYlU0WWFnVVczTnlCUHlKY0tCNXoyMEZVNWZramFRdmhUdkcKTmx6blgy
UURXRmtHY3RZb05uZjdwdFFkRldnUnVERklaSEZHN291OE84UCtBUE5iVlRpR1gyc05CaGFXVjJW
VApsVHVSZk5zQkNndlRvZDdIQ0F1Tzl4OExIbFVhdUNVYnV3STNvN3ZVYVpWanJVeVZscFd1MGFU
QlZ2OVNJWWNMCldrRmxxU0tGM0c4ektrelE0TGxyZEo3dnpjajVZVld6M2NkWjRtc1NJaDdWZ1dZ
L2lrYlpLKy9LVW9JdU9IY3oKL2VMQ0hDK2lNSGJiMzVqcjEyZkVBamdVK2hoTHlxdThZZms9Ci0t
<span class="nv">LS0tRU5EIENFUlRJRklDQVRFIFJFUVVFU1QtLS0tLQo</span><span class="o">=</span>
root@controlplane:~#




root@controlplane:~# ls -rtlh
total 12K
-rw------- <span class="m">1</span> root root <span class="m">1</span>.7K Sep <span class="m">23</span> <span class="m">00</span>:03 akshay.key
-rw-r--r-- <span class="m">1</span> root root  <span class="m">887</span> Sep <span class="m">23</span> <span class="m">00</span>:03 akshay.csr
-rw-r--r-- <span class="m">1</span> root root <span class="m">1</span>.4K Sep <span class="m">23</span> <span class="m">00</span>:06 certificatesiging.yaml
root@controlplane:~# vim CertSigningRequest_user.yaml 
root@controlplane:~# kubectl apply -f CertSigningRequest_user.yaml
certificatesigningrequest.certificates.k8s.io/akshay created
root@controlplane:~# 


root@controlplane:~# kubectl get csr
NAME        AGE   SIGNERNAME                                    REQUESTOR                  CONDITION
akshay      48s   kubernetes.io/kube-apiserver-client           kubernetes-admin           Pending
csr-7788z   16m   kubernetes.io/kube-apiserver-client-kubelet   system:node:controlplane   Approved,Issued
root@controlplane:~# 

root@controlplane:~# kubectl certificate approve akshay
certificatesigningrequest.certificates.k8s.io/akshay approved
root@controlplane:~# kubectl get csr
NAME        AGE    SIGNERNAME                                    REQUESTOR                  CONDITION
akshay      109s   kubernetes.io/kube-apiserver-client           kubernetes-admin           Approved,Issued
csr-7788z   17m    kubernetes.io/kube-apiserver-client-kubelet   system:node:controlplane   Approved,Issued
root@controlplane:~# 



root@controlplane:~# kubectl get csr agent-smith -o yaml
apiVersion: certificates.k8s.io/v1
kind: CertificateSigningRequest
metadata:
  creationTimestamp: <span class="s2">&quot;2021-09-23T00:15:27Z&quot;</span>
  managedFields:
  - apiVersion: certificates.k8s.io/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:spec:
        f:groups: <span class="o">{}</span>
        f:request: <span class="o">{}</span>
        f:signerName: <span class="o">{}</span>
        f:usages: <span class="o">{}</span>
    manager: kubectl-create
    operation: Update
    time: <span class="s2">&quot;2021-09-23T00:15:27Z&quot;</span>
  name: agent-smith
  resourceVersion: <span class="s2">&quot;1794&quot;</span>
  uid: 8a739bc7-cc33-46b8-8208-5df6969917e7
spec:
  groups:
  - system:masters
  - system:authenticated
  request: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ1dEQ0NBVUFDQVFBd0V6RVJNQThHQTFVRUF3d0libVYzTFhWelpYSXdnZ0VpTUEwR0NTcUdTSWIzRFFFQgpBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRRE8wV0pXK0RYc0FKU0lyanBObzV2UklCcGxuemcrNnhjOStVVndrS2kwCkxmQzI3dCsxZUVuT041TXVxOTlOZXZtTUVPbnJEVU8vdGh5VnFQMncyWE5JRFJYall5RjQwRmJtRCs1eld5Q0sKeTNCaWhoQjkzTUo3T3FsM1VUdlo4VEVMcXlhRGtuUmwvanYvU3hnWGtvazBBQlVUcFdNeDRCcFNpS2IwVSt0RQpJRjVueEF0dE1Wa0RQUTdOYmVaUkc0M2IrUVdsVkdSL3o2RFdPZkpuYmZlek90YUF5ZEdMVFpGQy93VHB6NTJrCkVjQ1hBd3FDaGpCTGt6MkJIUFI0Sjg5RDZYYjhrMzlwdTZqcHluZ1Y2dVAwdEliT3pwcU52MFkwcWRFWnB3bXcKajJxRUwraFpFV2trRno4MGxOTnR5VDVMeE1xRU5EQ25JZ3dDNEdaaVJHYnJBZ01CQUFHZ0FEQU5CZ2txaGtpRwo5dzBCQVFzRkFBT0NBUUVBUzlpUzZDMXV4VHVmNUJCWVNVN1FGUUhVemFsTnhBZFlzYU9SUlFOd0had0hxR2k0CmhPSzRhMnp5TnlpNDRPT2lqeWFENnRVVzhEU3hrcjhCTEs4S2czc3JSRXRKcWw1ckxaeTlMUlZyc0pnaEQ0Z1kKUDlOTCthRFJTeFJPVlNxQmFCMm5XZVlwTTVjSjVURjUzbGVzTlNOTUxRMisrUk1uakRRSjdqdVBFaWM4L2RoawpXcjJFVU02VWF3enlrcmRISW13VHYybWxNWTBSK0ROdFYxWWllKzBIOS9ZRWx0K0ZTR2poNUw1WVV2STFEcWl5CjRsM0UveTNxTDcxV2ZBY3VIM09zVnBVVW5RSVNNZFFzMHFXQ3NiRTU2Q0M1RGhQR1pJcFVibktVcEF3a2ErOEUKdndRMDdqRytocGtueG11RkFlWHhnVXdvZEFMYUo3anUvVERJY3c9PQotLS0tLUVORCBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0K
  signerName: kubernetes.io/kube-apiserver-client
  usages:
  - digital signature
  - key encipherment
  - server auth
  username: agent-x
status: <span class="o">{}</span>
root@controlplane:~# 


root@controlplane:~# kubectl certificate deny agent-smith
certificatesigningrequest.certificates.k8s.io/agent-smith denied
root@controlplane:~# kubectl get csr
NAME          AGE     SIGNERNAME                                    REQUESTOR                  CONDITION
agent-smith   106s    kubernetes.io/kube-apiserver-client           agent-x                    Denied
akshay        4m17s   kubernetes.io/kube-apiserver-client           kubernetes-admin           Approved,Issued
csr-7788z     20m     kubernetes.io/kube-apiserver-client-kubelet   system:node:controlplane   Approved,Issued
root@controlplane:~# 


root@controlplane:~# kubectl delete csr agent-smith 
certificatesigningrequest.certificates.k8s.io <span class="s2">&quot;agent-smith&quot;</span> deleted
root@controlplane:~# 
</pre></div>
</div>
</div>
<p>kubeconfig1</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">kubeconfig1</span><a class="headerlink" href="#id17" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Config</span> 

<span class="nt">current-context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-user@google</span>

<span class="nt">clusters</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-kube-play</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">development</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class="nt">contexts</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-kube-admin@my-kube-play</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-user@google</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">prod-user@production</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">admin@development</span>
<span class="nt">users</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-kube-admin</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">admin</span> 
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-user</span> 
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">prod-user</span> 
</pre></div>
</div>
</div>
<p>kubeconfig2</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">kubeconfig2</span><a class="headerlink" href="#id18" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Config</span>
<span class="nt">clusters</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">production</span>
  <span class="nt">cluster</span><span class="p">:</span>
    <span class="nt">certificate-authority</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/kubernetes/pki/ca.crt</span>
    <span class="nt">server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://172.17.0.87:6443</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">development</span>
  <span class="nt">cluster</span><span class="p">:</span>
    <span class="nt">certificate-authority</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/kubernetes/pki/ca.crt</span>
    <span class="nt">server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://172.17.0.87:6443</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes-on-aws</span>
  <span class="nt">cluster</span><span class="p">:</span>
    <span class="nt">certificate-authority</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/kubernetes/pki/ca.crt</span>
    <span class="nt">server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://172.17.0.87:6443</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-cluster-1</span>
  <span class="nt">cluster</span><span class="p">:</span>
    <span class="nt">certificate-authority</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/kubernetes/pki/ca.crt</span>
    <span class="nt">server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://172.17.0.87:6443</span>

<span class="nt">contexts</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-user@development</span>
    <span class="nt">context</span><span class="p">:</span>
      <span class="nt">cluster</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">development</span>
      <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-user</span>

  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-user@kubernetes-on-aws</span>
    <span class="nt">context</span><span class="p">:</span>
      <span class="nt">cluster</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes-on-aws</span>
      <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-user</span>

  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-user@production</span>
    <span class="nt">context</span><span class="p">:</span>
      <span class="nt">cluster</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">production</span>
      <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-user</span>

  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">research</span>
    <span class="nt">context</span><span class="p">:</span>
      <span class="nt">cluster</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-cluster-1</span>
      <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-user</span>

<span class="nt">users</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-user</span>
    <span class="nt">user</span><span class="p">:</span>
      <span class="nt">client-certificate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/kubernetes/pki/users/test-user/test-user.crt</span>
      <span class="nt">client-key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/kubernetes/pki/users/test-user/test-user.key</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-user</span>
    <span class="nt">user</span><span class="p">:</span>
      <span class="nt">client-certificate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/kubernetes/pki/users/dev-user/developer-user.crt</span>
      <span class="nt">client-key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/kubernetes/pki/users/dev-user/dev-user.key</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-user</span>
    <span class="nt">user</span><span class="p">:</span>
      <span class="nt">client-certificate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/kubernetes/pki/users/aws-user/aws-user.crt</span>
      <span class="nt">client-key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/kubernetes/pki/users/aws-user/aws-user.key</span>

<span class="nt">current-context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-user@development</span>
<span class="nt">preferences</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
</pre></div>
</div>
</div>
<p>demokubeconfig</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">demokubeconfig</span><a class="headerlink" href="#id19" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl https://my-kube-playground:6443/api/v1/pods --key admin.key --cert admin.crt --cacert ca.crt

kubectl get pods --server my-kube-playground:6443/api/v1/pods <span class="se">\</span>
                 --client-key admin.key <span class="se">\</span>
                 --client-certificate admin.crt <span class="se">\</span>
                 --certificate-authority ca.crt

Kubeconfig file:
------------------------------&gt;
Clusters  --&gt; cluster names<span class="o">(</span>Development, Production, Google etc...<span class="o">)</span>
Contexts --&gt; defines which user account can access to which cluster... admin@Development... devuser@Google
Users  --&gt; users<span class="o">(</span>admin, devuser,produser<span class="o">)</span> to get access to k8s cluster             



MacBook-Pro:6.Security bharathdasaraju$ kubectl config view
apiVersion: v1
clusters:
- cluster:
    certificate-authority: /Users/bharathdasaraju/.minikube/ca.crt
    extensions:
    - extension:
        last-update: Thu, <span class="m">23</span> Sep <span class="m">2021</span> <span class="m">07</span>:52:38 +08
        provider: minikube.sigs.k8s.io
        version: v1.20.0
      name: cluster_info
    server: https://127.0.0.1:32769
  name: minikube
contexts:
- context:
    cluster: minikube
    extensions:
    - extension:
        last-update: Thu, <span class="m">23</span> Sep <span class="m">2021</span> <span class="m">07</span>:52:38 +08
        provider: minikube.sigs.k8s.io
        version: v1.20.0
      name: context_info
    namespace: default
    user: minikube
  name: minikube
current-context: minikube
kind: Config
preferences: <span class="o">{}</span>
users:
- name: minikube
  user:
    client-certificate: /Users/bharathdasaraju/.minikube/profiles/minikube/client.crt
    client-key: /Users/bharathdasaraju/.minikube/profiles/minikube/client.key
MacBook-Pro:6.Security bharathdasaraju$ 



MacBook-Pro:~ bharathdasaraju$ kubectl config view --kubeconfig<span class="o">=</span>bkr-config
apiVersion: v1
clusters:
- cluster:
    certificate-authority: /Users/bharathdasaraju/.minikube/ca.crt
    extensions:
    - extension:
        last-update: Thu, <span class="m">23</span> Sep <span class="m">2021</span> <span class="m">07</span>:52:38 +08
        provider: minikube.sigs.k8s.io
        version: v1.20.0
      name: cluster_info
    server: https://127.0.0.1:32769
  name: minikube
contexts:
- context:
    cluster: minikube
    extensions:
    - extension:
        last-update: Thu, <span class="m">23</span> Sep <span class="m">2021</span> <span class="m">07</span>:52:38 +08
        provider: minikube.sigs.k8s.io
        version: v1.20.0
      name: context_info
    namespace: default
    user: minikube
  name: minikube
current-context: minikube
kind: Config
preferences: <span class="o">{}</span>
users:
- name: minikube
  user:
    client-certificate: /Users/bharathdasaraju/.minikube/profiles/minikube/client.crt
    client-key: /Users/bharathdasaraju/.minikube/profiles/minikube/client.key
MacBook-Pro:~ bharathdasaraju$ 

MacBook-Pro:~ bharathdasaraju$ kubectl config current-context --kubeconfig<span class="o">=</span>bkr-config
minikube
MacBook-Pro:~ bharathdasaraju$ 


MacBook-Pro:~ bharathdasaraju$ kubectl config use-context prod-user@production
MacBook-Pro:~ bharathdasaraju$ 

- cluster:
    certificate-authority: /Users/bharathdasaraju/.minikube/ca.crt
we can also pass certificate-authority-data: the contents of cert <span class="k">in</span> base64 format.
</pre></div>
</div>
</div>
<p>demokubeconfiglabs</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">demokubeconfiglabs</span><a class="headerlink" href="#id20" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@controlplane:~# kubectl config view
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: DATA+OMITTED
    server: https://controlplane:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
  name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes
kind: Config
preferences: <span class="o">{}</span>
users:
- name: kubernetes-admin
  user:
    client-certificate-data: REDACTED
    client-key-data: REDACTED
root@controlplane:~# 


-----------------------------------------------------------------------------------------&gt;


root@controlplane:~# kubectl config view --kubeconfig<span class="o">=</span>my-kube-config 
apiVersion: v1
clusters:
- cluster:
    certificate-authority: /etc/kubernetes/pki/ca.crt
    server: https://controlplane:6443
  name: development
- cluster:
    certificate-authority: /etc/kubernetes/pki/ca.crt
    server: https://controlplane:6443
  name: kubernetes-on-aws
- cluster:
    certificate-authority: /etc/kubernetes/pki/ca.crt
    server: https://controlplane:6443
  name: production
- cluster:
    certificate-authority: /etc/kubernetes/pki/ca.crt
    server: https://controlplane:6443
  name: test-cluster-1
contexts:
- context:
    cluster: kubernetes-on-aws
    user: aws-user
  name: aws-user@kubernetes-on-aws
- context:
    cluster: test-cluster-1
    user: dev-user
  name: research
- context:
    cluster: development
    user: test-user
  name: test-user@development
- context:
    cluster: production
    user: test-user
  name: test-user@production
current-context: test-user@development
kind: Config
preferences: <span class="o">{}</span>
users:
- name: aws-user
  user:
    client-certificate: /etc/kubernetes/pki/users/aws-user/aws-user.crt
    client-key: /etc/kubernetes/pki/users/aws-user/aws-user.key
- name: dev-user
  user:
    client-certificate: /etc/kubernetes/pki/users/dev-user/developer-user.crt
    client-key: /etc/kubernetes/pki/users/dev-user/dev-user.key
- name: test-user
  user:
    client-certificate: /etc/kubernetes/pki/users/test-user/test-user.crt
    client-key: /etc/kubernetes/pki/users/test-user/test-user.key
root@controlplane:~# 



root@controlplane:~# kubectl config use-context research --kubeconfig<span class="o">=</span>my-kube-config 
Switched to context <span class="s2">&quot;research&quot;</span>.
root@controlplane:~# 

root@controlplane:~# kubectl config current-context --kubeconfig<span class="o">=</span>my-kube-config
research
root@controlplane:~# 


root@controlplane:/etc/kubernetes/pki/users/dev-user# kubectl config current-context 
research
root@controlplane:/etc/kubernetes/pki/users/dev-user#
</pre></div>
</div>
</div>
<p>APIGroups</p>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">APIGroups</span><a class="headerlink" href="#id21" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl https://kube-master:6443/version

curl https://kube-master:6443/api/v1/pods


/api
/version
/healthz
/metrics
/apis
/logs

API groups --&gt; CoreGroups, Named Groups

core group  /api
------------------------&gt;
/v1
pods
namesaces
nodes
bindings
PV
PVS
events
rc
secrets
services
configmaps


named group /apis
----------------------------&gt;
/apps
/extensions
/networking.k8s.io
/storage.k8s.io
/authentication.k8s.io
/certificates.k8s.io

/apps
/v1
/deployments
/replicasets
/statefulsets

/deployments
actions
--------&gt;
list
get
create 
delete
update
watch



root@minikube:/# curl https://localhost:8443/version/ -k
<span class="o">{</span>
  <span class="s2">&quot;major&quot;</span>: <span class="s2">&quot;1&quot;</span>,
  <span class="s2">&quot;minor&quot;</span>: <span class="s2">&quot;20&quot;</span>,
  <span class="s2">&quot;gitVersion&quot;</span>: <span class="s2">&quot;v1.20.2&quot;</span>,
  <span class="s2">&quot;gitCommit&quot;</span>: <span class="s2">&quot;faecb196815e248d3ecfb03c680a4507229c2a56&quot;</span>,
  <span class="s2">&quot;gitTreeState&quot;</span>: <span class="s2">&quot;clean&quot;</span>,
  <span class="s2">&quot;buildDate&quot;</span>: <span class="s2">&quot;2021-01-13T13:20:00Z&quot;</span>,
  <span class="s2">&quot;goVersion&quot;</span>: <span class="s2">&quot;go1.15.5&quot;</span>,
  <span class="s2">&quot;compiler&quot;</span>: <span class="s2">&quot;gc&quot;</span>,
  <span class="s2">&quot;platform&quot;</span>: <span class="s2">&quot;linux/amd64&quot;</span>
<span class="o">}</span>root@minikube:/# 



MacBook-Pro:6.Security bharathdasaraju$ kubectl proxy
Starting to serve on <span class="m">127</span>.0.0.1:8001


    <span class="s2">&quot;/livez&quot;</span>,
MacBook-Pro:certified_kubernetes_administrator bharathdasaraju$ curl -ks  http://localhost:8001 <span class="p">|</span> jq
<span class="o">{</span>
  <span class="s2">&quot;paths&quot;</span>: <span class="o">[</span>
    <span class="s2">&quot;/.well-known/openid-configuration&quot;</span>,
    <span class="s2">&quot;/api&quot;</span>,
    <span class="s2">&quot;/api/v1&quot;</span>,
    <span class="s2">&quot;/apis&quot;</span>,
    <span class="s2">&quot;/apis/&quot;</span>,
    <span class="s2">&quot;/apis/admissionregistration.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/admissionregistration.k8s.io/v1&quot;</span>,
    <span class="s2">&quot;/apis/admissionregistration.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/apiextensions.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/apiextensions.k8s.io/v1&quot;</span>,
    <span class="s2">&quot;/apis/apiextensions.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/apiregistration.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/apiregistration.k8s.io/v1&quot;</span>,
    <span class="s2">&quot;/apis/apiregistration.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/apps&quot;</span>,
    <span class="s2">&quot;/apis/apps/v1&quot;</span>,
    <span class="s2">&quot;/apis/authentication.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/authentication.k8s.io/v1&quot;</span>,
    <span class="s2">&quot;/apis/authentication.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/authorization.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/authorization.k8s.io/v1&quot;</span>,
    <span class="s2">&quot;/apis/authorization.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/autoscaling&quot;</span>,
    <span class="s2">&quot;/apis/autoscaling/v1&quot;</span>,
    <span class="s2">&quot;/apis/autoscaling/v2beta1&quot;</span>,
    <span class="s2">&quot;/apis/autoscaling/v2beta2&quot;</span>,
    <span class="s2">&quot;/apis/batch&quot;</span>,
    <span class="s2">&quot;/apis/batch/v1&quot;</span>,
    <span class="s2">&quot;/apis/batch/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/certificates.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/certificates.k8s.io/v1&quot;</span>,
    <span class="s2">&quot;/apis/certificates.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/coordination.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/coordination.k8s.io/v1&quot;</span>,
    <span class="s2">&quot;/apis/coordination.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/discovery.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/discovery.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/events.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/events.k8s.io/v1&quot;</span>,
    <span class="s2">&quot;/apis/events.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/extensions&quot;</span>,
    <span class="s2">&quot;/apis/extensions/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/flowcontrol.apiserver.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/flowcontrol.apiserver.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/metrics.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/metrics.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/networking.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/networking.k8s.io/v1&quot;</span>,
    <span class="s2">&quot;/apis/networking.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/node.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/node.k8s.io/v1&quot;</span>,
    <span class="s2">&quot;/apis/node.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/policy&quot;</span>,
    <span class="s2">&quot;/apis/policy/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/rbac.authorization.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/rbac.authorization.k8s.io/v1&quot;</span>,
    <span class="s2">&quot;/apis/rbac.authorization.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/scheduling.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/scheduling.k8s.io/v1&quot;</span>,
    <span class="s2">&quot;/apis/scheduling.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/apis/storage.k8s.io&quot;</span>,
    <span class="s2">&quot;/apis/storage.k8s.io/v1&quot;</span>,
    <span class="s2">&quot;/apis/storage.k8s.io/v1beta1&quot;</span>,
    <span class="s2">&quot;/healthz&quot;</span>,
    <span class="s2">&quot;/healthz/autoregister-completion&quot;</span>,
    <span class="s2">&quot;/healthz/etcd&quot;</span>,
    <span class="s2">&quot;/healthz/log&quot;</span>,
    <span class="s2">&quot;/healthz/ping&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/aggregator-reload-proxy-client-cert&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/apiservice-openapi-controller&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/apiservice-registration-controller&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/apiservice-status-available-controller&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/bootstrap-controller&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/crd-informer-synced&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/generic-apiserver-start-informers&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/kube-apiserver-autoregistration&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/priority-and-fairness-config-consumer&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/priority-and-fairness-config-producer&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/priority-and-fairness-filter&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/rbac/bootstrap-roles&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/scheduling/bootstrap-system-priority-classes&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/start-apiextensions-controllers&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/start-apiextensions-informers&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/start-cluster-authentication-info-controller&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/start-kube-aggregator-informers&quot;</span>,
    <span class="s2">&quot;/healthz/poststarthook/start-kube-apiserver-admission-initializer&quot;</span>,
    <span class="s2">&quot;/livez&quot;</span>,
    <span class="s2">&quot;/livez/autoregister-completion&quot;</span>,
    <span class="s2">&quot;/livez/etcd&quot;</span>,
    <span class="s2">&quot;/livez/log&quot;</span>,
    <span class="s2">&quot;/livez/ping&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/aggregator-reload-proxy-client-cert&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/apiservice-openapi-controller&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/apiservice-registration-controller&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/apiservice-status-available-controller&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/bootstrap-controller&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/crd-informer-synced&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/generic-apiserver-start-informers&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/kube-apiserver-autoregistration&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/priority-and-fairness-config-consumer&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/priority-and-fairness-config-producer&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/priority-and-fairness-filter&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/rbac/bootstrap-roles&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/scheduling/bootstrap-system-priority-classes&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/start-apiextensions-controllers&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/start-apiextensions-informers&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/start-cluster-authentication-info-controller&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/start-kube-aggregator-informers&quot;</span>,
    <span class="s2">&quot;/livez/poststarthook/start-kube-apiserver-admission-initializer&quot;</span>,
    <span class="s2">&quot;/logs&quot;</span>,
    <span class="s2">&quot;/metrics&quot;</span>,
    <span class="s2">&quot;/openapi/v2&quot;</span>,
    <span class="s2">&quot;/openid/v1/jwks&quot;</span>,
    <span class="s2">&quot;/readyz&quot;</span>,
    <span class="s2">&quot;/readyz/autoregister-completion&quot;</span>,
    <span class="s2">&quot;/readyz/etcd&quot;</span>,
    <span class="s2">&quot;/readyz/informer-sync&quot;</span>,
    <span class="s2">&quot;/readyz/log&quot;</span>,
    <span class="s2">&quot;/readyz/ping&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/aggregator-reload-proxy-client-cert&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/apiservice-openapi-controller&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/apiservice-registration-controller&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/apiservice-status-available-controller&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/bootstrap-controller&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/crd-informer-synced&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/generic-apiserver-start-informers&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/kube-apiserver-autoregistration&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/priority-and-fairness-config-consumer&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/priority-and-fairness-config-producer&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/priority-and-fairness-filter&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/rbac/bootstrap-roles&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/scheduling/bootstrap-system-priority-classes&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/start-apiextensions-controllers&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/start-apiextensions-informers&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/start-cluster-authentication-info-controller&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/start-kube-aggregator-informers&quot;</span>,
    <span class="s2">&quot;/readyz/poststarthook/start-kube-apiserver-admission-initializer&quot;</span>,
    <span class="s2">&quot;/readyz/shutdown&quot;</span>,
    <span class="s2">&quot;/version&quot;</span>
  <span class="o">]</span>
<span class="o">}</span>
MacBook-Pro:certified_kubernetes_administrator bharathdasaraju$


MacBook-Pro:certified_kubernetes_administrator bharathdasaraju$ curl -ks  http://localhost:8001/apis/apps/v1 <span class="p">|</span> jq
<span class="o">{</span>
  <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;APIResourceList&quot;</span>,
  <span class="s2">&quot;apiVersion&quot;</span>: <span class="s2">&quot;v1&quot;</span>,
  <span class="s2">&quot;groupVersion&quot;</span>: <span class="s2">&quot;apps/v1&quot;</span>,
  <span class="s2">&quot;resources&quot;</span>: <span class="o">[</span>
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;controllerrevisions&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;ControllerRevision&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;85nkx63pcBU=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;daemonsets&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;DaemonSet&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;ds&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;categories&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;all&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;dd7pWHUlMKQ=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;daemonsets/status&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;DaemonSet&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;deployments&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Deployment&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;deploy&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;categories&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;all&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;8aSe+NMegvE=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;deployments/scale&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;group&quot;</span>: <span class="s2">&quot;autoscaling&quot;</span>,
      <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;v1&quot;</span>,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Scale&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;deployments/status&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Deployment&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;replicasets&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;ReplicaSet&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;rs&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;categories&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;all&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;P1RzHs8/mWQ=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;replicasets/scale&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;group&quot;</span>: <span class="s2">&quot;autoscaling&quot;</span>,
      <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;v1&quot;</span>,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Scale&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;replicasets/status&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;ReplicaSet&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;statefulsets&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;StatefulSet&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;sts&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;categories&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;all&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;H+vl74LkKdo=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;statefulsets/scale&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;group&quot;</span>: <span class="s2">&quot;autoscaling&quot;</span>,
      <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;v1&quot;</span>,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Scale&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;statefulsets/status&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;StatefulSet&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>
  <span class="o">]</span>
<span class="o">}</span>
MacBook-Pro:certified_kubernetes_administrator bharathdasaraju$



MacBook-Pro:certified_kubernetes_administrator bharathdasaraju$ curl -ks  http://localhost:8001/api/v1 <span class="p">|</span> jq
<span class="o">{</span>
  <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;APIResourceList&quot;</span>,
  <span class="s2">&quot;groupVersion&quot;</span>: <span class="s2">&quot;v1&quot;</span>,
  <span class="s2">&quot;resources&quot;</span>: <span class="o">[</span>
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;bindings&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Binding&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;componentstatuses&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: false,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;ComponentStatus&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;cs&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;configmaps&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;ConfigMap&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;cm&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;qFsyl6wFWjQ=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;endpoints&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Endpoints&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;ep&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;fWeeMqaN/OA=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;events&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Event&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;ev&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;r2yiGXH7wu8=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;limitranges&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;LimitRange&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;limits&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;EBKMFVe6cwo=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;namespaces&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: false,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Namespace&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;ns&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;Q3oi5N2YM8M=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;namespaces/finalize&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: false,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Namespace&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;namespaces/status&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: false,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Namespace&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;nodes&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: false,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Node&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;no&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;XwShjMxG9Fs=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;nodes/proxy&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: false,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;NodeProxyOptions&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;nodes/status&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: false,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Node&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;persistentvolumeclaims&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;PersistentVolumeClaim&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;pvc&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;QWTyNDq0dC4=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;persistentvolumeclaims/status&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;PersistentVolumeClaim&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;persistentvolumes&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: false,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;PersistentVolume&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;pv&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;HN/zwEC+JgM=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;persistentvolumes/status&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: false,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;PersistentVolume&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;pods&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Pod&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;po&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;categories&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;all&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;xPOwRZ+Yhw8=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;pods/attach&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;PodAttachOptions&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;get&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;pods/binding&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Binding&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;pods/eviction&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;group&quot;</span>: <span class="s2">&quot;policy&quot;</span>,
      <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;v1beta1&quot;</span>,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Eviction&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;pods/exec&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;PodExecOptions&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;get&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;pods/log&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Pod&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;pods/portforward&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;PodPortForwardOptions&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;get&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;pods/proxy&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;PodProxyOptions&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;pods/status&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Pod&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;podtemplates&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;PodTemplate&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;LIXB2x4IFpk=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;replicationcontrollers&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;ReplicationController&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;rc&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;categories&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;all&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;Jond2If31h0=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;replicationcontrollers/scale&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;group&quot;</span>: <span class="s2">&quot;autoscaling&quot;</span>,
      <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;v1&quot;</span>,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Scale&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;replicationcontrollers/status&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;ReplicationController&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;resourcequotas&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;ResourceQuota&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;quota&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;8uhSgffRX6w=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;resourcequotas/status&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;ResourceQuota&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;secrets&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Secret&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;S6u1pOWzb84=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;serviceaccounts&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;ServiceAccount&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;deletecollection&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;sa&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;pbx9ZvyFpBE=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;serviceaccounts/token&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;group&quot;</span>: <span class="s2">&quot;authentication.k8s.io&quot;</span>,
      <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;v1&quot;</span>,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;TokenRequest&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;services&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Service&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;list&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>,
        <span class="s2">&quot;watch&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;shortNames&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;svc&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;categories&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;all&quot;</span>
      <span class="o">]</span>,
      <span class="s2">&quot;storageVersionHash&quot;</span>: <span class="s2">&quot;0/CO1lhkEBI=&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;services/proxy&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;ServiceProxyOptions&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;create&quot;</span>,
        <span class="s2">&quot;delete&quot;</span>,
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;services/status&quot;</span>,
      <span class="s2">&quot;singularName&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;namespaced&quot;</span>: true,
      <span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Service&quot;</span>,
      <span class="s2">&quot;verbs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;get&quot;</span>,
        <span class="s2">&quot;patch&quot;</span>,
        <span class="s2">&quot;update&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>
  <span class="o">]</span>
<span class="o">}</span>
MacBook-Pro:certified_kubernetes_administrator bharathdasaraju$ 
</pre></div>
</div>
</div>
<p>k8sAuthorization</p>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">k8sAuthorization</span><a class="headerlink" href="#id22" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>once someone get into cluster...what they can <span class="k">do</span>..... thats what authorization defines

What the devlopers can <span class="k">do</span> <span class="k">in</span> k8s cluster
what the external services can <span class="k">do</span> <span class="k">in</span> k8s cluster

we should be giving exact required roles and role binding to the deveopers and service accounts.

Different types of authorization mechanisms available:
----------------------------------------------------------------------------------------------&gt;
<span class="m">1</span>. Node authorization
---------------------&gt;
--&gt; NodeAuthorizer this used by kubelet to communicate with kube-apiserver

<span class="m">2</span>. Attribute Based Access Controls<span class="o">(</span>ABAC<span class="o">)</span>
---------------------------------------&gt;
 we need to maintain a json file by having user<span class="o">(</span>or<span class="o">)</span> group based resource Access
 <span class="k">if</span> any update needed everytime we need to manually edit this policy json file.
 <span class="o">{</span><span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Policy&quot;</span>, <span class="s2">&quot;spec&quot;</span>: <span class="o">{</span> <span class="s2">&quot;user&quot;</span>: <span class="s2">&quot;dev-user-1&quot;</span>, <span class="s2">&quot;namespace&quot;</span>: <span class="s2">&quot;*&quot;</span>, <span class="s2">&quot;resource&quot;</span>: <span class="s2">&quot;pods&quot;</span>, <span class="s2">&quot;apiGroup&quot;</span>: <span class="s2">&quot;*&quot;</span><span class="o">}}</span>
<span class="o">{</span><span class="s2">&quot;kind&quot;</span>: <span class="s2">&quot;Policy&quot;</span>, <span class="s2">&quot;spec&quot;</span>: <span class="o">{</span> <span class="s2">&quot;user&quot;</span>: <span class="s2">&quot;dev-users&quot;</span>, <span class="s2">&quot;namespace&quot;</span>: <span class="s2">&quot;*&quot;</span>, <span class="s2">&quot;resource&quot;</span>: <span class="s2">&quot;pods&quot;</span>, <span class="s2">&quot;apiGroup&quot;</span>: <span class="s2">&quot;*&quot;</span><span class="o">}}</span>

<span class="m">3</span>.RBAC
-----------&gt;

here we create a role and assign <span class="nb">set</span> of users/groups to that role


<span class="m">4</span>.Webhook:
-----------&gt;
What <span class="k">if</span>, <span class="k">if</span> you want to outsource all the authorization mechanisms.
say you want to manage authorization externally not through the <span class="nb">builtin</span> mechanisms.

For example: <span class="s2">&quot;Open Policy Agent&quot;</span> is a third party tool which helps with admission control and authorization.
we can have a kubernetes makes an API call to the <span class="s2">&quot;open policy agent&quot;</span> with the information about the user and his access requirements.
And have the <span class="s2">&quot;open policy agent&quot;</span> decide <span class="k">if</span> the user should be permitted or not.


<span class="m">5</span>.AlwaysAllow
---------------------&gt;


<span class="m">6</span>.AlwaysDeny
------------------------------&gt;


<span class="k">in</span> the kube-apiserver service file we can specify which authorization mode is needed. Bydefault it is <span class="s2">&quot;AlwaysAllow&quot;</span> mode 

--authorization-mode<span class="o">=</span>Node,RBAC,Webhook
</pre></div>
</div>
</div>
<p>k8srole</p>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">k8srole</span><a class="headerlink" href="#id23" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">developer</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>  <span class="c1"># for core API group its empty for the named API group need to specify the name</span>
  <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;pods&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">verbs</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">get</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">list</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">watch</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">create</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">update</span> 
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">delete</span> 
<span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ConfigMaP&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">verbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;create&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;delete&quot;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
<p>k8srolebinding</p>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text">k8srolebinding</span><a class="headerlink" href="#id24" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">devuser-developer-binding</span>
<span class="nt">roleRef</span><span class="p">:</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">developer</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">User</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-user</span>
</pre></div>
</div>
</div>
<p>k8srolegranular</p>
<div class="literal-block-wrapper docutils container" id="id25">
<div class="code-block-caption"><span class="caption-text">k8srolegranular</span><a class="headerlink" href="#id25" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">developer_granualr</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;&quot;</span>
  <span class="nt">resources</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pods</span>
  <span class="nt">verbs</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">get</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">list</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">watch</span>
  <span class="nt">resourceNames</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;blue&quot;</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;orange&quot;</span>
</pre></div>
</div>
</div>
<p>k8sRBAC</p>
<div class="literal-block-wrapper docutils container" id="id26">
<div class="code-block-caption"><span class="caption-text">k8sRBAC</span><a class="headerlink" href="#id26" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>RoleBasedAccesControl<span class="o">(</span>RBAC<span class="o">)</span>
--------------------------------&gt;
How to Create a <span class="nv">role</span> 
<span class="o">==============================================</span>&gt;

MacBook-Pro:6.Security bharathdasaraju$ kubectl create role developer --verb<span class="o">=</span>get --verb<span class="o">=</span>list --verb<span class="o">=</span>watch --resource<span class="o">=</span>pods --dry-run<span class="o">=</span>client -o yaml &gt; deveoper-role.yaml
MacBook-Pro:6.Security bharathdasaraju$ 


MacBook-Pro:6.Security bharathdasaraju$ kubectl apply -f deveoper-role.yaml
role.rbac.authorization.k8s.io/developer created
MacBook-Pro:6.Security bharathdasaraju$ 

MacBook-Pro:6.Security bharathdasaraju$ kubectl describe role developer
Name:         developer
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
PolicyRule:
  Resources  Non-Resource URLs  Resource Names  Verbs
  ---------  -----------------  --------------  -----
  pods       <span class="o">[]</span>                 <span class="o">[]</span>              <span class="o">[</span>get list watch create update delete<span class="o">]</span>
MacBook-Pro:6.Security bharathdasaraju$ 


MacBook-Pro:6.Security bharathdasaraju$ kubectl apply -f deveoper-role.yaml 
role.rbac.authorization.k8s.io/developer configured
MacBook-Pro:6.Security bharathdasaraju$ kubectl describe role developer
Name:         developer
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
PolicyRule:
  Resources  Non-Resource URLs  Resource Names  Verbs
  ---------  -----------------  --------------  -----
  ConfigMaP  <span class="o">[]</span>                 <span class="o">[]</span>              <span class="o">[</span>create delete<span class="o">]</span>
  pods       <span class="o">[]</span>                 <span class="o">[]</span>              <span class="o">[</span>get list watch create update delete<span class="o">]</span>
MacBook-Pro:6.Security bharathdasaraju$ 


Create a RoleBinding:
<span class="o">==============================================</span>&gt;

RoleBinding is to assign that created to role to specific user/group

MacBook-Pro:6.Security bharathdasaraju$  kubectl create rolebinding devuser-developer-binding --role<span class="o">=</span>developer --user<span class="o">=</span>dev-user --dry-run<span class="o">=</span>client -o yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: devuser-developer-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: developer
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: User
  name: dev-user
MacBook-Pro:6.Security bharathdasaraju$

MacBook-Pro:6.Security bharathdasaraju$  kubectl create rolebinding devuser-developer-binding --role<span class="o">=</span>developer --user<span class="o">=</span>dev-user --dry-run<span class="o">=</span>client -o yaml &gt; devuser-developer-binding.yaml
MacBook-Pro:6.Security bharathdasaraju$ 

MacBook-Pro:6.Security bharathdasaraju$ kubectl apply -f devuser-developer-binding.yaml
rolebinding.rbac.authorization.k8s.io/devuser-developer-binding created
MacBook-Pro:6.Security bharathdasaraju$ kubectl describe rolebinding devuser-developer-binding
Name:         devuser-developer-binding
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Role:
  Kind:  Role
  Name:  developer
Subjects:
  Kind  Name      Namespace
  ----  ----      ---------
  User  dev-user  
MacBook-Pro:6.Security bharathdasaraju$ 

note that roles and rolebindings falls under the scope of the namespaces.

where as 

clusterrole and clusterrolebinding falls under the scope of the cluster.



MacBook-Pro:6.Security bharathdasaraju$ kubectl get roles
NAME        CREATED AT
developer   <span class="m">2021</span>-09-23T07:32:54Z
MacBook-Pro:6.Security bharathdasaraju$ kubectl get rolebindings
NAME                        ROLE             AGE
devuser-developer-binding   Role/developer   4m25s
MacBook-Pro:6.Security bharathdasaraju$ 


how to check can i have acces to particular resource <span class="k">in</span> kubernetes:
---------------------------------------------------------------------------------&gt;
MacBook-Pro:6.Security bharathdasaraju$ kubectl auth can-i create deployments
yes
MacBook-Pro:6.Security bharathdasaraju$ kubectl auth can-i delete nodes
Warning: resource <span class="s1">&#39;nodes&#39;</span> is not namespace scoped
yes
MacBook-Pro:6.Security bharathdasaraju$ 




MacBook-Pro:6.Security bharathdasaraju$ kubectl auth can-i delete nodes --as dev-user
Warning: resource <span class="s1">&#39;nodes&#39;</span> is not namespace scoped
no
MacBook-Pro:6.Security bharathdasaraju$ kubectl auth can-i delete secrets --as dev-user
no
MacBook-Pro:6.Security bharathdasaraju$ kubectl auth can-i create secrets --as dev-user
no
MacBook-Pro:6.Security bharathdasaraju$ kubectl auth can-i create services --as dev-user
no
MacBook-Pro:6.Security bharathdasaraju$ kubectl auth can-i create pods --as dev-user
yes
MacBook-Pro:6.Security bharathdasaraju$ kubectl auth can-i create configmaps --as dev-user
no
MacBook-Pro:6.Security bharathdasaraju$ 




MacBook-Pro:6.Security bharathdasaraju$ kubectl create role developer_granualr --verb<span class="o">=</span>get --verb<span class="o">=</span>list --verb<span class="o">=</span>watch --resource<span class="o">=</span>pods --dry-run<span class="o">=</span>client -o yaml &gt; deveoper_granualr-role.yaml
MacBook-Pro:6.Security bharathdasaraju$ 

we can also use <span class="s2">&quot;ResourceNames&quot;</span> to give access to certain pods alone.

apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: developer_granualr
rules:
- apiGroups: <span class="o">[</span><span class="s2">&quot;&quot;</span><span class="o">]</span>
  resources: <span class="o">[</span><span class="s2">&quot;pods&quot;</span><span class="o">]</span>
  verbs: <span class="o">[</span><span class="s2">&quot;get&quot;</span>, <span class="s2">&quot;list&quot;</span>, <span class="s2">&quot;watch&quot;</span><span class="o">]</span>
  resourceNames: <span class="o">[</span><span class="s2">&quot;blue&quot;</span>, <span class="s2">&quot;orange&quot;</span><span class="o">]</span>
</pre></div>
</div>
</div>
<p>k8sRBAClabs</p>
<div class="literal-block-wrapper docutils container" id="id27">
<div class="code-block-caption"><span class="caption-text">k8sRBAClabs</span><a class="headerlink" href="#id27" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@controlplane:/etc/kubernetes/manifests# kubectl get roles
No resources found <span class="k">in</span> default namespace.
root@controlplane:/etc/kubernetes/manifests# 



root@controlplane:/etc/kubernetes/manifests# kubectl get roles --all-namespaces
NAMESPACE     NAME                                             CREATED AT
blue          developer                                        <span class="m">2021</span>-09-23T08:54:07Z
kube-public   kubeadm:bootstrap-signer-clusterinfo             <span class="m">2021</span>-09-23T08:51:21Z
kube-public   system:controller:bootstrap-signer               <span class="m">2021</span>-09-23T08:51:19Z
kube-system   extension-apiserver-authentication-reader        <span class="m">2021</span>-09-23T08:51:19Z
kube-system   kube-proxy                                       <span class="m">2021</span>-09-23T08:51:24Z
kube-system   kubeadm:kubelet-config-1.20                      <span class="m">2021</span>-09-23T08:51:20Z
kube-system   kubeadm:nodes-kubeadm-config                     <span class="m">2021</span>-09-23T08:51:20Z
kube-system   system::leader-locking-kube-controller-manager   <span class="m">2021</span>-09-23T08:51:19Z
kube-system   system::leader-locking-kube-scheduler            <span class="m">2021</span>-09-23T08:51:19Z
kube-system   system:controller:bootstrap-signer               <span class="m">2021</span>-09-23T08:51:19Z
kube-system   system:controller:cloud-provider                 <span class="m">2021</span>-09-23T08:51:19Z
kube-system   system:controller:token-cleaner                  <span class="m">2021</span>-09-23T08:51:19Z
root@controlplane:/etc/kubernetes/manifests# 


root@controlplane:/etc/kubernetes/manifests# kubectl describe role kube-proxy -n kube-system
Name:         kube-proxy
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
PolicyRule:
  Resources   Non-Resource URLs  Resource Names  Verbs
  ---------   -----------------  --------------  -----
  configmaps  <span class="o">[]</span>                 <span class="o">[</span>kube-proxy<span class="o">]</span>    <span class="o">[</span>get<span class="o">]</span>
root@controlplane:/etc/kubernetes/manifests# 



root@controlplane:/etc/kubernetes/manifests# kubectl describe rolebindings kube-proxy -n kube-system  
Name:         kube-proxy
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Role:
  Kind:  Role
  Name:  kube-proxy
Subjects:
  Kind   Name                                             Namespace
  ----   ----                                             ---------
  Group  system:bootstrappers:kubeadm:default-node-token  
root@controlplane:/etc/kubernetes/manifests# 


root@controlplane:/etc/kubernetes/manifests# kubectl auth can-i list pods --as dev-user
no
root@controlplane:/etc/kubernetes/manifests# 


root@controlplane:/etc/kubernetes/manifests# kubectl get pods --as dev-user
Error from server <span class="o">(</span>Forbidden<span class="o">)</span>: pods is forbidden: User <span class="s2">&quot;dev-user&quot;</span> cannot list resource <span class="s2">&quot;pods&quot;</span> <span class="k">in</span> API group <span class="s2">&quot;&quot;</span> <span class="k">in</span> the namespace <span class="s2">&quot;default&quot;</span>
root@controlplane:/etc/kubernetes/manifests# 



Create the necessary roles and role bindings required <span class="k">for</span> the dev-user to create, list and delete pods <span class="k">in</span> the default namespace

Role: developer
Role Resources: pods
Role Actions: list
Role Actions: create
RoleBinding: dev-user-binding
RoleBinding: Bound to dev-user


root@controlplane:/etc/kubernetes/manifests# kubectl create role devloper --verb<span class="o">=</span>create --verb<span class="o">=</span>list --verb<span class="o">=</span>delete --resource<span class="o">=</span>pods --dry-run<span class="o">=</span>client -o yaml &gt; dev_role.yaml
root@controlplane:/etc/kubernetes/manifests# 


root@controlplane:/etc/kubernetes/manifests# kubectl create rolebinding dev-user-binding --role<span class="o">=</span>developer --user<span class="o">=</span>dev-user --dry-run<span class="o">=</span>client -o yaml &gt; dev_rolebinding.yaml
root@controlplane:/etc/kubernetes/manifests# 


root@controlplane:/etc/kubernetes/manifests# kubectl apply -f dev_rolebinding.yaml
rolebinding.rbac.authorization.k8s.io/dev-user-binding created
root@controlplane:/etc/kubernetes/manifests# kubectl get pods --as dev-user
NAME                  READY   STATUS    RESTARTS   AGE
red-c898cbdc6-54wnb   <span class="m">1</span>/1     Running   <span class="m">0</span>          14m
red-c898cbdc6-gb459   <span class="m">1</span>/1     Running   <span class="m">0</span>          14m
root@controlplane:/etc/kubernetes/manifests# 


root@controlplane:/etc/kubernetes/manifests# kubectl get role
NAME        CREATED AT
developer   <span class="m">2021</span>-09-23T09:06:28Z
root@controlplane:/etc/kubernetes/manifests# kubectl get rolebinding
NAME               ROLE             AGE
dev-user-binding   Role/developer   86s
root@controlplane:/etc/kubernetes/manifests# 


root@controlplane:~# kubectl auth can-i list pods -n blue  
yes
root@controlplane:~# 




root@controlplane:~# kubectl create role deploy-role --verb<span class="o">=</span>create --resource<span class="o">=</span>deployments --dry-run<span class="o">=</span>client -o yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: blue
  name: deploy-role
rules:
- apiGroups:
  - apps
  resources:
  - deployments
  verbs:
  - create
root@controlplane:~# 


root@controlplane:~# kubectl create rolebinding dev-user-deploy-binding  --role<span class="o">=</span>deploy-role --user<span class="o">=</span>dev-user --dry-run<span class="o">=</span>client -o yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  namespace: blue
  name: dev-user-deploy-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: deploy-role
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: User
  name: dev-user
root@controlplane:~# 





root@controlplane:~# kubectl apply -f deploy-role-rolebinding.yaml
role.rbac.authorization.k8s.io/deploy-role created
rolebinding.rbac.authorization.k8s.io/dev-user-deploy-binding created
root@controlplane:~# cat deploy-role-rolebinding.yaml
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: blue
  name: deploy-role
rules:
- apiGroups:
  - apps
  - extensions
  resources:
  - deployments
  verbs:
  - create
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  namespace: blue
  name: dev-user-deploy-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: deploy-role
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: User
  name: dev-user
root@controlplane:~# 
</pre></div>
</div>
</div>
<p>role_rolebinding</p>
<div class="literal-block-wrapper docutils container" id="id28">
<div class="code-block-caption"><span class="caption-text">role_rolebinding</span><a class="headerlink" href="#id28" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blue</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">deploy-role</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">apps</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">extensions</span>
  <span class="nt">resources</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">deployments</span>
  <span class="nt">verbs</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">create</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blue</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-user-deploy-binding</span>
<span class="nt">roleRef</span><span class="p">:</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">deploy-role</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">User</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-user</span>
</pre></div>
</div>
</div>
<p>clusterrole</p>
<div class="literal-block-wrapper docutils container" id="id29">
<div class="code-block-caption"><span class="caption-text">clusterrole</span><a class="headerlink" href="#id29" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cluster-admin</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;nodes&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">verbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;create&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;delete&quot;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
<p>clusterrolebinding</p>
<div class="literal-block-wrapper docutils container" id="id30">
<div class="code-block-caption"><span class="caption-text">clusterrolebinding</span><a class="headerlink" href="#id30" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cluster-admin-role-binding</span>
<span class="nt">roleRef</span><span class="p">:</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cluster-admin</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">User</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">admin-user1</span>
</pre></div>
</div>
</div>
<p>clusterrolebinding2</p>
<div class="literal-block-wrapper docutils container" id="id31">
<div class="code-block-caption"><span class="caption-text">clusterrolebinding2</span><a class="headerlink" href="#id31" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Cluster_Scoped_Resources:
--------------------------------------&gt;
<span class="m">1</span>. nodes
<span class="m">2</span>. PV
<span class="m">3</span>. clusterroles
<span class="m">4</span>. clusterrolebindings
<span class="m">5</span>. certificatesigningrequests
<span class="m">6</span>. namespaces

namespaced resources:
--------------------------------------------------------------------------------------&gt;
MacBook-Pro:6.Security bharathdasaraju$ kubectl api-resources --namespaced<span class="o">=</span><span class="nb">true</span> <span class="p">|</span> sort
NAME                        SHORTNAMES   APIGROUP                    NAMESPACED   KIND
bindings                                                             <span class="nb">true</span>         Binding
configmaps                  cm                                       <span class="nb">true</span>         ConfigMap
controllerrevisions                      apps                        <span class="nb">true</span>         ControllerRevision
cronjobs                    cj           batch                       <span class="nb">true</span>         CronJob
daemonsets                  ds           apps                        <span class="nb">true</span>         DaemonSet
deployments                 deploy       apps                        <span class="nb">true</span>         Deployment
endpoints                   ep                                       <span class="nb">true</span>         Endpoints
endpointslices                           discovery.k8s.io            <span class="nb">true</span>         EndpointSlice
events                      ev                                       <span class="nb">true</span>         Event
events                      ev           events.k8s.io               <span class="nb">true</span>         Event
horizontalpodautoscalers    hpa          autoscaling                 <span class="nb">true</span>         HorizontalPodAutoscaler
ingresses                   ing          extensions                  <span class="nb">true</span>         Ingress
ingresses                   ing          networking.k8s.io           <span class="nb">true</span>         Ingress
<span class="nb">jobs</span>                                     batch                       <span class="nb">true</span>         Job
leases                                   coordination.k8s.io         <span class="nb">true</span>         Lease
limitranges                 limits                                   <span class="nb">true</span>         LimitRange
localsubjectaccessreviews                authorization.k8s.io        <span class="nb">true</span>         LocalSubjectAccessReview
networkpolicies             netpol       networking.k8s.io           <span class="nb">true</span>         NetworkPolicy
persistentvolumeclaims      pvc                                      <span class="nb">true</span>         PersistentVolumeClaim
poddisruptionbudgets        pdb          policy                      <span class="nb">true</span>         PodDisruptionBudget
pods                                     metrics.k8s.io              <span class="nb">true</span>         PodMetrics
pods                        po                                       <span class="nb">true</span>         Pod
podtemplates                                                         <span class="nb">true</span>         PodTemplate
replicasets                 rs           apps                        <span class="nb">true</span>         ReplicaSet
replicationcontrollers      rc                                       <span class="nb">true</span>         ReplicationController
resourcequotas              quota                                    <span class="nb">true</span>         ResourceQuota
rolebindings                             rbac.authorization.k8s.io   <span class="nb">true</span>         RoleBinding
roles                                    rbac.authorization.k8s.io   <span class="nb">true</span>         Role
secrets                                                              <span class="nb">true</span>         Secret
serviceaccounts             sa                                       <span class="nb">true</span>         ServiceAccount
services                    svc                                      <span class="nb">true</span>         Service
statefulsets                sts          apps                        <span class="nb">true</span>         StatefulSet
MacBook-Pro:6.Security bharathdasaraju$ 

cluster scoped resources:
--------------------------------------------------------------------------------------&gt;

MacBook-Pro:6.Security bharathdasaraju$ kubectl api-resources --namespaced<span class="o">=</span><span class="nb">false</span> <span class="p">|</span> sort
NAME                              SHORTNAMES   APIGROUP                       NAMESPACED   KIND
apiservices                                    apiregistration.k8s.io         <span class="nb">false</span>        APIService
certificatesigningrequests        csr          certificates.k8s.io            <span class="nb">false</span>        CertificateSigningRequest
clusterrolebindings                            rbac.authorization.k8s.io      <span class="nb">false</span>        ClusterRoleBinding
clusterroles                                   rbac.authorization.k8s.io      <span class="nb">false</span>        ClusterRole
componentstatuses                 cs                                          <span class="nb">false</span>        ComponentStatus
csidrivers                                     storage.k8s.io                 <span class="nb">false</span>        CSIDriver
csinodes                                       storage.k8s.io                 <span class="nb">false</span>        CSINode
customresourcedefinitions         crd,crds     apiextensions.k8s.io           <span class="nb">false</span>        CustomResourceDefinition
flowschemas                                    flowcontrol.apiserver.k8s.io   <span class="nb">false</span>        FlowSchema
ingressclasses                                 networking.k8s.io              <span class="nb">false</span>        IngressClass
mutatingwebhookconfigurations                  admissionregistration.k8s.io   <span class="nb">false</span>        MutatingWebhookConfiguration
namespaces                        ns                                          <span class="nb">false</span>        Namespace
nodes                                          metrics.k8s.io                 <span class="nb">false</span>        NodeMetrics
nodes                             no                                          <span class="nb">false</span>        Node
persistentvolumes                 pv                                          <span class="nb">false</span>        PersistentVolume
podsecuritypolicies               psp          policy                         <span class="nb">false</span>        PodSecurityPolicy
priorityclasses                   pc           scheduling.k8s.io              <span class="nb">false</span>        PriorityClass
prioritylevelconfigurations                    flowcontrol.apiserver.k8s.io   <span class="nb">false</span>        PriorityLevelConfiguration
runtimeclasses                                 node.k8s.io                    <span class="nb">false</span>        RuntimeClass
selfsubjectaccessreviews                       authorization.k8s.io           <span class="nb">false</span>        SelfSubjectAccessReview
selfsubjectrulesreviews                        authorization.k8s.io           <span class="nb">false</span>        SelfSubjectRulesReview
storageclasses                    sc           storage.k8s.io                 <span class="nb">false</span>        StorageClass
subjectaccessreviews                           authorization.k8s.io           <span class="nb">false</span>        SubjectAccessReview
tokenreviews                                   authentication.k8s.io          <span class="nb">false</span>        TokenReview
validatingwebhookconfigurations                admissionregistration.k8s.io   <span class="nb">false</span>        ValidatingWebhookConfiguration
volumeattachments                              storage.k8s.io                 <span class="nb">false</span>        VolumeAttachment
MacBook-Pro:6.Security bharathdasaraju$ 

how to authorize cluster wide resources <span class="k">in</span> k8s
-------------------------------------------------&gt;
We can use <span class="m">1</span>. clusterroles
           <span class="m">2</span>. clusterrolebindings


MacBook-Pro:6.Security bharathdasaraju$ kubectl create clusterrole cluster-admin --verb<span class="o">=</span>list --verb<span class="o">=</span>get --verb<span class="o">=</span>create --resource<span class="o">=</span>nodes --dry-run<span class="o">=</span>client -o yaml 
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  creationTimestamp: null
  name: cluster-admin
rules:
- apiGroups:
  - <span class="s2">&quot;&quot;</span>
  resources:
  - nodes
  verbs:
  - list
  - get
  - create
MacBook-Pro:6.Security bharathdasaraju$ 


MacBook-Pro:6.Security bharathdasaraju$ kubectl apply -f clusterrole-clusterAdmin.yaml 
Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
clusterrole.rbac.authorization.k8s.io/cluster-admin configured
MacBook-Pro:6.Security bharathdasaraju$ 


MacBook-Pro:6.Security bharathdasaraju$ kubectl get clusterrole cluster-admin
NAME            CREATED AT
cluster-admin   <span class="m">2021</span>-09-04T06:52:21Z
MacBook-Pro:6.Security bharathdasaraju$ 


MacBook-Pro:6.Security bharathdasaraju$ kubectl create clusterrolebinding cluster-admin-role-binding --clusterrole<span class="o">=</span>cluster-admin --user<span class="o">=</span>admin-user1 --dry-run<span class="o">=</span>client -o yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  creationTimestamp: null
  name: cluster-admin-role-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: User
  name: admin-user1
MacBook-Pro:6.Security bharathdasaraju$ 



MacBook-Pro:6.Security bharathdasaraju$ kubectl create clusterrolebinding cluster-admin-role-binding --clusterrole<span class="o">=</span>cluster-admin --user<span class="o">=</span>admin-user1 --dry-run<span class="o">=</span>client -o yaml &gt; clusteradmin-clusterrolebinding.yaml
MacBook-Pro:6.Security bharathdasaraju$ kubectl apply -f clusteradmin-clusterrolebinding.yaml
clusterrolebinding.rbac.authorization.k8s.io/cluster-admin-role-binding created
MacBook-Pro:6.Security bharathdasaraju$ 

MacBook-Pro:6.Security bharathdasaraju$ kubectl describe clusterrolebinding cluster-admin-role-binding
Name:         cluster-admin-role-binding
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Role:
  Kind:  ClusterRole
  Name:  cluster-admin
Subjects:
  Kind  Name         Namespace
  ----  ----         ---------
  User  admin-user1  
MacBook-Pro:6.Security bharathdasaraju$ 
</pre></div>
</div>
</div>
<p>userclusterrolebinding</p>
<div class="literal-block-wrapper docutils container" id="id32">
<div class="code-block-caption"><span class="caption-text">userclusterrolebinding</span><a class="headerlink" href="#id32" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">storage-admin</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;persistentvolumes&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">verbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;create&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;delete&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;storage.k8s.io&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;storageclasses&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">verbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;create&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;delete&quot;</span><span class="p p-Indicator">]</span>

<span class="nn">---</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">michelle-storage-admin</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">User</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">michelle</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class="nt">roleRef</span><span class="p">:</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">storage-admin</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</pre></div>
</div>
</div>
<p>clusterrolebindinglabs</p>
<div class="literal-block-wrapper docutils container" id="id33">
<div class="code-block-caption"><span class="caption-text">clusterrolebindinglabs</span><a class="headerlink" href="#id33" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@controlplane:~# kubectl  get clusterrole 
NAME                                                                   CREATED AT
admin                                                                  <span class="m">2021</span>-09-23T10:29:16Z
cluster-admin                                                          <span class="m">2021</span>-09-23T10:29:15Z
edit                                                                   <span class="m">2021</span>-09-23T10:29:16Z
flannel                                                                <span class="m">2021</span>-09-23T10:29:28Z
kubeadm:get-nodes                                                      <span class="m">2021</span>-09-23T10:29:19Z
system:aggregate-to-admin                                              <span class="m">2021</span>-09-23T10:29:16Z
system:aggregate-to-edit                                               <span class="m">2021</span>-09-23T10:29:16Z
system:aggregate-to-view                                               <span class="m">2021</span>-09-23T10:29:16Z
system:auth-delegator                                                  <span class="m">2021</span>-09-23T10:29:16Z
system:basic-user                                                      <span class="m">2021</span>-09-23T10:29:15Z
system:certificates.k8s.io:certificatesigningrequests:nodeclient       <span class="m">2021</span>-09-23T10:29:16Z
system:certificates.k8s.io:certificatesigningrequests:selfnodeclient   <span class="m">2021</span>-09-23T10:29:16Z
system:certificates.k8s.io:kube-apiserver-client-approver              <span class="m">2021</span>-09-23T10:29:16Z
system:certificates.k8s.io:kube-apiserver-client-kubelet-approver      <span class="m">2021</span>-09-23T10:29:16Z
system:certificates.k8s.io:kubelet-serving-approver                    <span class="m">2021</span>-09-23T10:29:16Z
system:certificates.k8s.io:legacy-unknown-approver                     <span class="m">2021</span>-09-23T10:29:16Z
system:controller:attachdetach-controller                              <span class="m">2021</span>-09-23T10:29:16Z
system:controller:certificate-controller                               <span class="m">2021</span>-09-23T10:29:17Z
system:controller:clusterrole-aggregation-controller                   <span class="m">2021</span>-09-23T10:29:16Z
system:controller:cronjob-controller                                   <span class="m">2021</span>-09-23T10:29:16Z
system:controller:daemon-set-controller                                <span class="m">2021</span>-09-23T10:29:16Z
system:controller:deployment-controller                                <span class="m">2021</span>-09-23T10:29:16Z
system:controller:disruption-controller                                <span class="m">2021</span>-09-23T10:29:16Z
system:controller:endpoint-controller                                  <span class="m">2021</span>-09-23T10:29:16Z
system:controller:endpointslice-controller                             <span class="m">2021</span>-09-23T10:29:16Z
system:controller:endpointslicemirroring-controller                    <span class="m">2021</span>-09-23T10:29:16Z
system:controller:expand-controller                                    <span class="m">2021</span>-09-23T10:29:16Z
system:controller:generic-garbage-collector                            <span class="m">2021</span>-09-23T10:29:16Z
system:controller:horizontal-pod-autoscaler                            <span class="m">2021</span>-09-23T10:29:16Z
system:controller:job-controller                                       <span class="m">2021</span>-09-23T10:29:16Z
system:controller:namespace-controller                                 <span class="m">2021</span>-09-23T10:29:16Z
system:controller:node-controller                                      <span class="m">2021</span>-09-23T10:29:17Z
system:controller:persistent-volume-binder                             <span class="m">2021</span>-09-23T10:29:17Z
system:controller:pod-garbage-collector                                <span class="m">2021</span>-09-23T10:29:17Z
system:controller:pv-protection-controller                             <span class="m">2021</span>-09-23T10:29:17Z
system:controller:pvc-protection-controller                            <span class="m">2021</span>-09-23T10:29:17Z
system:controller:replicaset-controller                                <span class="m">2021</span>-09-23T10:29:17Z
system:controller:replication-controller                               <span class="m">2021</span>-09-23T10:29:17Z
system:controller:resourcequota-controller                             <span class="m">2021</span>-09-23T10:29:17Z
system:controller:root-ca-cert-publisher                               <span class="m">2021</span>-09-23T10:29:17Z
system:controller:route-controller                                     <span class="m">2021</span>-09-23T10:29:17Z
system:controller:service-account-controller                           <span class="m">2021</span>-09-23T10:29:17Z
system:controller:service-controller                                   <span class="m">2021</span>-09-23T10:29:17Z
system:controller:statefulset-controller                               <span class="m">2021</span>-09-23T10:29:17Z
system:controller:ttl-controller                                       <span class="m">2021</span>-09-23T10:29:17Z
system:coredns                                                         <span class="m">2021</span>-09-23T10:29:20Z
system:discovery                                                       <span class="m">2021</span>-09-23T10:29:15Z
system:heapster                                                        <span class="m">2021</span>-09-23T10:29:16Z
system:kube-aggregator                                                 <span class="m">2021</span>-09-23T10:29:16Z
system:kube-controller-manager                                         <span class="m">2021</span>-09-23T10:29:16Z
system:kube-dns                                                        <span class="m">2021</span>-09-23T10:29:16Z
system:kube-scheduler                                                  <span class="m">2021</span>-09-23T10:29:16Z
system:kubelet-api-admin                                               <span class="m">2021</span>-09-23T10:29:16Z
system:monitoring                                                      <span class="m">2021</span>-09-23T10:29:15Z
system:node                                                            <span class="m">2021</span>-09-23T10:29:16Z
system:node-bootstrapper                                               <span class="m">2021</span>-09-23T10:29:16Z
system:node-problem-detector                                           <span class="m">2021</span>-09-23T10:29:16Z
system:node-proxier                                                    <span class="m">2021</span>-09-23T10:29:16Z
system:persistent-volume-provisioner                                   <span class="m">2021</span>-09-23T10:29:16Z
system:public-info-viewer                                              <span class="m">2021</span>-09-23T10:29:15Z
system:service-account-issuer-discovery                                <span class="m">2021</span>-09-23T10:29:16Z
system:volume-scheduler                                                <span class="m">2021</span>-09-23T10:29:16Z
view                                                                   <span class="m">2021</span>-09-23T10:29:16Z
root@controlplane:~# kubectl  get clusterrole  <span class="p">|</span> wc -l
<span class="m">64</span>
root@controlplane:~#



root@controlplane:~# kubectl get clusterrolebindings                           
NAME                                                   ROLE                                                                               AGE
cluster-admin                                          ClusterRole/cluster-admin                                                          4m9s
flannel                                                ClusterRole/flannel                                                                3m58s
kubeadm:get-nodes                                      ClusterRole/kubeadm:get-nodes                                                      4m7s
kubeadm:kubelet-bootstrap                              ClusterRole/system:node-bootstrapper                                               4m7s
kubeadm:node-autoapprove-bootstrap                     ClusterRole/system:certificates.k8s.io:certificatesigningrequests:nodeclient       4m7s
kubeadm:node-autoapprove-certificate-rotation          ClusterRole/system:certificates.k8s.io:certificatesigningrequests:selfnodeclient   4m7s
kubeadm:node-proxier                                   ClusterRole/system:node-proxier                                                    4m5s
system:basic-user                                      ClusterRole/system:basic-user                                                      4m9s
system:controller:attachdetach-controller              ClusterRole/system:controller:attachdetach-controller                              4m9s
system:controller:certificate-controller               ClusterRole/system:controller:certificate-controller                               4m8s
system:controller:clusterrole-aggregation-controller   ClusterRole/system:controller:clusterrole-aggregation-controller                   4m9s
system:controller:cronjob-controller                   ClusterRole/system:controller:cronjob-controller                                   4m9s
system:controller:daemon-set-controller                ClusterRole/system:controller:daemon-set-controller                                4m9s
system:controller:deployment-controller                ClusterRole/system:controller:deployment-controller                                4m9s
system:controller:disruption-controller                ClusterRole/system:controller:disruption-controller                                4m9s
system:controller:endpoint-controller                  ClusterRole/system:controller:endpoint-controller                                  4m9s
system:controller:endpointslice-controller             ClusterRole/system:controller:endpointslice-controller                             4m9s
system:controller:endpointslicemirroring-controller    ClusterRole/system:controller:endpointslicemirroring-controller                    4m9s
system:controller:expand-controller                    ClusterRole/system:controller:expand-controller                                    4m9s
system:controller:generic-garbage-collector            ClusterRole/system:controller:generic-garbage-collector                            4m9s
system:controller:horizontal-pod-autoscaler            ClusterRole/system:controller:horizontal-pod-autoscaler                            4m9s
system:controller:job-controller                       ClusterRole/system:controller:job-controller                                       4m9s
system:controller:namespace-controller                 ClusterRole/system:controller:namespace-controller                                 4m9s
system:controller:node-controller                      ClusterRole/system:controller:node-controller                                      4m9s
system:controller:persistent-volume-binder             ClusterRole/system:controller:persistent-volume-binder                             4m9s
system:controller:pod-garbage-collector                ClusterRole/system:controller:pod-garbage-collector                                4m8s
system:controller:pv-protection-controller             ClusterRole/system:controller:pv-protection-controller                             4m8s
system:controller:pvc-protection-controller            ClusterRole/system:controller:pvc-protection-controller                            4m8s
system:controller:replicaset-controller                ClusterRole/system:controller:replicaset-controller                                4m8s
system:controller:replication-controller               ClusterRole/system:controller:replication-controller                               4m8s
system:controller:resourcequota-controller             ClusterRole/system:controller:resourcequota-controller                             4m8s
system:controller:root-ca-cert-publisher               ClusterRole/system:controller:root-ca-cert-publisher                               4m8s
system:controller:route-controller                     ClusterRole/system:controller:route-controller                                     4m8s
system:controller:service-account-controller           ClusterRole/system:controller:service-account-controller                           4m8s
system:controller:service-controller                   ClusterRole/system:controller:service-controller                                   4m8s
system:controller:statefulset-controller               ClusterRole/system:controller:statefulset-controller                               4m8s
system:controller:ttl-controller                       ClusterRole/system:controller:ttl-controller                                       4m8s
system:coredns                                         ClusterRole/system:coredns                                                         4m6s
system:discovery                                       ClusterRole/system:discovery                                                       4m9s
system:kube-controller-manager                         ClusterRole/system:kube-controller-manager                                         4m9s
system:kube-dns                                        ClusterRole/system:kube-dns                                                        4m9s
system:kube-scheduler                                  ClusterRole/system:kube-scheduler                                                  4m9s
system:monitoring                                      ClusterRole/system:monitoring                                                      4m9s
system:node                                            ClusterRole/system:node                                                            4m9s
system:node-proxier                                    ClusterRole/system:node-proxier                                                    4m9s
system:public-info-viewer                              ClusterRole/system:public-info-viewer                                              4m9s
system:service-account-issuer-discovery                ClusterRole/system:service-account-issuer-discovery                                4m9s
system:volume-scheduler                                ClusterRole/system:volume-scheduler                                                4m9s
root@controlplane:~# kubectl get clusterrolebindings <span class="p">|</span> wc -l
<span class="m">49</span>
root@controlplane:~# 

root@controlplane:~# kubectl create clusterrole michelle-cluster-role --verb<span class="o">=</span>create,list,delete --resource<span class="o">=</span>nodes --dry-run<span class="o">=</span>client -o yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: michelle-cluster-role
rules:
- apiGroups:
  - <span class="s2">&quot;&quot;</span>
  resources:
  - nodes
  verbs:
  - create
  - list
  - delete
root@controlplane:~# 

root@controlplane:~# kubectl create clusterrolebinding michelle-clusterbinding --clusterrole<span class="o">=</span>michelle-cluster-admin --user<span class="o">=</span>michelle --dry-run<span class="o">=</span>client -o yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  creationTimestamp: null
  name: michelle-clusterbinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: michelle-cluster-admin
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: User
  name: michelle
root@controlplane:~# ls -rtlh
total <span class="m">4</span>.0K
-rw-rw-rw- <span class="m">1</span> root root   <span class="m">0</span> Sep <span class="m">14</span> <span class="m">01</span>:32 sample.yaml
-rw-r--r-- <span class="m">1</span> root root <span class="m">201</span> Sep <span class="m">23</span> <span class="m">10</span>:40 michelle-cluster-roles.yaml
root@controlplane:~# vim michelle-cluster-roles.yaml 
root@controlplane:~# kubectl apply -f michelle-cluster-roles.yaml
clusterrole.rbac.authorization.k8s.io/michelle-cluster-role created
clusterrolebinding.rbac.authorization.k8s.io/michelle-clusterbinding created
root@controlplane:~# 


michelles responsibilities are growing and now she will be responsible <span class="k">for</span> storage as well. 
Create the required ClusterRoles and ClusterRoleBindings to allow her access to Storage.

Get the API groups and resource names from <span class="nb">command</span> kubectl api-resources.

ClusterRole: storage-admin
Resource: persistentvolumes
Resource: storageclasses
ClusterRoleBinding: michelle-storage-admin
ClusterRoleBinding Subject: michelle
ClusterRoleBinding Role: storage-admin

Get the API groups and resource names from <span class="nb">command</span> kubectl api-resources. Use the given spec:

root@controlplane:~# kubectl api-resources --namespaced<span class="o">=</span><span class="nb">false</span> <span class="p">|</span> grep -i storage
csidrivers                                     storage.k8s.io/v1                      <span class="nb">false</span>        CSIDriver
csinodes                                       storage.k8s.io/v1                      <span class="nb">false</span>        CSINode
storageclasses                    sc           storage.k8s.io/v1                      <span class="nb">false</span>        StorageClass
volumeattachments                              storage.k8s.io/v1                      <span class="nb">false</span>        VolumeAttachment
root@controlplane:~# kubectl api-resources --namespaced<span class="o">=</span><span class="nb">false</span> <span class="p">|</span> grep -i volumes
persistentvolumes                 pv           v1                                     <span class="nb">false</span>        PersistentVolume
root@controlplane:~# 

root@controlplane:~# cat michelle-cluster.yaml 
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: storage-admin
rules:
- apiGroups: <span class="o">[</span><span class="s2">&quot;&quot;</span><span class="o">]</span>
  resources: <span class="o">[</span><span class="s2">&quot;persistentvolumes&quot;</span><span class="o">]</span>
  verbs: <span class="o">[</span><span class="s2">&quot;get&quot;</span>, <span class="s2">&quot;watch&quot;</span>, <span class="s2">&quot;list&quot;</span>, <span class="s2">&quot;create&quot;</span>, <span class="s2">&quot;delete&quot;</span><span class="o">]</span>
- apiGroups: <span class="o">[</span><span class="s2">&quot;storage.k8s.io&quot;</span><span class="o">]</span>
  resources: <span class="o">[</span><span class="s2">&quot;storageclasses&quot;</span><span class="o">]</span>
  verbs: <span class="o">[</span><span class="s2">&quot;get&quot;</span>, <span class="s2">&quot;watch&quot;</span>, <span class="s2">&quot;list&quot;</span>, <span class="s2">&quot;create&quot;</span>, <span class="s2">&quot;delete&quot;</span><span class="o">]</span>

---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: michelle-storage-admin
subjects:
- kind: User
  name: michelle
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: storage-admin
  apiGroup: rbac.authorization.k8s.io
root@controlplane:~#


root@controlplane:~# vim michelle-cluster.yaml
root@controlplane:~# kubectl apply -f michelle-cluster.yaml
clusterrole.rbac.authorization.k8s.io/storage-admin created
clusterrolebinding.rbac.authorization.k8s.io/michelle-storage-admin created
root@controlplane:~# 
</pre></div>
</div>
</div>
<p>k8sserviceaccount</p>
<div class="literal-block-wrapper docutils container" id="id34">
<div class="code-block-caption"><span class="caption-text">k8sserviceaccount</span><a class="headerlink" href="#id34" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>service accounts <span class="k">in</span> kubernetes:
------------------------------------&gt;

There are two types of accounts <span class="k">in</span> k8s

<span class="m">1</span>. User accounts --&gt; used by users
user accounts is an administrator who performing the cluster upgrade or node reboot :<span class="o">)</span> 

<span class="m">2</span>. Service accounts --&gt; used by machines
A service account could be an account used by an application to interact with a kubernetes cluster.

For example: A monitoring application like prometheus uses a service account to poll the kubernetes API <span class="k">for</span> performance metrics
and an automated build tool like jenkins uses a service account to deploy the application <span class="k">in</span> kubernetes cluster.


MacBook-Pro:6.Security bharathdasaraju$ kubectl create serviceaccount dashboard-sa
serviceaccount/dashboard-sa created
MacBook-Pro:6.Security bharathdasaraju$ kubectl get sa
NAME           SECRETS   AGE
dashboard-sa   <span class="m">1</span>         42s
default        <span class="m">1</span>         19d
MacBook-Pro:6.Security bharathdasaraju$ 


MacBook-Pro:6.Security bharathdasaraju$ kubectl describe sa dashboard-sa
Name:                dashboard-sa
Namespace:           default
Labels:              &lt;none&gt;
Annotations:         &lt;none&gt;
Image pull secrets:  &lt;none&gt;
Mountable secrets:   dashboard-sa-token-zvz8j
Tokens:              dashboard-sa-token-zvz8j
Events:              &lt;none&gt;
MacBook-Pro:6.Security bharathdasaraju$ 


MacBook-Pro:6.Security bharathdasaraju$ kubectl describe secret dashboard-sa-token-zvz8j
Name:         dashboard-sa-token-zvz8j
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  kubernetes.io/service-account.name: dashboard-sa
              kubernetes.io/service-account.uid: f8f95fe6-d654-4cac-a8c2-26d50d4995df

Type:  kubernetes.io/service-account-token

<span class="nv">Data</span>
<span class="o">====</span>
ca.crt:     <span class="m">1066</span> bytes
namespace:  <span class="m">7</span> bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IjNZMmtub0JrMENOVG91QW1TdUYwR1RKUTRkTEJldXdaUllCaDhKOGFlLVkifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImRhc2hib2FyZC1zYS10b2tlbi16dno4aiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJkYXNoYm9hcmQtc2EiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJmOGY5NWZlNi1kNjU0LTRjYWMtYThjMi0yNmQ1MGQ0OTk1ZGYiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZGVmYXVsdDpkYXNoYm9hcmQtc2EifQ.m1SBFXAh1UBxyDbyo8q4C3b55oE_GKZv3YW6kwF_IuEz0s9oVYa4i0G7nh8zs1LB2D6mrwGK2G9Y9BV6dH08woCdXJJOpkZH_h8gdwAMWVsMByuBJUwwm-hyRx0X7-O332v6kjhCd7XDQ8TPfz2GLMKC2YO9m_Oe3E1EbQkBWfzJnFHoIN7mWwwvHXdeov3rlDQSxM7MwxHx4JHT1NoSu15SJarcOQ8LXsulYW394InejrR1eQBwYa9yLBuN0Fgj8QwWqY60hJihd-T9vGqfuzRGm3FWePhosZirVjiajR2-pwAAd2o5cfCpr5ZPO4WKdoMLs81r4KOLB4Wbh_RB_A
MacBook-Pro:6.Security bharathdasaraju$ 


We can use this token as <span class="s2">&quot;Bearer Token&quot;</span> to query the kubernetes API and get the resutls to our app.

curl https://192.168.56.70:6443/api --insecure --header <span class="s2">&quot;Authorization: Bearer eyJhbGciOiJSU....81r4KOLB4Wbh_RB_A&quot;</span>

<span class="k">if</span> you run the application inside the same  kubernetes cluster, we can mount the secret token as a volume so that it automatically availble inside a pod.

MacBook-Pro:6.Security bharathdasaraju$ kubectl get sa
NAME           SECRETS   AGE
dashboard-sa   <span class="m">1</span>         9m21s
default        <span class="m">1</span>         19d
MacBook-Pro:6.Security bharathdasaraju$ kubectl describe sa default
Name:                default
Namespace:           default
Labels:              &lt;none&gt;
Annotations:         &lt;none&gt;
Image pull secrets:  &lt;none&gt;
Mountable secrets:   default-token-lxpp9
Tokens:              default-token-lxpp9
Events:              &lt;none&gt;
MacBook-Pro:6.Security bharathdasaraju$ kubectl describe secret default-token-lxpp9
Name:         default-token-lxpp9
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  kubernetes.io/service-account.name: default
              kubernetes.io/service-account.uid: 7a0dc882-5dd6-4233-90c7-e8502644250e

Type:  kubernetes.io/service-account-token

<span class="nv">Data</span>
<span class="o">====</span>
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IjNZMmtub0JrMENOVG91QW1TdUYwR1RKUTRkTEJldXdaUllCaDhKOGFlLVkifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImRlZmF1bHQtdG9rZW4tbHhwcDkiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGVmYXVsdCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjdhMGRjODgyLTVkZDYtNDIzMy05MGM3LWU4NTAyNjQ0MjUwZSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.DNsKGkklsdZ9dpaTH_hT29tHhD3-HiFQ8lctdPGaZGudKSkfe2nSEFoWsc5nO_sqrAg-t-s4ZLf5xsR1cYfbdh7Dqshx5MFS9RzZN5gy05em7Q3aoKfx3nXtN8wsnHlWejSAgrTUYjIhcmy3lJCFWZzFQO66OScVI2Dl9tqXM8plnLEmHGSd-InEZSI4B_Y4EWlYQi6Q8rQBzHVnn1pioztQzIQlhDIw0s0D7MGikVLdWChNDn0fdHqcBbGGasS0jxHrtu9WbYGy26q3ZqIjEsgGzygOv15L92AAnmXYcvDMcMKlRcRgpH02kodWLrmMxSj9-3pnXfkwqcoRqRBfOA
ca.crt:     <span class="m">1066</span> bytes
namespace:  <span class="m">7</span> bytes
MacBook-Pro:6.Security bharathdasaraju$ 



MacBook-Pro:6.Security bharathdasaraju$ kubectl run nginx --image<span class="o">=</span>nginx
pod/nginx created
MacBook-Pro:6.Security bharathdasaraju$

<span class="s2">&quot;if we deacribe the pod....we can see below secret token mounted to pod&quot;</span>
<span class="s2">&quot;=========================================================================================================&quot;</span>
Containers:
  nginx:
    Container ID:   docker://f4fcdfa20357c5fcd21548a564214ecc6c9eb7bb0a08c4f385ec8cb65791c02d
    Image:          nginx
    Image ID:       docker-pullable://nginx@sha256:853b221d3341add7aaadf5f81dd088ea943ab9c918766e295321294b035f3f3e
    Port:           &lt;none&gt;
    Host Port:      &lt;none&gt;
    State:          Running
      Started:      Thu, <span class="m">23</span> Sep <span class="m">2021</span> <span class="m">21</span>:19:33 +0800
    Ready:          True
    Restart Count:  <span class="m">0</span>
    Environment:    &lt;none&gt;
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-lxpp9 <span class="o">(</span>ro<span class="o">)</span>
Volumes:
  default-token-lxpp9:
    Type:        Secret <span class="o">(</span>a volume populated by a Secret<span class="o">)</span>
    SecretName:  default-token-lxpp9
    Optional:    <span class="nb">false</span>
<span class="s2">&quot;=============================================================================================&quot;</span>

MacBook-Pro:6.Security bharathdasaraju$ kubectl describe pod nginx
Name:         nginx
Namespace:    default
Priority:     <span class="m">0</span>
Node:         minikube/192.168.49.2
Start Time:   Thu, <span class="m">23</span> Sep <span class="m">2021</span> <span class="m">21</span>:19:26 +0800
Labels:       <span class="nv">run</span><span class="o">=</span>nginx
Annotations:  &lt;none&gt;
Status:       Running
IP:           <span class="m">172</span>.17.0.4
IPs:
  IP:  <span class="m">172</span>.17.0.4
Containers:
  nginx:
    Container ID:   docker://f4fcdfa20357c5fcd21548a564214ecc6c9eb7bb0a08c4f385ec8cb65791c02d
    Image:          nginx
    Image ID:       docker-pullable://nginx@sha256:853b221d3341add7aaadf5f81dd088ea943ab9c918766e295321294b035f3f3e
    Port:           &lt;none&gt;
    Host Port:      &lt;none&gt;
    State:          Running
      Started:      Thu, <span class="m">23</span> Sep <span class="m">2021</span> <span class="m">21</span>:19:33 +0800
    Ready:          True
    Restart Count:  <span class="m">0</span>
    Environment:    &lt;none&gt;
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-lxpp9 <span class="o">(</span>ro<span class="o">)</span>
Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 
Volumes:
  default-token-lxpp9:
    Type:        Secret <span class="o">(</span>a volume populated by a Secret<span class="o">)</span>
    SecretName:  default-token-lxpp9
    Optional:    <span class="nb">false</span>
QoS Class:       BestEffort
Node-Selectors:  &lt;none&gt;
Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class="nv">op</span><span class="o">=</span>Exists <span class="k">for</span> 300s
                 node.kubernetes.io/unreachable:NoExecute <span class="nv">op</span><span class="o">=</span>Exists <span class="k">for</span> 300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  16s   default-scheduler  Successfully assigned default/nginx to minikube
  Normal  Pulling    15s   kubelet            Pulling image <span class="s2">&quot;nginx&quot;</span>
  Normal  Pulled     9s    kubelet            Successfully pulled image <span class="s2">&quot;nginx&quot;</span> <span class="k">in</span> <span class="m">5</span>.7508824s
  Normal  Created    9s    kubelet            Created container nginx
  Normal  Started    9s    kubelet            Started container nginx
MacBook-Pro:6.Security bharathdasaraju$

MacBook-Pro:6.Security bharathdasaraju$ kubectl run nginx --image<span class="o">=</span>nginx --dry-run<span class="o">=</span>client -o yaml &gt; pod_with_serviceaccount.yaml
MacBook-Pro:6.Security bharathdasaraju$ 


By default ....default serviceaccount token gets mounted to pod specification file.
<span class="k">if</span> you <span class="k">do</span> not want default service account to get mounted to pod we need use <span class="s2">&quot;automountServiceAccountToken: false&quot;</span>

apiVersion: v1
kind: Pod
metadata:
  labels:
    run: nginx
  name: nginx
spec:
  containers:
  - image: nginx
    name: nginx
  automountServiceAccountToken: <span class="nb">false</span>
</pre></div>
</div>
</div>
<p>k8sserviceaccountlabs</p>
<div class="literal-block-wrapper docutils container" id="id35">
<div class="code-block-caption"><span class="caption-text">k8sserviceaccountlabs</span><a class="headerlink" href="#id35" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@controlplane:/# kubectl get sa
NAME      SECRETS   AGE
default   <span class="m">1</span>         13m
root@controlplane:/# 

root@controlplane:/# kubectl describe sa default
Name:                default
Namespace:           default
Labels:              &lt;none&gt;
Annotations:         &lt;none&gt;
Image pull secrets:  &lt;none&gt;
Mountable secrets:   default-token-xvpxp
Tokens:              default-token-xvpxp
Events:              &lt;none&gt;
root@controlplane:/# 


The application needs a ServiceAccount with the Right permissions to be created to authenticate to Kubernetes. 
The <span class="s1">&#39;default&#39;</span> ServiceAccount has limited access. Create a new ServiceAccount named <span class="s1">&#39;dashboard-sa&#39;</span>.

root@controlplane:/var/rbac# kubectl get sa
NAME           SECRETS   AGE
dashboard-sa   <span class="m">1</span>         42s
default        <span class="m">1</span>         23m
root@controlplane:/var/rbac# kubectl describe sa dashboard-sa 
Name:                dashboard-sa
Namespace:           default
Labels:              &lt;none&gt;
Annotations:         &lt;none&gt;
Image pull secrets:  &lt;none&gt;
Mountable secrets:   dashboard-sa-token-b7qmk
Tokens:              dashboard-sa-token-b7qmk
Events:              &lt;none&gt;
root@controlplane:/var/rbac# 


root@controlplane:/var/rbac# <span class="nb">pwd</span>
/var/rbac
root@controlplane:/var/rbac#  ls -lrth
total <span class="m">8</span>.0K
-rw-rw-rw- <span class="m">1</span> root root <span class="m">191</span> Sep <span class="m">14</span> <span class="m">01</span>:32 pod-reader-role.yaml
-rw-rw-rw- <span class="m">1</span> root root <span class="m">399</span> Sep <span class="m">14</span> <span class="m">01</span>:32 dashboard-sa-role-binding.yaml
root@controlplane:/var/rbac# 


root@controlplane:/var/rbac# cat pod-reader-role.yaml 
---
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  namespace: default
  name: pod-reader
rules:
- apiGroups:
  - <span class="s1">&#39;&#39;</span>
  resources:
  - pods
  verbs:
  - get
  - watch
  - list
root@controlplane:/var/rbac# 


root@controlplane:/var/rbac# cat dashboard-sa-role-binding.yaml 
---
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: read-pods
  namespace: default
subjects:
- kind: ServiceAccount
  name: dashboard-sa <span class="c1"># Name is case sensitive</span>
  namespace: default
roleRef:
  kind: Role <span class="c1">#this must be Role or ClusterRole</span>
  name: pod-reader <span class="c1"># this must match the name of the Role or ClusterRole you wish to bind to</span>
  apiGroup: rbac.authorization.k8s.io
root@controlplane:/var/rbac# 




root@controlplane:/var/rbac# kubectl describe sa dashboard-sa
Name:                dashboard-sa
Namespace:           default
Labels:              &lt;none&gt;
Annotations:         &lt;none&gt;
Image pull secrets:  &lt;none&gt;
Mountable secrets:   dashboard-sa-token-b7qmk
Tokens:              dashboard-sa-token-b7qmk
Events:              &lt;none&gt;
root@controlplane:/var/rbac# kubectl describe secrets dashboard-sa-token-b7qmk
Name:         dashboard-sa-token-b7qmk
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  kubernetes.io/service-account.name: dashboard-sa
              kubernetes.io/service-account.uid: 52508e72-5bcb-4c89-952b-d9c9b47c9d0d

Type:  kubernetes.io/service-account-token

<span class="nv">Data</span>
<span class="o">====</span>
ca.crt:     <span class="m">1066</span> bytes
namespace:  <span class="m">7</span> bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6InlDaGMxZXhicXpIMUZrQUlJR3dfTm5DTVBBaDUzYUtwTzZLWmZRdjBjUjAifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImRhc2hib2FyZC1zYS10b2tlbi1iN3FtayIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJkYXNoYm9hcmQtc2EiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI1MjUwOGU3Mi01YmNiLTRjODktOTUyYi1kOWM5YjQ3YzlkMGQiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZGVmYXVsdDpkYXNoYm9hcmQtc2EifQ.GcDrsRVcSZ2O4obe-q5MkK04-AVAzZNHysk_F-gr5_eXaXcxDU2bVTD3Rulahf6bmPg5HVZ-XigVs3JbAzTSCd2dngz3I55yaQ1lqTxq6wwvVb7hidnUkI2i7sFZQNVRUW_54BuArhFDIRjGpbiTn0J8rpzbHdww3sb6YEZWyhvHRIbAO5VXTxGIfLFRCjwOUBe_g2Gd6r8ChXFT5WOac4MHJUCPRBIhIn0fgH1b2vpBzYXy_BaN_Gy1Q5702LGbyBzfiKNWph9D8Mxkgd_ynISZi79vK8UjsIK5XSduE-XpPma6GDBly0ZK9OLJI2iAAXoMxdoISSzqjjPU5ZhGew
root@controlplane:/var/rbac#



root@controlplane:~# kubectl edit deployment.apps/web-dashboard
deployment.apps/web-dashboard edited
root@controlplane:~# 
    spec:
      serviceAccountName: dashboard-sa
      containers:
      - image: gcr.io/kodekloud/customimage/my-kubernetes-dashboard
        imagePullPolicy: Always
        name: web-dashboard
        ports:
        - containerPort: <span class="m">8080</span>
          protocol: TCP 
</pre></div>
</div>
</div>
<p>deploymentwithSA</p>
<div class="literal-block-wrapper docutils container" id="id36">
<div class="code-block-caption"><span class="caption-text">deploymentwithSA</span><a class="headerlink" href="#id36" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web-dashboard</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web-dashboard</span>
  <span class="nt">strategy</span><span class="p">:</span>
    <span class="nt">rollingUpdate</span><span class="p">:</span>
      <span class="nt">maxSurge</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">25%</span>
      <span class="nt">maxUnavailable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">25%</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">creationTimestamp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web-dashboard</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">serviceAccountName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dashboard-sa</span>
      <span class="nt">containers</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gcr.io/kodekloud/customimage/my-kubernetes-dashboard</span>
        <span class="nt">imagePullPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Always</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web-dashboard</span>
        <span class="nt">ports</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
          <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
</pre></div>
</div>
</div>
<p>k8sdashboardrole</p>
<div class="literal-block-wrapper docutils container" id="id37">
<div class="code-block-caption"><span class="caption-text">k8sdashboardrole</span><a class="headerlink" href="#id37" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pod-reader</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&#39;&#39;</span>
  <span class="nt">resources</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pods</span>
  <span class="nt">verbs</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">get</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">watch</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">list</span>

<span class="nn">---</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">read-pods</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dashboard-sa</span> <span class="c1"># Name is case sensitive</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">roleRef</span><span class="p">:</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span> <span class="c1">#this must be Role or ClusterRole</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pod-reader</span> <span class="c1"># this must match the name of the Role or ClusterRole you wish to bind to</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</pre></div>
</div>
</div>
<p>secureImages</p>
<div class="literal-block-wrapper docutils container" id="id38">
<div class="code-block-caption"><span class="caption-text">secureImages</span><a class="headerlink" href="#id38" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">MacBook-Pro:6.Security bharathdasaraju$ kubectl create deployment webapp --image=nginx</span> 
<span class="l l-Scalar l-Scalar-Plain">deployment.apps/webapp created</span>
<span class="l l-Scalar l-Scalar-Plain">MacBook-Pro:6.Security bharathdasaraju$</span> 


<span class="l l-Scalar l-Scalar-Plain">the deployment to use a new image from myprivateregistry.com:5000</span>
<span class="l l-Scalar l-Scalar-Plain">The registry is located at myprivateregistry.com:5000</span>



<span class="l l-Scalar l-Scalar-Plain">Create a secret object with the credentials required to access the registry.</span>


<span class="l l-Scalar l-Scalar-Plain">Name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">private-reg-cred</span>
<span class="nt">Username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dock_user</span>
<span class="nt">Password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dock_password</span>
<span class="nt">Server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myprivateregistry.com:5000</span>
<span class="nt">Email</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dock_user@myprivateregistry.com</span>

<span class="nt">Secret</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">private-reg-cred</span>
<span class="nt">Secret Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">docker-registry</span>
<span class="l l-Scalar l-Scalar-Plain">Secret Data</span>


<span class="l l-Scalar l-Scalar-Plain">MacBook-Pro:6.Security bharathdasaraju$ kubectl create secret docker-registry private-reg-cred --docker-server=myprivateregistry.com:5000 --docker-username=dock_user --docker-password=dock_password --docker-email=test@gmail.com</span>
<span class="l l-Scalar l-Scalar-Plain">secret/private-reg-cred created</span>
<span class="l l-Scalar l-Scalar-Plain">MacBook-Pro:6.Security bharathdasaraju$</span>

<span class="l l-Scalar l-Scalar-Plain">MacBook-Pro:6.Security bharathdasaraju$ kubectl describe secret private-reg-cred</span>
<span class="nt">Name</span><span class="p">:</span>         <span class="l l-Scalar l-Scalar-Plain">private-reg-cred</span>
<span class="nt">Namespace</span><span class="p">:</span>    <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">Labels</span><span class="p">:</span>       <span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<span class="nt">Annotations</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>

<span class="nt">Type</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/dockerconfigjson</span>

<span class="l l-Scalar l-Scalar-Plain">Data</span>
<span class="l l-Scalar l-Scalar-Plain">====</span>
<span class="nt">.dockerconfigjson</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">159 bytes</span>
<span class="l l-Scalar l-Scalar-Plain">MacBook-Pro:6.Security bharathdasaraju$</span> 


<span class="l l-Scalar l-Scalar-Plain">kubectl edit deploy web command and add &quot;imagePullSecrets&quot; section. Use private-reg-cred</span>

<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webapp</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webapp</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webapp</span>
  <span class="nt">strategy</span><span class="p">:</span>
    <span class="nt">rollingUpdate</span><span class="p">:</span>
      <span class="nt">maxSurge</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">25%</span>
      <span class="nt">maxUnavailable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">25%</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webapp</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">containers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myprivateregistry.com:5000/nginx:alpine</span> 
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
      <span class="nt">imagePullSecrets</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">private-reg-cred</span>
</pre></div>
</div>
</div>
<p>podwithSA</p>
<div class="literal-block-wrapper docutils container" id="id39">
<div class="code-block-caption"><span class="caption-text">podwithSA</span><a class="headerlink" href="#id39" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">run</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class="nt">serviceAccountName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dashboard-sa</span>
</pre></div>
</div>
</div>
<p>dockercredsinpod</p>
<div class="literal-block-wrapper docutils container" id="id40">
<div class="code-block-caption"><span class="caption-text">dockercredsinpod</span><a class="headerlink" href="#id40" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">run</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">private-registry.io/apps/internal-app</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class="nt">imagePullSecrets</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">regcred</span>
</pre></div>
</div>
</div>
<p>deploymentwithdockercreds</p>
<div class="literal-block-wrapper docutils container" id="id41">
<div class="code-block-caption"><span class="caption-text">deploymentwithdockercreds</span><a class="headerlink" href="#id41" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webapp</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webapp</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webapp</span>
  <span class="nt">strategy</span><span class="p">:</span>
    <span class="nt">rollingUpdate</span><span class="p">:</span>
      <span class="nt">maxSurge</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">25%</span>
      <span class="nt">maxUnavailable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">25%</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webapp</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">containers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myprivateregistry.com:5000/nginx:alpine</span> 
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
      <span class="nt">imagePullSecrets</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">private-reg-cred</span>
</pre></div>
</div>
</div>
<p>imagesecurity</p>
<div class="literal-block-wrapper docutils container" id="id42">
<div class="code-block-caption"><span class="caption-text">imagesecurity</span><a class="headerlink" href="#id42" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--image<span class="o">=</span>nginx --&gt; pulled from dokerhub   i.e. docker.io/nginx/nginx

gcr.io/kubernetes-e2e-test-image/dnsutils


docker login private-registry.io
docker run private-registry.io/apps/internal-app 


how to pass docker login credentials <span class="k">for</span> kubernetes, we can use k8s secret object to pass credentials of private registry.


MacBook-Pro:6.Security bharathdasaraju$ kubectl create secret docker-registry regcred <span class="se">\</span>
&gt; --docker-server<span class="o">=</span>private-registry.io/apps/internal-app <span class="se">\</span>
&gt; --docker-username<span class="o">=</span>bharath <span class="se">\</span>
&gt; --docker-password<span class="o">=</span>password12345 <span class="se">\</span>
&gt; --docker-email<span class="o">=</span>bhrth.dsra1@gmail.com
secret/regcred created
MacBook-Pro:6.Security bharathdasaraju$ kubectl describe secret regcred
Name:         regcred
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Type:  kubernetes.io/dockerconfigjson

<span class="nv">Data</span>
<span class="o">====</span>
.dockerconfigjson:  <span class="m">171</span> bytes
MacBook-Pro:6.Security bharathdasaraju$ 


MacBook-Pro:6.Security bharathdasaraju$ kubectl run nginx --image<span class="o">=</span>private-registry.io/apps/internal-app --dry-run<span class="o">=</span>client -o yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: nginx
  name: nginx
spec:
  containers:
  - image: private-registry.io/apps/internal-app
    name: nginx
  imagePullSecrets:
  - name: regcred
MacBook-Pro:6.Security bharathdasaraju$ 
</pre></div>
</div>
</div>
<p>dockersecurity</p>
<div class="literal-block-wrapper docutils container" id="id43">
<div class="code-block-caption"><span class="caption-text">dockersecurity</span><a class="headerlink" href="#id43" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>MacBook-Pro:6.Security bharathdasaraju$ docker run ubuntu sleep <span class="m">100</span>



MacBook-Pro:certified_kubernetes_administrator bharathdasaraju$ docker ps <span class="p">|</span> grep -i ubuntu
909d1fe5ebab        ubuntu                                <span class="s2">&quot;sleep 100&quot;</span>              <span class="m">40</span> seconds ago      Up <span class="m">39</span> seconds                                                                                                                                              inspiring_dijkstra
MacBook-Pro:certified_kubernetes_administrator bharathdasaraju$ 

Inside docker container:
----------------------------&gt;
MacBook-Pro:certified_kubernetes_administrator bharathdasaraju$ docker <span class="nb">exec</span> -it a0d647aee08e sh
<span class="c1"># ps</span>
    PID TTY          TIME CMD
      <span class="m">6</span> pts/0    <span class="m">00</span>:00:00 sh
     <span class="m">11</span> pts/0    <span class="m">00</span>:00:00 ps
<span class="c1"># ps aux</span>
USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root           <span class="m">1</span>  <span class="m">0</span>.1  <span class="m">0</span>.0   <span class="m">2508</span>   <span class="m">516</span> ?        Ss   <span class="m">23</span>:55   <span class="m">0</span>:00 sleep <span class="m">100</span>
root           <span class="m">6</span>  <span class="m">0</span>.5  <span class="m">0</span>.0   <span class="m">2608</span>   <span class="m">604</span> pts/0    Ss   <span class="m">23</span>:56   <span class="m">0</span>:00 sh
root          <span class="m">12</span>  <span class="m">0</span>.0  <span class="m">0</span>.1   <span class="m">5896</span>  <span class="m">2776</span> pts/0    R+   <span class="m">23</span>:56   <span class="m">0</span>:00 ps aux
<span class="c1"># </span>

In the host:
-------------------------------------------------------------------------------------------------------------------------------&gt;
MacBook-Pro:certified_kubernetes_administrator bharathdasaraju$ ps aux <span class="p">|</span> grep -i sleep
bharathdasaraju  <span class="m">13768</span>   <span class="m">0</span>.0  <span class="m">0</span>.0  <span class="m">4268408</span>    <span class="m">688</span> s003  R+    <span class="m">7</span>:13am   <span class="m">0</span>:00.00 grep -i sleep
bharathdasaraju  <span class="m">13711</span>   <span class="m">0</span>.0  <span class="m">0</span>.1  <span class="m">4436660</span>  <span class="m">21436</span> s002  S+    <span class="m">7</span>:12am   <span class="m">0</span>:00.06 /usr/local/bin/com.docker.cli run ubuntu sleep <span class="m">100</span>
bharathdasaraju  <span class="m">13708</span>   <span class="m">0</span>.0  <span class="m">0</span>.1  <span class="m">5038428</span>  <span class="m">15224</span> s002  S+    <span class="m">7</span>:12am   <span class="m">0</span>:00.04 docker run ubuntu sleep <span class="m">100</span>
MacBook-Pro:certified_kubernetes_administrator bharathdasaraju$ 


by default docker runs processes with-in the container as a root user.

<span class="k">if</span> we dont want to run the processees as root user with-in the contaier we can <span class="nb">set</span> the  <span class="s2">&quot;--user=user_id&quot;</span> <span class="k">while</span> running the docker run

MacBook-Pro:6.Security bharathdasaraju$ docker run --user<span class="o">=</span><span class="m">1000</span> ubuntu sleep <span class="m">100</span>

MacBook-Pro:certified_kubernetes_administrator bharathdasaraju$ docker <span class="nb">exec</span> -it a0a3ea054709 sh 
$ ps aux
USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
<span class="m">1000</span>           <span class="m">1</span>  <span class="m">0</span>.0  <span class="m">0</span>.0   <span class="m">2508</span>   <span class="m">580</span> ?        Ss   <span class="m">00</span>:01   <span class="m">0</span>:00 sleep <span class="m">100</span>
<span class="m">1000</span>           <span class="m">6</span>  <span class="m">0</span>.3  <span class="m">0</span>.0   <span class="m">2608</span>   <span class="m">596</span> pts/0    Ss   <span class="m">00</span>:02   <span class="m">0</span>:00 sh
<span class="m">1000</span>          <span class="m">12</span>  <span class="m">0</span>.0  <span class="m">0</span>.1   <span class="m">5896</span>  <span class="m">2836</span> pts/0    R+   <span class="m">00</span>:02   <span class="m">0</span>:00 ps aux
$ 


We can also <span class="nb">set</span> this <span class="k">in</span> Dockerfile:

Dockerfile:
-----------------&gt;
FROM ubuntu

USER <span class="m">1000</span>



Linux Capabilities:
-------------------------&gt;
/usr/include/linux/capability.sh

docker run --cap-add MAC_ADMIN ubuntu
docker run --cap-drop KILL ubuntu

docker run --privileged ubuntu
</pre></div>
</div>
</div>
<p>securitycontexts</p>
<div class="literal-block-wrapper docutils container" id="id44">
<div class="code-block-caption"><span class="caption-text">securitycontexts</span><a class="headerlink" href="#id44" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">in</span> kubernetes containers are encapsulated <span class="k">in</span> pods.

We can choose to configure security settings at a container level and a pod level.




MacBook-Pro:6.Security bharathdasaraju$ kubectl run webpod --image<span class="o">=</span>ubuntu --command -- <span class="s2">&quot;sleep 100&quot;</span> --dry-run<span class="o">=</span>client -o yaml
pod/webpod created
MacBook-Pro:6.Security bharathdasaraju$ kubectl run webpod --image<span class="o">=</span>ubuntu --dry-run<span class="o">=</span>client -o yaml --command -- <span class="s2">&quot;sleep 100&quot;</span>
apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    run: webpod
  name: webpod
spec:
  containers:
  - command:
    - sleep <span class="m">100</span>
    image: ubuntu
    name: webpod
    resources: <span class="o">{}</span>
  dnsPolicy: ClusterFirst
  restartPolicy: Always
status: <span class="o">{}</span>
MacBook-Pro:6.Security bharathdasaraju$ 

securityContext configured at pod level:
------------------------------------------------------------------&gt;

apiVersion: v1
kind: Pod
metadata:
  labels:
    run: webpod
  name: webpod
spec:
  securityContext:
    runAsUser: <span class="m">1000</span>
  containers:
  - command: <span class="o">[</span><span class="s2">&quot;sleep&quot;</span>, <span class="s2">&quot;100&quot;</span><span class="o">]</span>
    image: ubuntu
    name: webpod


securityContext configured at container level:
------------------------------------------------------------------&gt;

apiVersion: v1
kind: Pod
metadata:
  labels:
    run: webpod
  name: webpod
spec:
  containers:
  - command: <span class="o">[</span><span class="s2">&quot;sleep&quot;</span>, <span class="s2">&quot;100&quot;</span><span class="o">]</span>
    image: ubuntu
    name: webpod
    securityContext:
      runAsUser: <span class="m">1000</span>
      capabilities:
        add: <span class="o">[</span><span class="s2">&quot;MAC_ADMIN&quot;</span><span class="o">]</span>
</pre></div>
</div>
</div>
<p>podsecuritycontext</p>
<div class="literal-block-wrapper docutils container" id="id45">
<div class="code-block-caption"><span class="caption-text">podsecuritycontext</span><a class="headerlink" href="#id45" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">run</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webpod</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webpod</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">securityContext</span><span class="p">:</span>
    <span class="nt">runAsUser</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1000</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;sleep&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;100&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webpod</span>
</pre></div>
</div>
</div>
<p>containersecuritycontext</p>
<div class="literal-block-wrapper docutils container" id="id46">
<div class="code-block-caption"><span class="caption-text">containersecuritycontext</span><a class="headerlink" href="#id46" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">run</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webpod</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webpod</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;sleep&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;100&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webpod</span>
    <span class="nt">securityContext</span><span class="p">:</span>
      <span class="nt">runAsUser</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1000</span>
      <span class="nt">capabilities</span><span class="p">:</span>
        <span class="nt">add</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;MAC_ADMIN&quot;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
<p>multipodsecuritycontext</p>
<div class="literal-block-wrapper docutils container" id="id47">
<div class="code-block-caption"><span class="caption-text">multipodsecuritycontext</span><a class="headerlink" href="#id47" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">multi-pod</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">securityContext</span><span class="p">:</span>
    <span class="nt">runAsUser</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1001</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span>  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
     <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
     <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;sleep&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;5000&quot;</span><span class="p p-Indicator">]</span>
     <span class="nt">securityContext</span><span class="p">:</span>
      <span class="nt">runAsUser</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1002</span>

  <span class="p p-Indicator">-</span>  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
     <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sidecar</span>
     <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;sleep&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;5000&quot;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
<p>securitycontextslabs</p>
<div class="literal-block-wrapper docutils container" id="id48">
<div class="code-block-caption"><span class="caption-text">securitycontextslabs</span><a class="headerlink" href="#id48" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@controlplane:~# kubectl get pods
NAME             READY   STATUS    RESTARTS   AGE
ubuntu-sleeper   <span class="m">1</span>/1     Running   <span class="m">0</span>          22s
root@controlplane:~# kubectl get pods ubuntu-sleeper -o yaml
apiVersion: v1
kind: Pod
metadata:
  name: ubuntu-sleeper
  namespace: default
spec:
  containers:
  - command:
    - sleep
    - <span class="s2">&quot;4800&quot;</span>
    image: ubuntu
    imagePullPolicy: Always
    name: ubuntu
    resources: <span class="o">{}</span>
    terminationMessagePath: /dev/termination-log
    terminationMessagePolicy: File
    volumeMounts:
    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
      name: default-token-pkzgr
      readOnly: <span class="nb">true</span>
  dnsPolicy: ClusterFirst
  enableServiceLinks: <span class="nb">true</span>
  nodeName: controlplane
  preemptionPolicy: PreemptLowerPriority
  priority: <span class="m">0</span>
  restartPolicy: Always
  schedulerName: default-scheduler
  securityContext:
    runAsUser: <span class="m">1010</span>
  serviceAccount: default
  serviceAccountName: default
  terminationGracePeriodSeconds: <span class="m">30</span>
  tolerations:
  - effect: NoExecute
    key: node.kubernetes.io/not-ready
    operator: Exists
    tolerationSeconds: <span class="m">300</span>
  - effect: NoExecute
    key: node.kubernetes.io/unreachable
    operator: Exists
    tolerationSeconds: <span class="m">300</span>
  volumes:
  - name: default-token-pkzgr
    secret:
      defaultMode: <span class="m">420</span>
      secretName: default-token-pkzgr
root@controlplane:~#



root@controlplane:~# kubectl delete pod ubuntu-sleeper 
pod <span class="s2">&quot;ubuntu-sleeper&quot;</span> deleted

kubectl appltroot@controlplane:~# 
root@controlplane:~# kubectl apply -f /tmp/kubectl-edit-vquy1.yaml
pod/ubuntu-sleeper created
root@controlplane:~# kubectl <span class="nb">exec</span> -it ubuntu-sleeper sh
kubectl <span class="nb">exec</span> <span class="o">[</span>POD<span class="o">]</span> <span class="o">[</span>COMMAND<span class="o">]</span> is DEPRECATED and will be removed <span class="k">in</span> a future version. Use kubectl <span class="nb">exec</span> <span class="o">[</span>POD<span class="o">]</span> -- <span class="o">[</span>COMMAND<span class="o">]</span> instead.
$ id
<span class="nv">uid</span><span class="o">=</span><span class="m">1010</span> <span class="nv">gid</span><span class="o">=</span><span class="m">0</span><span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span><span class="m">0</span><span class="o">(</span>root<span class="o">)</span>
$ 



root@controlplane:~# cat multi-pod.yaml 
apiVersion: v1
kind: Pod
metadata:
  name: multi-pod
spec:
  securityContext:
    runAsUser: <span class="m">1001</span>
  containers:
  -  image: ubuntu
     name: web
     command: <span class="o">[</span><span class="s2">&quot;sleep&quot;</span>, <span class="s2">&quot;5000&quot;</span><span class="o">]</span>
     securityContext:
      runAsUser: <span class="m">1002</span>

  -  image: ubuntu
     name: sidecar
     command: <span class="o">[</span><span class="s2">&quot;sleep&quot;</span>, <span class="s2">&quot;5000&quot;</span><span class="o">]</span>

root@controlplane:~# 



Update pod ubuntu-sleeper to run as Root user and with the SYS_TIME capability.
-----------------------------------------------------------------------------------------&gt;
apiVersion: v1
kind: Pod
metadata:
  name: ubuntu-sleeper
  namespace: default
spec:
  containers:
  - command:
    - sleep
    - <span class="s2">&quot;4800&quot;</span>
    image: ubuntu
    imagePullPolicy: Always
    name: ubuntu
    resources: <span class="o">{}</span>
    terminationMessagePath: /dev/termination-log
    terminationMessagePolicy: File
    volumeMounts:
    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
      name: default-token-pkzgr
      readOnly: <span class="nb">true</span>
  dnsPolicy: ClusterFirst
  enableServiceLinks: <span class="nb">true</span>
  nodeName: controlplane
  preemptionPolicy: PreemptLowerPriority
  priority: <span class="m">0</span>
  restartPolicy: Always
  schedulerName: default-scheduler
  securityContext:
    capabilities:
      add: <span class="o">[</span><span class="s2">&quot;SYS_TIME&quot;</span><span class="o">]</span>
  serviceAccount: default
  serviceAccountName: default
  terminationGracePeriodSeconds: <span class="m">30</span>
  tolerations:
  - effect: NoExecute
    key: node.kubernetes.io/not-ready
    operator: Exists
    tolerationSeconds: <span class="m">300</span>
  - effect: NoExecute
    key: node.kubernetes.io/unreachable
    operator: Exists
    tolerationSeconds: <span class="m">300</span>
  volumes:
  - name: default-token-pkzgr
    secret:
      defaultMode: <span class="m">420</span>
      secretName: default-token-pkzgr




--------------------------pod.yaml-------------------------&gt;
apiVersion: v1
kind: Pod
metadata:
  name: ubuntu-sleeper
  namespace: default
spec:
  containers:
  - command:
    - sleep
    - <span class="s2">&quot;4800&quot;</span>
    image: ubuntu
    name: ubuntu-sleeper
    securityContext:
      capabilities:
        add: <span class="o">[</span><span class="s2">&quot;SYS_TIME&quot;</span>, <span class="s2">&quot;NET_ADMIN&quot;</span><span class="o">]</span>


---------------------------------------------------------------------&gt;

root@controlplane:~# vim pod.yaml
root@controlplane:~# 
root@controlplane:~# kubectl apply -f pod.yaml
pod/ubuntu-sleeper created
root@controlplane:~# 
</pre></div>
</div>
</div>
<p>networkpolicies</p>
<div class="literal-block-wrapper docutils container" id="id49">
<div class="code-block-caption"><span class="caption-text">networkpolicies</span><a class="headerlink" href="#id49" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>network security:

Ingress and Egress rules <span class="k">for</span> ... webpods &lt;--&gt; appication pods &lt;--&gt; Database pods


Web-Pod &lt;----&gt; API-Pod &lt;----&gt; DB-Pod 


by default all pods can communicate with eachother <span class="k">in</span> k8s cluster.

and we want to restrict Web-Pods only be able to talk to API-Pods and only API-Pods be able to talk to DB-Pods.
<span class="k">for</span> this we need to implement network policy.

NetworkPolicy is another kubernetes object.
how to attach network policy to pods...hmmm we use labels and selectors :<span class="o">)</span> 


Solutions that support network policies are:
<span class="m">1</span>.Kube-router
<span class="m">2</span>.Calico
<span class="m">3</span>.Weave-net
<span class="m">4</span>.Romana
</pre></div>
</div>
</div>
<p>developnetworkpolicy</p>
<div class="literal-block-wrapper docutils container" id="id50">
<div class="code-block-caption"><span class="caption-text">developnetworkpolicy</span><a class="headerlink" href="#id50" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiversion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db-policy</span> 
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">podSelector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db</span>
  
  <span class="nt">policyTypes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span> 
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Egress</span>
  <span class="nt">ingress</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">from</span><span class="p">:</span>
     <span class="p p-Indicator">-</span> <span class="nt">podSelector</span><span class="p">:</span>
         <span class="nt">matchLabels</span><span class="p">:</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">api-pod</span>
       <span class="nt">namespaceSelector</span><span class="p">:</span>
         <span class="nt">matchLabels</span><span class="p">:</span>
           <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">prod</span>
     <span class="p p-Indicator">-</span> <span class="nt">ipBlock</span><span class="p">:</span>
         <span class="nt">cidr</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.5.10/32</span>  <span class="c1"># Lets say another backup server needs to connect to the API pod for the databackup purpose</span>
      
    <span class="nt">ports</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3306</span> 
  
  <span class="nt">egress</span><span class="p">:</span>   
    <span class="p p-Indicator">-</span> <span class="nt">to</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">ipBlock</span><span class="p">:</span>
          <span class="nt">cidr</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.5.10/32</span>  <span class="c1">#an agent from Db-pod trying to push data to the external backup server</span>

      <span class="nt">ports</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
          <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>

  
</pre></div>
</div>
</div>
<p>networkpolicylabs</p>
<div class="literal-block-wrapper docutils container" id="id51">
<div class="code-block-caption"><span class="caption-text">networkpolicylabs</span><a class="headerlink" href="#id51" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@controlplane:~# kubectl get netpol
NAME             POD-SELECTOR   AGE
payroll-policy   <span class="nv">name</span><span class="o">=</span>payroll   4m28s
root@controlplane:~# 

root@controlplane:~# kubectl describe netpol payroll-policy
Name:         payroll-policy
Namespace:    default
Created on:   <span class="m">2021</span>-09-24 <span class="m">04</span>:51:36 +0000 UTC
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Spec:
  PodSelector:     <span class="nv">name</span><span class="o">=</span>payroll
  Allowing ingress traffic:
    To Port: <span class="m">8080</span>/TCP
    From:
      PodSelector: <span class="nv">name</span><span class="o">=</span>internal
  Not affecting egress traffic
  Policy Types: Ingress
root@controlplane:~# 


the policy means traffic from internal pod can access port <span class="m">8080</span> on payroll pod is allowed.

root@controlplane:~# kubectl get pods
NAME       READY   STATUS    RESTARTS   AGE
external   <span class="m">1</span>/1     Running   <span class="m">0</span>          7m35s
internal   <span class="m">1</span>/1     Running   <span class="m">0</span>          7m35s
mysql      <span class="m">1</span>/1     Running   <span class="m">0</span>          7m35s
payroll    <span class="m">1</span>/1     Running   <span class="m">0</span>          7m35s
root@controlplane:~# 



Create a network policy to allow traffic from the Internal application only to the payroll-service and db-service.
Use the spec given on the below. You might want to <span class="nb">enable</span> ingress traffic to the pod to <span class="nb">test</span> your rules <span class="k">in</span> the UI.

Policy Name: internal-policy
Policy Type: Egress
Egress Allow: payroll
Payroll Port: <span class="m">8080</span>
Egress Allow: mysql
MySQL Port: <span class="m">3306</span>




apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: internal-policy
  namespace: default
spec:
  podSelector:
    matchLabels:
      name: internal
  policyTypes:
  - Egress
  - Ingress
  ingress:
    - <span class="o">{}</span>
  egress:
  - to:
    - podSelector:
        matchLabels:
          name: mysql
    ports:
    - protocol: TCP
      port: <span class="m">3306</span>

  - to:
    - podSelector:
        matchLabels:
          name: payroll
    ports:
    - protocol: TCP
      port: <span class="m">8080</span>

  - ports:
    - port: <span class="m">53</span>
      protocol: UDP
    - port: <span class="m">53</span>
      protocol: TCP


Note: We have also allowed Egress traffic to TCP and UDP port. 
This has been added to ensure that the internal DNS resolution works from the internal pod. 
Remember: The kube-dns service is exposed on port <span class="m">53</span>:



root@controlplane:~# kubectl apply -f internal-policy-updated.yaml 
networkpolicy.networking.k8s.io/internal-policy created
root@controlplane:~# kubectl get svc -n kube-system
NAME       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>                  AGE
kube-dns   ClusterIP   <span class="m">10</span>.96.0.10   &lt;none&gt;        <span class="m">53</span>/UDP,53/TCP,9153/TCP   66m
root@controlplane:~# 
</pre></div>
</div>
</div>
<p>ingress_egress_networkpolicy</p>
<div class="literal-block-wrapper docutils container" id="id52">
<div class="code-block-caption"><span class="caption-text">ingress_egress_networkpolicy</span><a class="headerlink" href="#id52" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">internal-policy</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">podSelector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">internal</span>
  <span class="nt">policyTypes</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Egress</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
  <span class="nt">ingress</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{}</span>
  <span class="nt">egress</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">to</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">podSelector</span><span class="p">:</span>
        <span class="nt">matchLabels</span><span class="p">:</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql</span>
    <span class="nt">ports</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3306</span>

  <span class="p p-Indicator">-</span> <span class="nt">to</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">podSelector</span><span class="p">:</span>
        <span class="nt">matchLabels</span><span class="p">:</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">payroll</span>
    <span class="nt">ports</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>

  <span class="p p-Indicator">-</span> <span class="nt">ports</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">53</span>
      <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">UDP</span>
    <span class="p p-Indicator">-</span> <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">53</span>
      <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
</pre></div>
</div>
</div>
<p>samplenetworkpolicy</p>
<div class="literal-block-wrapper docutils container" id="id53">
<div class="code-block-caption"><span class="caption-text">samplenetworkpolicy</span><a class="headerlink" href="#id53" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db-policy</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">podSelector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db</span>

  <span class="nt">policyTypes</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
  
  <span class="nt">ingress</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">from</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">podSelector</span><span class="p">:</span>
        <span class="nt">matchLabels</span><span class="p">:</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">api-pod</span>
    <span class="nt">ports</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3306</span>
</pre></div>
</div>
</div>
<div class="section" id="ca-pulic-certs-in-browsers">
<h2>CA Pulic certs in Browsers<a class="headerlink" href="#ca-pulic-certs-in-browsers" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><strong>CA public certs in chrome</strong> -</p></li>
</ul>
<a class="reference internal image-reference" href="_images/CAs_public_certs_in_chrome.png"><img alt="_images/CAs_public_certs_in_chrome.png" class="align-center" src="_images/CAs_public_certs_in_chrome.png" style="width: 80%;" /></a>
<ul class="simple">
<li><p><strong>CA public certs in firefox</strong> -</p></li>
</ul>
<a class="reference internal image-reference" href="_images/CAs_pulbic_certs_in_browser.png"><img alt="_images/CAs_pulbic_certs_in_browser.png" class="align-center" src="_images/CAs_pulbic_certs_in_browser.png" style="width: 80%;" /></a>
</div>
<div class="section" id="all-k8s-tls-certs">
<h2>all k8s TLS certs<a class="headerlink" href="#all-k8s-tls-certs" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><strong>all k8s TLS certs</strong> -</p></li>
</ul>
<a class="reference internal image-reference" href="_images/all_kubernetes_tls_certs.png"><img alt="_images/all_kubernetes_tls_certs.png" class="align-center" src="_images/all_kubernetes_tls_certs.png" style="width: 80%;" /></a>
</div>
<div class="section" id="configure-tls-public-private-keys">
<h2>configure TLS public/private keys<a class="headerlink" href="#configure-tls-public-private-keys" title="Permalink to this headline"></a></h2>
<p>TLS public/private keys at <a class="reference external" href="https://github.com/Bharathkumarraju/certified_kubernetes_administrator/tree/master/Four_September_2021_CKA_Recap/6.Security/generate_tls_public-private_keys/">TLS</a>.</p>
</div>
<div class="section" id="configure-tls-for-k8s">
<h2>configure TLS for k8s<a class="headerlink" href="#configure-tls-for-k8s" title="Permalink to this headline"></a></h2>
<p>TLS in kubernetes <a class="reference external" href="https://github.com/Bharathkumarraju/certified_kubernetes_administrator/tree/master/Four_September_2021_CKA_Recap/6.Security/generate_tls_for_kubernetes/">tlsink8s</a>.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cluster-maintenance.html" class="btn btn-neutral float-left" title="Cluster Maintenance" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="storage.html" class="btn btn-neutral float-right" title="Storage" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
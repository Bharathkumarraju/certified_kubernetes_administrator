<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Storage &mdash; CKA Notes  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/custom.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Networking" href="networking.html" />
    <link rel="prev" title="Security" href="security.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> CKA Notes
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The CKABOOK:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="core-concepts.html">Core Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheduling.html">Scheduling</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging-monitoring.html">Logging and Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="application-lifecycle-management.html">Application lifecycle management</a></li>
<li class="toctree-l1"><a class="reference internal" href="cluster-maintenance.html">Cluster Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking.html">Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="design-k8s.html">Design Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="install-k8s-kubeadm.html">Install Kubernetes with kubeadm</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">troubleshooting in k8s</a></li>
<li class="toctree-l1"><a class="reference internal" href="kodekloud-labs.html">kodekloud labs</a></li>
<li class="toctree-l1"><a class="reference internal" href="killersh-labs.html">killer.sh simulator labs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CKA Notes</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Storage</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="storage">
<h1>Storage<a class="headerlink" href="#storage" title="Permalink to this headline"></a></h1>
<p>concepts</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">concepts</span><a class="headerlink" href="#id1" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">1</span>. Persistent Volumes
<span class="m">2</span>. Persistent Volume Claims
<span class="m">3</span>. Configure applications with Persistent storage
<span class="m">4</span>. Access modes <span class="k">for</span> Volumes
<span class="m">5</span>. Kubernetes Storage Object
</pre></div>
</div>
</div>
<p>storage_in_docker</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">storage_in_docker</span><a class="headerlink" href="#id2" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Docker Storage:
---------------------------&gt;
<span class="m">1</span>. Storage Drivers  --&gt; AUFS, ZFS, BTRFS, DEVICE MAPPER, OVERLAY, OVERLAY2

<span class="m">2</span>. Volume Driver Plugins: Local, Azure File Storage, Convoy, gce-docker, GlusterFS, VMware vSphere Storage, rexray
Local is by default

docker run -it <span class="se">\</span>
     --name mysql  --volume-driver rexray/ebs --mount <span class="nv">src</span><span class="o">=</span>ebs-vol,target<span class="o">=</span>/var/lib/mysql mysql 


Docker Storage Drivers and Filesystems:
--------------------------------------------------&gt;

on <span class="nb">local</span> FS:
-------------&gt;
/var/lib/docker 

dockers layered architecture
-------------------------------&gt; 
reuse cached image layers


<span class="s2">&quot;image layer&quot;</span> --&gt; Read Only
--------------------------------------------------&gt;
Layer5: update entrypoint with <span class="s2">&quot;flask&quot;</span> <span class="nb">command</span>
Layer4: Source code
Layer3: changes <span class="k">in</span> pip packages
Layer2: Changes <span class="k">in</span> apt packages
layer1: Base ubuntu layer

<span class="s2">&quot;container layer&quot;</span> --&gt; Read Write
-----------------------------------------------------&gt;

 docker build Dockerfile -t bharath/webapp
 docker run bharath/webap

 when we run a container from the image ...
 docker creates a container based on the <span class="s2">&quot;imagelayer&quot;</span> and creates a new writebale layer<span class="o">(</span><span class="s2">&quot;container layer&quot;</span><span class="o">)</span> on top of the image layer.

 <span class="k">then</span> the <span class="s2">&quot;writeable layer&quot;</span> is used to store the data created by the container such as log files written by the application and any temporary files generated by the container.
 or any files modified by the use <span class="k">in</span> the container, the life of this layer is till the container is alive.

 The same image layer used by all the containers created by this image.


Mount Volumes: Volumes are created by docker<span class="o">(</span>Volme Mount<span class="o">)</span>
-------------------------------------------------------&gt;

docker volume create data_volume
docker run -v data_volume:/var/lib/mysql mysql

docker run -v data_volume2:/var/lib/mysql mysql  <span class="c1">#docker automatically creates data_volume2(docker volume create data_volume2)</span>


to mount existing host directory<span class="o">(</span>cause the data already present there<span class="o">)</span> we need to use full path as below:<span class="o">(</span>Bind mount<span class="o">)</span>
-----------------------------------------------------------------------------------------------------------------------&gt;
docker run -v /data/mysql:/var/lib/mysql mysql 
docker run --mount <span class="nv">type</span><span class="o">=</span>bind,source<span class="o">=</span>/data/mysql,target<span class="o">=</span>/var/lib/mysql mysql 
</pre></div>
</div>
</div>
<p>container_runtime</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">container_runtime</span><a class="headerlink" href="#id3" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rkt      <span class="p">|</span>    
docker   <span class="p">|</span>    CRI<span class="o">(</span>Container Runtime Interface<span class="o">)</span>  ---&gt; Kubernetes
cri-o    <span class="p">|</span>    

like the sameway CNI<span class="o">(</span>Container Network Interface<span class="o">)</span> has developed....any network solutions<span class="o">(</span>weaveworks, flannel, cilium<span class="o">)</span> should follow the CNI guidelines to develop network plugins <span class="k">for</span> k8s.


Similarly CSI<span class="o">(</span>Container Storage Interface<span class="o">)</span> has developed ...any storage solutions<span class="o">(</span>Partworx, Amazon EBS, DELL EMC, GlusterFS<span class="o">)</span> should follow the CSI guidelines to develop storage  plugins <span class="k">for</span> k8s.

RPC --&gt; Remote Procedure Call
</pre></div>
</div>
</div>
<p>k8svolumes</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">k8svolumes</span><a class="headerlink" href="#id4" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>volumes <span class="k">in</span> kubernetes

to persist data processed by the containers we attach volumes to containers when they are created.

attach volumes to pods <span class="k">in</span> k8s:
---------------------------------------&gt;

spec:
  containers:
  - image: alpine
    name: alpine
    command: <span class="o">[</span><span class="s2">&quot;/bin/sh&quot;</span>, <span class="s2">&quot;-c&quot;</span><span class="o">]</span>
    args: <span class="o">[</span><span class="s2">&quot;shuf -i 0-100 -n 1 &gt;&gt; /tmp/number.out&quot;</span><span class="o">]</span>
    volumeMounts:
    - mountPath: /opt
      name: data-volume
  volumes:
  - name: data-volume
    hostPath:
      path: /Data
      type: Directory


Volume storage options....we can use hostPath  what <span class="k">if</span> we have multi node cluster...in which host the Data directory creates.
<span class="k">for</span> that we can NFS storage, EFS, EBS, google persistent disk, GlusterFS etc


<span class="k">if</span> we want to use volume storage <span class="nb">type</span> as AWS EBS can as well.

  volumes:
  - name: data-volume
    awsElasticBlockStore:
      volumeID: &lt;volume_id&gt;
      fsType: ext4
</pre></div>
</div>
</div>
<p>podvolumes</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">podvolumes</span><a class="headerlink" href="#id5" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>apiVersion: v1
kind: Pod
metadata:
  name: random-number-generator
spec:
  containers:
  - image: alpine
    name: alpine
    command: <span class="o">[</span><span class="s2">&quot;/bin/sh&quot;</span>, <span class="s2">&quot;-c&quot;</span><span class="o">]</span>
    args: <span class="o">[</span><span class="s2">&quot;shuf -i 0-100 -n 1 &gt;&gt; /tmp/number.out&quot;</span><span class="o">]</span>
    volumeMounts:
    - mountPath: /opt
      name: data-volume

  volumes:
  - name: data-volume
    hostPath:
      path: /Data
      type: Directory
  - name: cloud-volume
    awsElasticBlockStore:
      volumeID: &lt;volume-ID&gt;
      fsType: ext4
</pre></div>
</div>
</div>
<p>PVS_in_k8s</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">PVS_in_k8s</span><a class="headerlink" href="#id6" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>  volumes:
  - name: data-volume
    awsElasticBlockStore:
      volumeID: &lt;volume_id&gt;
      fsType: ext4

---------------------------------------------------------------------------------------------------&gt;

A <span class="s2">&quot;PersistentVolumes(PVs)&quot;</span> is a cluster wide pool of storage volumes configured by an administrator, to be used <span class="k">in</span> application deployed by users on the cluster.

users can now <span class="k">select</span> storage from this PersistentVolumes using an object called <span class="s2">&quot;PersistentVolumeClaims(PVCs)&quot;</span>

<span class="s2">&quot;accessModes:&quot;</span>
---------------------&gt;
ReadOnlyMany
ReadWriteOnce
ReadWriteMany




spec:
  capacity:
    storage: 2Gi
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: /tmp/data
  awsElasticBlockStore: &lt;volume_id&gt;
    fsType: ext4


<span class="s2">&quot;other options:&quot;</span>
-------------------------&gt;

  storageClassName: slow
  mountOptions:
    - hard
    - <span class="nv">nfsvers</span><span class="o">=</span><span class="m">4</span>.1
  nfs:
    path: /tmp
    server: <span class="m">172</span>.17.0.2
</pre></div>
</div>
</div>
<p>pv</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">pv</span><a class="headerlink" href="#id7" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pv-vol</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">capacity</span><span class="p">:</span>
    <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2Gi</span>
  <span class="nt">accessModes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="c1">#  hostPath:</span>
<span class="c1">#    path: /tmp/data </span>
  <span class="nt">awsElasticBlockStore</span><span class="p">:</span>
    <span class="nt">volumeID</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;volume_id&gt;</span>
    <span class="nt">fsType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ext4</span>
</pre></div>
</div>
</div>
<p>demopv</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">demopv</span><a class="headerlink" href="#id8" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>PersistentVolumeClaims having one to one relatioship with PersistentVolumes
</pre></div>
</div>
</div>
<p>pvc</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">pvc</span><a class="headerlink" href="#id9" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pv-vol</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">capacity</span><span class="p">:</span>
    <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2Gi</span>
  <span class="nt">accessModes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
  <span class="nt">hostPath</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/data</span> 
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myclaim</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">accessModes</span><span class="p">:</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
  <span class="nt">resources</span><span class="p">:</span>
    <span class="nt">requests</span><span class="p">:</span>
      <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</pre></div>
</div>
</div>
<p>pvcs_in_pods</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">pvcs_in_pods</span><a class="headerlink" href="#id10" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mypod</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfrontend</span>
      <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
      <span class="nt">volumeMounts</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="s">&quot;/var/www/html&quot;</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mypd</span>
  <span class="nt">volumes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mypd</span>
      <span class="nt">persistentVolumeClaim</span><span class="p">:</span>
        <span class="nt">claimName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myclaim</span>
</pre></div>
</div>
</div>
<p>demopvc</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">demopvc</span><a class="headerlink" href="#id11" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@controlplane:~# kubectl get pods
NAME     READY   STATUS    RESTARTS   AGE
webapp   <span class="m">1</span>/1     Running   <span class="m">0</span>          14s
root@controlplane:~# 


root@controlplane:~# kubectl describe pod webapp 
Name:         webapp
Namespace:    default
Priority:     <span class="m">0</span>
Node:         controlplane/10.51.220.9
Start Time:   Sat, <span class="m">25</span> Sep <span class="m">2021</span> <span class="m">00</span>:57:24 +0000
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Status:       Running
IP:           <span class="m">10</span>.244.0.4
IPs:
  IP:  <span class="m">10</span>.244.0.4
Containers:
  event-simulator:
    Container ID:   docker://6b01ef3409ea8fa1044717f94d8fc3c5a85fd468ac4049b67cd981b1453a4ab1
    Image:          kodekloud/event-simulator
    Image ID:       docker-pullable://kodekloud/event-simulator@sha256:1e3e9c72136bbc76c96dd98f29c04f298c3ae241c7d44e2bf70bcc209b030bf9
    Port:           &lt;none&gt;
    Host Port:      &lt;none&gt;
    State:          Running
      Started:      Sat, <span class="m">25</span> Sep <span class="m">2021</span> <span class="m">00</span>:57:34 +0000
    Ready:          True
    Restart Count:  <span class="m">0</span>
    Environment:
      LOG_HANDLERS:  file
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-rqj8k <span class="o">(</span>ro<span class="o">)</span>
Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 
Volumes:
  default-token-rqj8k:
    Type:        Secret <span class="o">(</span>a volume populated by a Secret<span class="o">)</span>
    SecretName:  default-token-rqj8k
    Optional:    <span class="nb">false</span>
QoS Class:       BestEffort
Node-Selectors:  &lt;none&gt;
Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class="nv">op</span><span class="o">=</span>Exists <span class="k">for</span> 300s
                 node.kubernetes.io/unreachable:NoExecute <span class="nv">op</span><span class="o">=</span>Exists <span class="k">for</span> 300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  49s   default-scheduler  Successfully assigned default/webapp to controlplane
  Normal  Pulling    47s   kubelet            Pulling image <span class="s2">&quot;kodekloud/event-simulator&quot;</span>
  Normal  Pulled     40s   kubelet            Successfully pulled image <span class="s2">&quot;kodekloud/event-simulator&quot;</span> <span class="k">in</span> <span class="m">7</span>.353654278s
  Normal  Created    39s   kubelet            Created container event-simulator
  Normal  Started    39s   kubelet            Started container event-simulator
root@controlplane:~#



root@controlplane:~# kubectl <span class="nb">exec</span> webapp -- cat /log/app.log
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:34,911<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER2 logged <span class="k">in</span>
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:35,911<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER1 logged out
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:36,913<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER1 logged <span class="k">in</span>
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:37,913<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER1 is viewing page1
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:38,915<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER3 logged out
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:39,916<span class="o">]</span> WARNING <span class="k">in</span> event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:39,916<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER1 logged <span class="k">in</span>
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:40,917<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER2 is viewing page1
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:41,918<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER2 is viewing page2
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:42,919<span class="o">]</span> WARNING <span class="k">in</span> event-simulator: USER7 Order failed as the item is OUT OF STOCK.
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:42,920<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER3 logged out
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:43,920<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER1 is viewing page2
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:44,922<span class="o">]</span> WARNING <span class="k">in</span> event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:44,922<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER2 is viewing page1
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:45,922<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER3 is viewing page2
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:46,924<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER4 logged out
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:47,925<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER3 logged out
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:48,925<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER2 is viewing page3
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:49,926<span class="o">]</span> WARNING <span class="k">in</span> event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:49,927<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER2 is viewing page2
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:50,928<span class="o">]</span> WARNING <span class="k">in</span> event-simulator: USER7 Order failed as the item is OUT OF STOCK.
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:50,928<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER2 is viewing page3
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:51,929<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER4 logged <span class="k">in</span>
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:52,930<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER3 is viewing page1
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">00</span>:57:53,932<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER4 is viewing page3
root@controlplane:~# 

Configure a volume to store these logs at /var/log/webapp on the host.

<span class="c1">#===============================================================================</span>

apiVersion: v1
kind: Pod
metadata:
  name: webapp
spec:
  containers:
  - name: event-simulator
    image: kodekloud/event-simulator
    env:
    - name: LOG_HANDLERS
      value: file
    volumeMounts:
    - mountPath: /log
      name: log-volume

  volumes:
  - name: log-volume
    hostPath:
      <span class="c1"># directory location on host</span>
      path: /var/log/webapp
      <span class="c1"># this field is optional</span>
      type: Directory

<span class="c1">#===============================================================================</span>




root@controlplane:~# kubectl edit pod webapp 
error: pods <span class="s2">&quot;webapp&quot;</span> is invalid
A copy of your changes has been stored to <span class="s2">&quot;/tmp/kubectl-edit-6ic2t.yaml&quot;</span>
error: Edit cancelled, no valid changes were saved.
root@controlplane:~# kubectl delete pod webapp
pod <span class="s2">&quot;webapp&quot;</span> deleted


root@controlplane:/var/log/webapp# <span class="nb">pwd</span>
/var/log/webapp
root@controlplane:/var/log/webapp# ls -rtlh
total <span class="m">8</span>.0K
-rw-r--r-- <span class="m">1</span> root root <span class="m">4</span>.1K Sep <span class="m">25</span> <span class="m">01</span>:08 app.log
root@controlplane:/var/log/webapp# tail -f app.log 
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:08:48,417<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER1 is viewing page2
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:08:49,417<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER1 logged <span class="k">in</span>
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:08:50,419<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER1 is viewing page1
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:08:51,420<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER3 logged <span class="k">in</span>
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:08:52,421<span class="o">]</span> WARNING <span class="k">in</span> event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:08:52,421<span class="o">]</span> WARNING <span class="k">in</span> event-simulator: USER7 Order failed as the item is OUT OF STOCK.
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:08:52,421<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER1 logged out
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:08:53,422<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER4 is viewing page1
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:08:54,423<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER4 is viewing page1
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:08:55,424<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER4 is viewing page2
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:08:56,426<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER2 is viewing page2
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:08:57,426<span class="o">]</span> WARNING <span class="k">in</span> event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:08:57,427<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER1 is viewing page3
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:08:58,428<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER2 logged <span class="k">in</span>
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:08:59,429<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER3 is viewing page3
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:09:00,430<span class="o">]</span> WARNING <span class="k">in</span> event-simulator: USER7 Order failed as the item is OUT OF STOCK.
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:09:00,430<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER2 logged out
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:09:01,432<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER1 is viewing page3
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:09:02,433<span class="o">]</span> WARNING <span class="k">in</span> event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:09:02,433<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER1 is viewing page1
<span class="o">[</span><span class="m">2021</span>-09-25 <span class="m">01</span>:09:03,434<span class="o">]</span> INFO <span class="k">in</span> event-simulator: USER3 is viewing page1
^C
root@controlplane:/var/log/webapp#


Create a Persistent Volume with the given specification.
Volume Name: pv-log
Storage: 100Mi
Access Modes: ReadWriteMany
Host Path: /pv/log
Reclaim Policy: Retain

root@controlplane:~# vim pv.yaml
root@controlplane:~# kubectl apply -f pv.yaml
persistentvolume/pv-log created
root@controlplane:~# 



Let us claim some of that storage <span class="k">for</span> our application. Create a Persistent Volume Claim with the given specification.

Volume Name: claim-log-1
Storage Request: 50Mi
Access Modes: ReadWriteOnce



root@controlplane:~# kubectl get pv,pvc
NAME                      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE
persistentvolume/pv-log   100Mi      RWX            Retain           Available                                   6m33s

NAME                                STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/claim-log-1   Pending                                                     26s
root@controlplane:~# 


AccessModes also should match on bot PV and PVC 



root@controlplane:~# kubectl delete pvc claim-log-1
persistentvolumeclaim <span class="s2">&quot;claim-log-1&quot;</span> deleted
root@controlplane:~# kubectl apply -f pvc.yaml
persistentvolumeclaim/claim-log-1 created
root@controlplane:~# kubectl get pv,pvc -o wide
NAME                      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                 STORAGECLASS   REASON   AGE   VOLUMEMODE
persistentvolume/pv-log   100Mi      RWX            Retain           Bound    default/claim-log-1                           12m   Filesystem

NAME                                STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE   VOLUMEMODE
persistentvolumeclaim/claim-log-1   Bound    pv-log   100Mi      RWX                           18s   Filesystem
root@controlplane:~# 



root@controlplane:~# kubectl get pv
NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS     CLAIM                 STORAGECLASS   REASON   AGE
pv-log   100Mi      RWX            Retain           Released   default/claim-log-1                           25m
root@controlplane:~# 
</pre></div>
</div>
</div>
<p>add_volumes</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">add_volumes</span><a class="headerlink" href="#id12" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webapp</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">event-simulator</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kodekloud/event-simulator</span>
    <span class="nt">env</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LOG_HANDLERS</span>
      <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">file</span>
    <span class="nt">volumeMounts</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/log</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">log-volume</span>

  <span class="nt">volumes</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">log-volume</span>
    <span class="nt">hostPath</span><span class="p">:</span>
      <span class="c1"># directory location on host</span>
      <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/log/webapp</span>
      <span class="c1"># this field is optional</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Directory</span>
</pre></div>
</div>
</div>
<p>create_pv</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">create_pv</span><a class="headerlink" href="#id13" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pv-log</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">capacity</span><span class="p">:</span>
    <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100Mi</span>
  <span class="nt">accessModes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
  <span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Retain</span>
  <span class="nt">hostPath</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">/pv/log</span>
</pre></div>
</div>
</div>
<p>create_pvc</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">create_pvc</span><a class="headerlink" href="#id14" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">claim-log-1</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">accessModes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
  <span class="nt">resources</span><span class="p">:</span>
    <span class="nt">requests</span><span class="p">:</span>
      <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">50Mi</span>
</pre></div>
</div>
</div>
<p>pvcs_in_pods</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">pvcs_in_pods</span><a class="headerlink" href="#id15" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webapp</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">event-simulator</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kodekloud/event-simulator</span>
    <span class="nt">env</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LOG_HANDLERS</span>
      <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">file</span>
    <span class="nt">volumeMounts</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/log</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">log-volume</span>

  <span class="nt">volumes</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">log-volume</span>
    <span class="nt">persistentVolumeClaim</span><span class="p">:</span>
      <span class="nt">claimName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">claim-log-1</span>
</pre></div>
</div>
</div>
<p>storage_classes</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">storage_classes</span><a class="headerlink" href="#id16" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pv-definition.yaml:
--------------------------&gt;
apiVersion:v1
kind: persistentVolume
metadata:
  name: pv-vol1
spec:
  accessModes:
    - ReadWriteOnce
  capacity:
    storage: 500Mi
  gcePersistentDisk:
    pdName: pd-disk 
    fsType: ext4 

the problem with above PV definition is that first we need to create a persistent Disk <span class="k">in</span> GCP like below.
gcloud beta compute disks create --size 1GB --region asia-southeast1


We can automatically create volume <span class="k">in</span> GCP dynamically using storage classes

dynamically provision disks <span class="k">in</span> GCP using storage classes:
---------------------------------------------------------------&gt;
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: google-storage
provisioner: kubernetes.io/gce-pd
parameters:
  type: pd-standard
  replication-type: none


With StorageClass is define we no-longer needed the PersitentVolumes.

In the PersistentVolumeClaim definition specify the StorageClass as below:
-------------------------------------------------------------------------------&gt;

apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: myclaim
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: google-storage
  resources:
    requests:
      storage: 500Mi


use PVC inside pod definition file:
------------------------------------------&gt;
apiVersion: v1
kind: Pod
metadata:
  name: random-number-generator
spec:
  containers:
  - image: alpine
    name: alpine
    command: <span class="o">[</span><span class="s2">&quot;/bin/sh&quot;</span>, <span class="s2">&quot;-c&quot;</span><span class="o">]</span>
    args: <span class="o">[</span><span class="s2">&quot;shuf -i 0-100 -n 1 &gt;&gt; /tmp/number.out&quot;</span><span class="o">]</span>
    volumeMounts:
    - mountPath: /opt
      name: data-volume
  volumes:
  - name: data-volume
    PersistentVolumeClaim:
      claimName: myclaim
</pre></div>
</div>
</div>
<p>demo_storage_classes</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">demo_storage_classes</span><a class="headerlink" href="#id17" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">google-storage</span>
<span class="nt">provisioner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/gce-pd</span>
</pre></div>
</div>
</div>
<p>specify_storage_classes</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">specify_storage_classes</span><a class="headerlink" href="#id18" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">claim-log-1</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">accessModes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
  <span class="nt">storageClassName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">google-storage</span>
  <span class="nt">resources</span><span class="p">:</span>
    <span class="nt">requests</span><span class="p">:</span>
      <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">50Mi</span>
</pre></div>
</div>
</div>
<p>pvc_storage_classes</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">pvc_storage_classes</span><a class="headerlink" href="#id19" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">google-storage</span>
<span class="nt">provisioner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/gce-pd</span>
<span class="nt">parameters</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pd-standard</span>
  <span class="nt">replication-type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">none</span>

<span class="nn">---</span>

<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myclaim</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">accessModes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
  <span class="nt">storageClassName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">google-storage</span>
  <span class="nt">resources</span><span class="p">:</span>
    <span class="nt">requests</span><span class="p">:</span>
      <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">500Mi</span>

<span class="nn">---</span>

<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">random-number-generator</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;/bin/sh&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;-c&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">args</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;shuf</span><span class="nv"> </span><span class="s">-i</span><span class="nv"> </span><span class="s">0-100</span><span class="nv"> </span><span class="s">-n</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">&gt;&gt;</span><span class="nv"> </span><span class="s">/tmp/number.out&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">volumeMounts</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/opt</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">data-volume</span>
  <span class="nt">volumes</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">data-volume</span>
    <span class="nt">PersistentVolumeClaim</span><span class="p">:</span>
      <span class="nt">claimName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myclaim</span>
</pre></div>
</div>
</div>
<p>labs_storage_classes</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">labs_storage_classes</span><a class="headerlink" href="#id20" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">root@controlplane:~# kubectl get sc  --all-namespaces</span>
<span class="l l-Scalar l-Scalar-Plain">No resources found</span>
<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~#</span>


<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~# kubectl get sc  --all-namespaces</span>
<span class="l l-Scalar l-Scalar-Plain">NAME                        PROVISIONER                     RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE</span>
<span class="l l-Scalar l-Scalar-Plain">local-storage               kubernetes.io/no-provisioner    Delete          WaitForFirstConsumer   false                  26s</span>
<span class="l l-Scalar l-Scalar-Plain">portworx-io-priority-high   kubernetes.io/portworx-volume   Delete          Immediate              false                  26s</span>
<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~# kubectl describe sc local-storage</span>
<span class="l l-Scalar l-Scalar-Plain">Name</span><span class="p p-Indicator">:</span>            <span class="l l-Scalar l-Scalar-Plain">local-storage</span>
<span class="nt">IsDefaultClass</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">No</span>
<span class="nt">Annotations</span><span class="p">:</span>     <span class="l l-Scalar l-Scalar-Plain">kubectl.kubernetes.io/last-applied-configuration={&quot;apiVersion&quot;:&quot;storage.k8s.io/v1&quot;,&quot;kind&quot;:&quot;StorageClass&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;name&quot;:&quot;local-storage&quot;},&quot;provisioner&quot;:&quot;kubernetes.io/no-provisioner&quot;,&quot;volumeBindingMode&quot;:&quot;WaitForFirstConsumer&quot;}</span>

<span class="nt">Provisioner</span><span class="p">:</span>           <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/no-provisioner</span>
<span class="nt">Parameters</span><span class="p">:</span>            <span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<span class="nt">AllowVolumeExpansion</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">&lt;unset&gt;</span>
<span class="nt">MountOptions</span><span class="p">:</span>          <span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<span class="nt">ReclaimPolicy</span><span class="p">:</span>         <span class="l l-Scalar l-Scalar-Plain">Delete</span>
<span class="nt">VolumeBindingMode</span><span class="p">:</span>     <span class="l l-Scalar l-Scalar-Plain">WaitForFirstConsumer</span>
<span class="nt">Events</span><span class="p">:</span>                <span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~# kubectl describe sc portworx-io-priority-high</span> 
<span class="nt">Name</span><span class="p">:</span>            <span class="l l-Scalar l-Scalar-Plain">portworx-io-priority-high</span>
<span class="nt">IsDefaultClass</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">No</span>
<span class="nt">Annotations</span><span class="p">:</span>     <span class="l l-Scalar l-Scalar-Plain">kubectl.kubernetes.io/last-applied-configuration={&quot;apiVersion&quot;:&quot;storage.k8s.io/v1&quot;,&quot;kind&quot;:&quot;StorageClass&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;name&quot;:&quot;portworx-io-priority-high&quot;},&quot;parameters&quot;:{&quot;priority_io&quot;:&quot;high&quot;,&quot;repl&quot;:&quot;1&quot;,&quot;snap_interval&quot;:&quot;70&quot;},&quot;provisioner&quot;:&quot;kubernetes.io/portworx-volume&quot;}</span>

<span class="nt">Provisioner</span><span class="p">:</span>           <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/portworx-volume</span>
<span class="nt">Parameters</span><span class="p">:</span>            <span class="l l-Scalar l-Scalar-Plain">priority_io=high,repl=1,snap_interval=70</span>
<span class="nt">AllowVolumeExpansion</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">&lt;unset&gt;</span>
<span class="nt">MountOptions</span><span class="p">:</span>          <span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<span class="nt">ReclaimPolicy</span><span class="p">:</span>         <span class="l l-Scalar l-Scalar-Plain">Delete</span>
<span class="nt">VolumeBindingMode</span><span class="p">:</span>     <span class="l l-Scalar l-Scalar-Plain">Immediate</span>
<span class="nt">Events</span><span class="p">:</span>                <span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~#</span> 


<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~# kubectl get pv --all-namespaces</span>
<span class="l l-Scalar l-Scalar-Plain">NAME       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS    REASON   AGE</span>
<span class="l l-Scalar l-Scalar-Plain">local-pv   500Mi      RWO            Retain           Available           local-storage            11m</span>
<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~#</span>

<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~# kubectl describe pv local-pv</span>
<span class="nt">Name</span><span class="p">:</span>              <span class="l l-Scalar l-Scalar-Plain">local-pv</span>
<span class="nt">Labels</span><span class="p">:</span>            <span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<span class="nt">Annotations</span><span class="p">:</span>       <span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<span class="nt">Finalizers</span><span class="p">:</span>        <span class="p p-Indicator">[</span><span class="nv">kubernetes.io/pv-protection</span><span class="p p-Indicator">]</span>
<span class="nt">StorageClass</span><span class="p">:</span>      <span class="l l-Scalar l-Scalar-Plain">local-storage</span>
<span class="nt">Status</span><span class="p">:</span>            <span class="l l-Scalar l-Scalar-Plain">Available</span>
<span class="nt">Claim</span><span class="p">:</span>             
<span class="nt">Reclaim Policy</span><span class="p">:</span>    <span class="l l-Scalar l-Scalar-Plain">Retain</span>
<span class="nt">Access Modes</span><span class="p">:</span>      <span class="l l-Scalar l-Scalar-Plain">RWO</span>
<span class="nt">VolumeMode</span><span class="p">:</span>        <span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
<span class="nt">Capacity</span><span class="p">:</span>          <span class="l l-Scalar l-Scalar-Plain">500Mi</span>
<span class="nt">Node Affinity</span><span class="p">:</span>     
  <span class="nt">Required Terms</span><span class="p">:</span>  
    <span class="nt">Term 0</span><span class="p">:</span>        <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/hostname in [controlplane]</span>
<span class="nt">Message</span><span class="p">:</span>           
<span class="nt">Source</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">LocalVolume (a persistent volume backed by local storage on a node)</span>
    <span class="nt">Path</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">/opt/vol1</span>
<span class="nt">Events</span><span class="p">:</span>    <span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~#</span> 




<span class="l l-Scalar l-Scalar-Plain">Create a new PersistentVolumeClaim by the name of local-pvc that should bind to the volume local-pv.</span>
<span class="l l-Scalar l-Scalar-Plain">Inspect the pv local-pv for the specs.</span>

<span class="nt">PVC</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local-pvc</span>
<span class="l l-Scalar l-Scalar-Plain">Correct Access Mode?</span>
<span class="l l-Scalar l-Scalar-Plain">Correct StorageClass Used?</span>
<span class="l l-Scalar l-Scalar-Plain">PVC requests volume size = 500Mi?</span>

<span class="l l-Scalar l-Scalar-Plain">-------------------------------------------------&gt;</span>

<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local-pvc</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">storageClassName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local-storage</span>
  <span class="nt">volumeName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local-pv</span>
  <span class="nt">resources</span><span class="p">:</span>
    <span class="nt">requests</span><span class="p">:</span>
      <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8Gi</span>


<span class="l l-Scalar l-Scalar-Plain">-------------------------------------------------&gt;</span>

<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~# kubectl describe pvc local-pvc</span>
<span class="nt">Name</span><span class="p">:</span>          <span class="l l-Scalar l-Scalar-Plain">local-pvc</span>
<span class="nt">Namespace</span><span class="p">:</span>     <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">StorageClass</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">local-storage</span>
<span class="nt">Status</span><span class="p">:</span>        <span class="l l-Scalar l-Scalar-Plain">Bound</span>
<span class="nt">Volume</span><span class="p">:</span>        <span class="l l-Scalar l-Scalar-Plain">local-pv</span>
<span class="nt">Labels</span><span class="p">:</span>        <span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<span class="nt">Annotations</span><span class="p">:</span>   <span class="nt">pv.kubernetes.io/bind-completed</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="nt">Finalizers</span><span class="p">:</span>    <span class="p p-Indicator">[</span><span class="nv">kubernetes.io/pvc-protection</span><span class="p p-Indicator">]</span>
<span class="nt">Capacity</span><span class="p">:</span>      <span class="l l-Scalar l-Scalar-Plain">500Mi</span>
<span class="nt">Access Modes</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">RWO</span>
<span class="nt">VolumeMode</span><span class="p">:</span>    <span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
<span class="nt">Used By</span><span class="p">:</span>       <span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<span class="nt">Events</span><span class="p">:</span>        <span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~#</span> 



<span class="l l-Scalar l-Scalar-Plain">MacBook-Pro:7.Storage bharathdasaraju$ kubectl run nginx --image=nginx --dry-run=client -o yaml &gt; 22.pod_uses_local_storagePVC.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">MacBook-Pro:7.Storage bharathdasaraju$</span> 

<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~# vim 22.pod_uses_local_storagePVC.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~# kubectl apply -f 22.pod_uses_local_storagePVC.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">pod/nginx created</span>
<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~#</span> 


<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~# kubectl get pvc</span>
<span class="l l-Scalar l-Scalar-Plain">NAME        STATUS   VOLUME     CAPACITY   ACCESS MODES   STORAGECLASS    AGE</span>
<span class="l l-Scalar l-Scalar-Plain">local-pvc   Bound    local-pv   500Mi      RWO            local-storage   11m</span>
<span class="l l-Scalar l-Scalar-Plain">root@controlplane:~#</span> 




<span class="nt">Create a new Storage Class called delayed-volume-sc that makes use of the below specs</span><span class="p">:</span>

<span class="nt">provisioner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/no-provisioner</span>
<span class="nt">volumeBindingMode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">WaitForFirstConsumer</span>

<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">delayed-volume-sc</span>
<span class="nt">provisioner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/no-provisioner</span>
<span class="nt">volumeBindingMode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">WaitForFirstConsumer</span>
</pre></div>
</div>
</div>
<p>PV_to_PVC</p>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">PV_to_PVC</span><a class="headerlink" href="#id21" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local-pvc</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">accessModes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
  <span class="nt">storageClassName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local-storage</span>
  <span class="nt">volumeName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local-pv</span>
  <span class="nt">resources</span><span class="p">:</span>
    <span class="nt">requests</span><span class="p">:</span>
      <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8Gi</span>
</pre></div>
</div>
</div>
<p>pod_localstorage</p>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">pod_localstorage</span><a class="headerlink" href="#id22" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">namne</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
    <span class="nt">volumeMounts</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">local-persistent-storage</span>
        <span class="nt">mountPath</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">/var/www/html</span>
  <span class="nt">volumes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local-persistent-storage</span>
      <span class="nt">persistentVolumeClaim</span><span class="p">:</span>
        <span class="nt">claimName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local-pvc</span>
</pre></div>
</div>
</div>
<p>storageclass_noprovisioner</p>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">storageclass_noprovisioner</span><a class="headerlink" href="#id23" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">delayed-volume-sc</span>
<span class="nt">provisioner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/no-provisioner</span>
<span class="nt">volumeBindingMode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">WaitForFirstConsumer</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="security.html" class="btn btn-neutral float-left" title="Security" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="networking.html" class="btn btn-neutral float-right" title="Networking" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>